{"version":3,"sources":["assets/script/notice/RollNotice.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;AACA,oEAA4C;AAG5C,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG,EAAE,CAAC,UAAU,CAAC;AAG5C,IAAqB,UAAU,GAA/B,MAAqB,UAAW,SAAQ,gBAAM;IAA9C;;QAGI,UAAK,GAAgB,IAAI,CAAC;QAE1B,WAAM,GAAW,EAAE,CAAC;QACpB,UAAU;QACV,aAAQ,GAAG,EAAE,CAAC;QA4Ed,iBAAiB;IACrB,CAAC;IA3EG,MAAM;QACF,KAAK,CAAC,MAAM,EAAE,CAAC;QACf,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC;IACnC,CAAC;IAED,aAAa;QACT,KAAK,CAAC,aAAa,EAAE,CAAC;QACtB,IAAI,CAAC,aAAa,CAAC,mBAAmB,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;IAC9D,CAAC;IAED,IAAI,CAAC,IAAI;QACL,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;IACpB,CAAC;IAED,KAAK;QACD,IAAI,CAAC,WAAW,EAAE,CAAA;IACtB,CAAC;IAED,UAAU;QACN,IAAI,WAAW,GAAG,uBAAe,CAAC,UAAU,EAAE,CAAC;QAC/C,OAAO,WAAW,CAAC;IACvB,CAAC;IAED;;MAEE;IACF,WAAW;QACP,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,yBAAyB,EAAE;YAAE,OAAO;QACxD,IAAI,IAAI,CAAC,QAAQ;YAAE,OAAO;QAC1B,IAAI,CAAC,OAAO,EAAE,CAAC;IACnB,CAAC;IAED;;OAEG;IACH,OAAO;QAEH,IAAI,YAAY,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QACrC,IAAI,CAAC,YAAY,EAAE;YACf,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,KAAK,CAAC;YAChC,OAAO;SACV;QAED,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC;QAC/B,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QACrB,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;QACrD,IAAI,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,GAAG,EAAE,CAAC;QACjE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,KAAK,CAAC;QAC1B,oDAAoD;QACpD,+BAA+B;QAC/B,uDAAuD;QACvD,6BAA6B;QAC7B,sBAAsB;QACtB,KAAK;QACL,sDAAsD;QAEtD,IAAI,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAA;QAC9C,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;aACpB,EAAE,CAAC,MAAM,EAAE,EAAE,QAAQ,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC;aAC1C,IAAI,CAAC,GAAG,EAAE;YACP,uBAAe,CAAC,aAAa,EAAE,CAAC;YAChC,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;YACtB,IAAI,CAAC,OAAO,EAAE,CAAC;QACnB,CAAC,CAAC;aACD,KAAK,EAAE,CAAC;IAEjB,CAAC;IAED,aAAa,CAAC,OAAO;QACjB,IAAI,UAAU,GAAG,OAAO,CAAC,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAAA;QAC5C,UAAU,GAAG,UAAU,CAAC,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAAA;QAC3C,OAAO,UAAU,CAAA;IACrB,CAAC;CAGJ,CAAA;AAjFG;IADC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC;yCACI;AAHT,UAAU;IAD9B,OAAO;GACa,UAAU,CAoF9B;kBApFoB,UAAU;AAsF/B,MAAM,gBAAgB;IAAtB;QACI,iBAAY,GAAG,EAAE,CAAC;QAYlB;;;WAGG;QACH,eAAU,GAAG,UAAU,UAAU;YAC7B,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACnC,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,KAAK,CAAC,EAAE;gBAChC,QAAQ,CAAC,mBAAmB,CAAC,CAAC;aACjC;YAAA,CAAC;QACN,CAAC,CAAC;QACF;;WAEG;QACH,kBAAa,GAAG;YACZ,IAAI,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;gBAAE,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAC7D,CAAC,CAAC;IACN,CAAC;IAzBG;;OAEG;IACH,UAAU;QACN,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE;YACvB,OAAO,IAAI,CAAC;SACf;QACD,OAAO,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;IAChC,CAAC;CAiBJ;AACY,QAAA,eAAe,GAAG,IAAI,gBAAgB,EAAE,CAAA","file":"","sourceRoot":"/","sourcesContent":["import EventComponent from \"../framework/base/EventComponent\";\nimport UIView from \"../framework/ui/UIView\";\n\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class RollNotice extends UIView {\n\n    @property(cc.RichText)\n    Label: cc.RichText = null;\n    isAction: any;\n    second: number = 10;\n    // 一秒钟移动速度\n    moveSize = 80;\n\n    onLoad() {\n        super.onLoad();\n        this.node.parent.active = true;\n    }\n\n    bindingEvents() {\n        super.bindingEvents();\n        this.registerEvent(\"rnotice.basestart\", this.actionStart);\n    }\n\n    show(args) {\n        super.show(args)\n    }\n\n    start() {\n        this.actionStart()\n    }\n\n    getContent() {\n        let contentData = RollNoticeLogic.getContent();\n        return contentData;\n    }\n\n    /**\n    * 动画启动\n    */\n    actionStart() {\n        if (this.Label.node.getNumberOfRunningActions()) return;\n        if (this.isAction) return;\n        this._action();\n    }\n\n    /**\n     * 动画流程\n     */\n    _action() {\n\n        let content_data = this.getContent();\n        if (!content_data) {\n            this.node.parent.active = false;\n            return;\n        }\n\n        this.node.parent.active = true;\n        this.isAction = true;\n        this.Label.string = this.formatContent(content_data);\n        let movex = this.node.width / 2 + this.Label.node.width / 2 + 20;\n        this.Label.node.x = movex;\n        // let move_act = cc.moveTo(this.second, -movex, 0);\n        // let call = cc.callFunc(()=>{\n        //     if(!this.bolSpecial)ryyl.notice.removeContent();\n        //     this.isAction = false;\n        //     this._action();\n        // })\n        // this.content.runAction(cc.sequence(move_act, call))\n\n        let second = Math.floor(movex / this.moveSize)\n        cc.tween(this.Label.node)\n            .to(second, { position: cc.v2(-movex, 0) })\n            .call(() => {\n                RollNoticeLogic.removeContent();\n                this.isAction = false;\n                this._action();\n            })\n            .start();\n\n    }\n\n    formatContent(content) {\n        let newContent = content.replace(/\\[/g, \"<\")\n        newContent = newContent.replace(/\\]/g, \">\")\n        return newContent\n    }\n\n    // update (dt) {}\n}\n\nclass _RollNoticeLogic {\n    content_list = [];\n\n\n    /**\n     * 获取普通公告第一条\n     */\n    getContent() {\n        if (!this.content_list[0]) {\n            return null;\n        }\n        return this.content_list[0];\n    }\n    /**\n     * 非单局内出现的公告往后排\n     * @param strContent string 公告内容 \n     */\n    addContent = function (strContent) {\n        this.content_list.push(strContent);\n        if (this.content_list.length === 1) {\n            dispatch(\"rnotice.basestart\");\n        };\n    };\n    /**\n     * 对播放结束的列表进行清理\n     */\n    removeContent = function () {\n        if (this.content_list[0]) this.content_list.splice(0, 1);\n    };\n}\nexport const RollNoticeLogic = new _RollNoticeLogic()\n"]}