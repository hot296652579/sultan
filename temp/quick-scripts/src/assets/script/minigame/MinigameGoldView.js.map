{"version":3,"sources":["assets/script/minigame/MinigameGoldView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { LobbyService } from \"../common/net/LobbyService\";\nimport NumberUtils from \"../common/utils/NumberUtils\";\nimport TypeUtils from \"../common/utils/TypeUtils\";\nimport { ENABLE_CHANGE_LANGUAGE } from \"../framework/base/Defines\";\nimport { IController } from \"../framework/controller/Controller\";\nimport { injectService } from \"../framework/decorator/Decorators\";\nimport { EventApi } from \"../framework/event/EventApi\";\nimport UIView from \"../framework/ui/UIView\";\nimport { MinigameDefine } from \"./MinigameDefine\";\n\n// 播放金币动画等待时间（单位：毫秒）\nconst PLAY_GOLD_ANIM_WAIT_TIME: number = 2500;\n// 背景渐隐时间（单位：毫秒）\nconst BG_FADE_OUT_TIME: number = 500;\n// 最大金币动画数量\nconst MAX_GOLD_ANIM_COUNT: number = 7;\n// 每个金币间隔时间\nconst INTERVAL_GOLD_TIME: number = 80;\n// 金币飞到指定位置时间\nconst GOLD_FLY_TARGET_TIME: number = 800;\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\n@injectService(LobbyService.instance)\nexport default class MinigameGoldView extends UIView implements IController<LobbyService>{\n    service: LobbyService;\n\n    @property(cc.Sprite)\n    private imgBg: cc.Sprite = null;\n\n    @property(cc.Sprite)\n    private imgGold: cc.Sprite = null;\n\n    @property(cc.Label)\n    private labGold: cc.Label = null;\n\n    @property(cc.Prefab)\n    private pfbGoldAnim: cc.Prefab = null;\n\n    // 是否正在播放金币动画\n    private _isPlayAnim: boolean = null;\n    // 播放动画定时器\n    private _goldAnimTimer: NodeJS.Timeout = null;\n    // 金币动画列表\n    private _goldAnimList: sp.Skeleton[] = null;\n    // 目标坐标\n    private _targetPos: cc.Vec2 = null;\n    // 奖励金额\n    private _bonusGold: number = null;\n\n    public static getPrefabUrl() {\n        return \"minigame/prefabs/MinigameGoldView\";\n    }\n\n    onLoad() {\n        super.onLoad();\n\n        this.initData();\n        this.initUI();\n        this.initPreload();\n    }\n\n    start() {\n\n    }\n\n    private initData(): void {\n        this._isPlayAnim = false;\n        this._goldAnimTimer = null;\n        this._goldAnimList = [];\n        this._targetPos = null;\n        this._bonusGold = null;\n    }\n\n    private initUI(): void {\n\n    }\n\n    private initPreload(): void {\n        for (let i: number = 0; i < MAX_GOLD_ANIM_COUNT; ++i) {\n            let goldAnimItem: sp.Skeleton = cc.instantiate(this.pfbGoldAnim).getComponent(sp.Skeleton);\n            this.node.addChild(goldAnimItem.node);\n            goldAnimItem.node.active = false;\n            this._goldAnimList[i] = goldAnimItem;\n        }\n    }\n\n    protected bindingEvents(): void {\n        super.bindingEvents();\n\n        if (ENABLE_CHANGE_LANGUAGE) {\n            this.registerEvent(EventApi.CHANGE_LANGUAGE, this.onLanguageChange);\n        }\n\n    }\n\n    private onLanguageChange(): void {\n\n    }\n\n    public show(args?: any[]): void {\n        super.show(args);\n\n        this._bonusGold = args[0];\n        this._targetPos = args[1];\n\n        this.onLanguageChange();\n\n        this.refreshBonusGold();\n        this.startGoldAnimTimer();\n\n    }\n\n    private refreshBonusGold(): void {\n        this.labGold.string = `+${NumberUtils.converToC(this._bonusGold)}`;\n    }\n\n    private startGoldAnimTimer(): void {\n        this.stopGoldAnimTimer();\n        this._goldAnimTimer = setTimeout(() => {\n            this.playGoldAnim();\n        }, PLAY_GOLD_ANIM_WAIT_TIME);\n    }\n\n    private stopGoldAnimTimer(): void {\n        if (!TypeUtils.isNull(this._goldAnimTimer)) {\n            clearTimeout(this._goldAnimTimer);\n            this._goldAnimTimer = null;\n        }\n\n        this._isPlayAnim = false;\n    }\n\n    private playGoldAnim(): void {\n        if (this._isPlayAnim) {\n            return;\n        }\n\n        this.audioHelper.playEffect(MinigameDefine.Sound.FLY_GOLD, this.bundle);\n\n\n        this.imgGold.node.active = false;\n        this.labGold.node.active = false;\n        this.playBgFadeOutTween();\n        this.playAllGoldFlyPosTween(this._targetPos);\n\n        this._isPlayAnim = true;\n    }\n\n    /**\n     * 获取背景渐隐动画\n     * @returns {cc.Tween}\n     */\n    private playBgFadeOutTween(): cc.Tween {\n        return cc.tween(this.imgBg.node)\n            .to(BG_FADE_OUT_TIME / 1000, { opacity: 0 })\n            .start();\n    }\n\n    /**\n     * 播放多个金币飞到指定坐标\n     * @param targetPos {cc.Vec2} 目标坐标\n     */\n    private playAllGoldFlyPosTween(targetPos: cc.Vec2): void {\n        for (let i: number = 0; i < MAX_GOLD_ANIM_COUNT; ++i) {\n            setTimeout(() => {\n                this.playGoldFlyPosTween(i, targetPos);\n            }, INTERVAL_GOLD_TIME * i)\n        }\n    }\n\n    /**\n     * 播放单个金币飞到指定坐标\n     * @param index {number} 金币下标\n     * @param targetPos {cc.Vec2} 目标坐标\n     */\n    private playGoldFlyPosTween(index: number, targetPos: cc.Vec2): void {\n        let tween: cc.Tween = cc.tween(this._goldAnimList[index].node)\n            .set({ active: true, position: this.imgGold.node.position })\n            .to(GOLD_FLY_TARGET_TIME / 1000, { scale: 0.22, position: targetPos });\n\n        if (index >= MAX_GOLD_ANIM_COUNT - 1) {\n            tween.call(() => {\n                this.close();\n            });\n        }\n\n        tween.start();\n    }\n\n    public onClick(ButtonName: any, ButtonNode: any, data?: string): void {\n        switch (ButtonName) {\n            case \"btnPlayGoldAnim\":\n                this.playGoldAnim();\n                break;\n        }\n    }\n\n}\n"]}