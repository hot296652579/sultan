{"version":3,"sources":["assets/script/share/ShareView.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA,+DAAuE;AACvE,6DAA0D;AAE1D,kEAA2E;AAC3E,oEAA4C;AAC5C,yCAAsC;AAGtC,iDAAgD;AAChD,kEAAuD;AAEvD,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG,EAAE,CAAC,UAAU,CAAC;AAI5C,IAAqB,SAAS,GAA9B,MAAqB,SAAU,SAAQ,gBAAM;IAA7C;;QAGI,SAAI,GAAgB,IAAI,CAAC;QAGzB,SAAI,GAAa,IAAI,CAAC;QAGtB,UAAK,GAAc,IAAI,CAAC;QAGxB,YAAO,GAAY,IAAI,CAAC;QA4GxB,iBAAiB;IACrB,CAAC;IAxGU,MAAM,CAAC,YAAY;QACtB,OAAO,yBAAyB,CAAC;IACrC,CAAC;IAED,MAAM;QACF,KAAK,CAAC,MAAM,EAAE,CAAC;QACf,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QAC/B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC;QAEnD,IAAI,CAAC,SAAS,EAAE,CAAC;IACrB,CAAC;IAED,aAAa;QACT,KAAK,CAAC,aAAa,EAAE,CAAC;IAC1B,CAAC;IAED,YAAY,CAAC,GAAW;QACpB,IAAI,MAAM,GAAG,IAAI,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACzC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QACpB,MAAM,CAAC,IAAI,EAAE,CAAC;QAEd,IAAI,CAAC,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC;QACrC,KAAK;QACL,IAAI,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,cAAc,EAAE,CAAC;QAC3D,IAAI,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,cAAc,EAAE,CAAC;QAE5D,uBAAuB;QACvB,KAAK,IAAI,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,MAAM,CAAC,cAAc,EAAE,EAAE,GAAG,EAAE,EAAE;YACpD,KAAK,IAAI,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,MAAM,CAAC,cAAc,EAAE,EAAE,GAAG,EAAE,EAAE;gBACpD,IAAI,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE;oBACzB,kCAAkC;oBAClC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,CAAC,CAAC;oBACjE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,CAAC,CAAC;oBACjE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;oBACvE,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;iBACpB;aACJ;SACJ;IACL,CAAC;IAED,SAAS;QACL,IAAI,GAAG,GAAW,WAAI,CAAC,WAAW,CAAC;QACnC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;QAEvB,IAAI,GAAG,CAAC,MAAM,GAAG,EAAE,EAAE;YACjB,GAAG,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,KAAK,CAAC;SAClC;QAED,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC;IAC3B,CAAC;IAED,IAAI,CAAC,IAAI;QACL,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACjB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;QAC1B,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;IAClC,CAAC;IAED,OAAO,CAAC,IAAI,EAAE,IAAI;QACd,QAAQ,IAAI,EAAE;YACV,KAAK,OAAO;gBAAE,IAAI,CAAC,eAAe,EAAE,CAAC;gBAAC,MAAM;YAC5C,KAAK,UAAU;gBAAE,IAAI,CAAC,eAAe,EAAE,CAAC;gBAAC,MAAM;YAC/C,KAAK,WAAW;gBAAE,IAAI,CAAC,gBAAgB,EAAE,CAAC;gBAAC,MAAM;YACjD,KAAK,UAAU;gBAAE,IAAI,CAAC,eAAe,EAAE,CAAC;gBAAC,MAAM;SAClD;IACL,CAAC;IAED,eAAe;QACX,MAAM,CAAC,cAAc,CAAC,CAAC,eAAe,CAAC,mBAAS,CAAC,KAAK,EAAE,WAAI,CAAC,WAAW,EAAE,WAAI,CAAC,YAAY,CAAC,CAAC;IACjG,CAAC;IACD,gBAAgB;QACZ,CAAC,CAAC,YAAY,CAAC,SAAS,CAAC,UAAU,CAAC,WAAI,CAAC,YAAY,CAAC,CAAC;IAC3D,CAAC;IACD,eAAe;QACX,CAAC,CAAC,YAAY,CAAC,QAAQ,CAAC,UAAU,CAAC,WAAI,CAAC,YAAY,CAAC,CAAC;IAC1D,CAAC;IACD,QAAQ;QACJ,IAAI,GAAG,GAAG,4BAAY,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,MAAM,EAAE,WAAI,CAAC,OAAO,EAAE,CAAC,CAAC;QACxE,IAAI,MAAM,GAAG,4BAAY,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC;QAC/D,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,0BAAU,CAAC,KAAK,EACjC,4BAAY,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,EAC/B,MAAM,CAAC,CAAC;IAChB,CAAC;IAED;;OAEG;IACK,eAAe;QACnB,MAAM,CAAC,cAAc,CAAC,CAAC,UAAU,CAAC,WAAI,CAAC,WAAW,CAAC,CAAC;QACpD,IAAI,CAAC,iBAAiB,EAAE,CAAA;IAC5B,CAAC;IAED,KAAK;QACD,IAAG,IAAI,CAAC,OAAO,EAAC;YACZ,IAAI,aAAa,GAAG,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC;YACjE,aAAa,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,QAAQ,GAAG,mBAAI,CAAC,KAAK,CAAC,aAAa,CAAC;YAEzE,IAAI,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC;YACpF,OAAO,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,QAAQ,GAAG,mBAAI,CAAC,KAAK,CAAC,OAAO,CAAC;SAEhE;IAEL,CAAC;CAGJ,CAAA;AAtHG;IADC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC;uCACG;AAGzB;IADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;uCACG;AAGtB;IADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;wCACI;AAGxB;IADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;0CACM;AAZP,SAAS;IAF7B,OAAO;IACP,0BAAa,CAAC,2BAAY,CAAC,QAAQ,CAAC;GAChB,SAAS,CAyH7B;kBAzHoB,SAAS","file":"","sourceRoot":"/","sourcesContent":["import { protoPackage, serverType } from \"../common/net/CommonService\";\nimport { LobbyService } from \"../common/net/LobbyService\";\nimport { IController } from \"../framework/controller/Controller\";\nimport { injectService, makeKey } from \"../framework/decorator/Decorators\";\nimport UIView from \"../framework/ui/UIView\";\nimport { User } from \"../global/User\";\nimport { UtilMgr } from \"../global/UtilMgr\";\nimport PanelHelp from \"../msgbox/PanelHelp\";\nimport { shareType } from \"../platform/android\";\nimport { i18n } from \"../common/language/LanguageImpl\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\n@injectService(LobbyService.instance)\nexport default class ShareView extends UIView implements IController<LobbyService>{\n\n    @property(cc.Graphics)\n    icon: cc.Graphics = null;\n\n    @property(cc.Label)\n    link: cc.Label = null;\n\n    @property(cc.Sprite)\n    kuang: cc.Sprite = null;\n\n    @property(cc.Node)\n    panelbg: cc.Node = null;\n    \n    service: LobbyService;\n\n\n    public static getPrefabUrl() {\n        return \"share/prefabs/ShareView\";\n    }\n\n    onLoad() {\n        super.onLoad();\n        this.kuang.node.active = false;\n        this.content = this.node.getChildByName('content');\n\n        this.shareInfo();\n    }\n\n    bindingEvents() {\n        super.bindingEvents();\n    }\n\n    createQRcode(url: string) {\n        var qrcode = new window[\"QRCode\"](-1, 2);\n        qrcode.addData(url);\n        qrcode.make();\n\n        this.icon.fillColor = cc.Color.BLACK;\n        //块宽高\n        var tileW = this.icon.node.width / qrcode.getModuleCount();\n        var tileH = this.icon.node.height / qrcode.getModuleCount();\n\n        // draw in the Graphics\n        for (var row = 0; row < qrcode.getModuleCount(); row++) {\n            for (var col = 0; col < qrcode.getModuleCount(); col++) {\n                if (qrcode.isDark(row, col)) {\n                    // ctx.fillColor = cc.Color.BLACK;\n                    var w = (Math.ceil((col + 1) * tileW) - Math.floor(col * tileW));\n                    var h = (Math.ceil((row + 1) * tileW) - Math.floor(row * tileW));\n                    this.icon.rect(Math.round(col * tileW), Math.round(row * tileH), w, h);\n                    this.icon.fill();\n                }\n            }\n        }\n    }\n\n    shareInfo() {\n        let url: string = User._promoteUrl;\n        this.createQRcode(url);\n        \n        if (url.length > 24) {\n            url = url.slice(0, 24) + \"...\";\n        }\n\n        this.link.string = url;\n    }\n\n    show(args) {\n        super.show(args);\n        this.showWithAction(true);\n        this.kuang.node.active = true;\n    }\n\n    onClick(name, node) {\n        switch (name) {\n            case \"close\": this.closeWithAction(); break;\n            case \"facebook\": this.shareToFacebook(); break;\n            case \"instagram\": this.shareToInstagram(); break;\n            case \"whatsApp\": this.shareToWhatsApp(); break;\n        }\n    }\n\n    shareToFacebook() {\n        window['platformUtil'].shareToFacebook(shareType.PHOTO, User._promoteUrl, User._shareImgUrl);\n    }\n    shareToInstagram() {\n        G.ShareHelpder.instagram.shareImage(User._shareImgUrl);\n    }\n    shareToWhatsApp() {\n        G.ShareHelpder.whatsapp.shareImage(User._shareImgUrl);\n    }\n    reqShare() {\n        let req = protoPackage.hall.base.Share.create({ userId: User._userID });\n        let buffer = protoPackage.hall.base.Share.encode(req).finish();\n        this.service.sendMsg(serverType.Lobby,\n            protoPackage.hall.HallCmd.SHARE,\n            buffer);\n    }\n\n    /**\n     * 复制邀请链接\n     */\n    private onCopyInvateURL(): void {\n        window['platformUtil'].copyToClip(User._promoteUrl);\n        this.playDefaultEffect()\n    }\n\n    start() {\n        if(this.panelbg){\n            let exclusiveLink = this.panelbg.getChildByName('exclusiveLink');\n            exclusiveLink.getComponent(cc.Label).language = i18n.SHARE.EXCLUSIVELINK;\n\n            let shareTo = this.panelbg.getChildByName('layout_share').getChildByName('shareTo');\n            shareTo.getComponent(cc.Label).language = i18n.SHARE.SHARETO;\n\n        }\n        \n    }\n\n    // update (dt) {}\n}\n"]}