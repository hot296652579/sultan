{"version":3,"sources":["assets/script/withdrawal/SetSecondaryPwdView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\nimport UIView from \"../framework/ui/UIView\";\nimport SendVerificationCodePlus from \"../common/component/SendVerificationCodePlus\";\nimport { i18n } from \"../common/language/LanguageImpl\";\nimport PanelHelp from \"../msgbox/PanelHelp\";\nimport { protoPackage, serverType } from \"../common/net/CommonService\";\nimport { LobbyService } from \"../common/net/LobbyService\";\nimport { injectService, makeKey } from \"../framework/decorator/Decorators\";\nimport { IController } from \"../framework/controller/Controller\";\nimport { User } from \"../global/User\";\nimport { UtilMgr } from \"../global/UtilMgr\";\nimport { VerificationCodeType } from \"../common/component/SendVerificationCode\";\n\nconst { ccclass, property } = cc._decorator;\n\nexport enum SettSecondaryPwdType {\n    set,\n    reset,\n}\n\n@ccclass\n@injectService(LobbyService.instance)\nexport default class SetSecondaryPwdView extends UIView implements IController<LobbyService>{\n    service: LobbyService = null;\n\n    @property(cc.EditBox)\n    verCodeEditbox: cc.EditBox = null;\n\n    @property(cc.EditBox)\n    pwdEditbox: cc.EditBox = null;\n\n    @property(cc.EditBox)\n    pwdEditboxConfirm: cc.EditBox = null;\n\n    @property(cc.Node)\n    titlesNode: cc.Node = null;\n\n    @property(cc.Label)\n    lbl_restPhoneTips: cc.Label = null;\n\n\n    @property(SendVerificationCodePlus)\n    sendVerificationCode: SendVerificationCodePlus = null;\n    passwordType = SettSecondaryPwdType.set;\n\n    public static getPrefabUrl() {\n        return \"withdrawal/prefabs/SetSecondaryPwdView\";\n    }\n    onLoad() {\n        super.onLoad();\n        this.content = this.node.getChildByName('content')\n        this.initLanguage()\n    }\n    bindingEvents() {\n        super.bindingEvents();\n        this.registerEvent(makeKey(serverType.Lobby, protoPackage.hall.HallCmd.CMD_SET_SECOND_PASSWORD), this.toSetPwdRes);\n        this.registerEvent(makeKey(serverType.Lobby, protoPackage.hall.HallCmd.CMD_CHANGE_SECOND_PASSWD), this.tochangePwdRes);\n    }\n    show(args) {\n        let type = args[0];\n        this.showWithAction(true)\n        this.initView(type)\n        this.lbl_restPhoneTips.string = i18n.ACCOUNT_LOGIN.SEND_CODE_TO_PHONE + \" \" + UtilMgr.setStringCover(User._phone);\n        this.sendVerificationCode.setVerificationCodeType(VerificationCodeType.resetPwd)\n    }\n    initLanguage() {\n        this.pwdEditbox.placeholder = i18n.ACCOUNT_LOGIN.PALCE_HOLDER.PASSWORD;\n        this.verCodeEditbox.placeholder = i18n.ACCOUNT_LOGIN.PALCE_HOLDER.VER_CODE;\n        this.pwdEditboxConfirm.placeholder = i18n.ACCOUNT_LOGIN.PALCE_HOLDER.PASSWORD_CONFIRM;\n    }\n    initView(type) {\n        this.passwordType = type;\n        var titleName = 'resetPwd';\n        switch (type) {\n            case SettSecondaryPwdType.set:\n                titleName = 'setPwd';\n                break;\n            case SettSecondaryPwdType.reset:\n                break;\n        }\n        this.titlesNode.children.forEach(nd => {\n            nd.active = nd.name == titleName;\n        })\n    }\n \n    onClick(name) {\n        switch (name) {\n            case \"getCode\":\n                this.sendAccVerification();\n                break;\n            case \"close\":\n                this.closeWithAction();\n                break;\n            case \"conirm\":\n                if (this.passwordType == SettSecondaryPwdType.set) {\n                    this.toSetPwd();\n                } else {\n                    this.toFoegetOrResetPwd();\n                }\n                break;\n        }\n\n    }\n    toSetPwd() {\n        let code = this.verCodeEditbox.string;\n        if (!code) return PanelHelp.showTip(i18n.EDITBOX.VERIFINULL);\n        let passwd = this.checkPwd();\n        if (!passwd) return;\n        let req = protoPackage.hall.SetSecondPasswdReq.create({passwd: base64Encrypt(passwd),code: parseInt(code) });\n        let buffer = protoPackage.hall.SetSecondPasswdReq.encode(req).finish();\n        this.service.sendMsg(serverType.Lobby,\n            protoPackage.hall.HallCmd.CMD_SET_SECOND_PASSWORD,\n            buffer);\n    }\n    toFoegetOrResetPwd() {\n\n        let code = this.verCodeEditbox.string;\n        if (!code) return PanelHelp.showTip(i18n.EDITBOX.VERIFINULL);\n        let passwd = this.checkPwd();\n        if (!passwd) return;\n        let req = protoPackage.hall.ChangeSecondPasswdReq.create({passwd: base64Encrypt(passwd),code: parseInt(code) });\n        let buffer = protoPackage.hall.ChangeSecondPasswdReq.encode(req).finish();\n        this.service.sendMsg(serverType.Lobby,\n            protoPackage.hall.HallCmd.CMD_CHANGE_SECOND_PASSWD,\n            buffer);\n    }\n    toSetPwdRes(data) {\n        if (data.statusMsg.status == 0) {\n            PanelHelp.showTip(i18n.ACCOUNT_LOGIN.SUCCEEDED);\n            this.close()\n            User.piggyBank = true\n            // dispatch('openWithdrawalView')\n        } else {\n            G.Logger.warn(\"toSetPwdRes:\", data)\n            PanelHelp.showMsgBox('', i18n.ERRORCODE[data.statusMsg.status] );\n        }\n    }\n    tochangePwdRes(data) {\n        if (data.statusMsg.status == 0) {\n            PanelHelp.showTip(i18n.ACCOUNT_LOGIN.SUCCEEDED);\n            this.close()\n        } else {\n            G.Logger.warn(\"tochangePwdRes:\", data)\n            PanelHelp.showMsgBox('', i18n.ERRORCODE[data.statusMsg.status] );\n        }\n\n    }\n    // 验证码检查\n    checkVerification(verif) {\n        if (!verif) {\n            PanelHelp.showTip(i18n.EDITBOX.VERIFINULL);\n            return null;\n        }\n        return verif;\n    }\n    checkPwd() {\n        let passwd = this.pwdEditbox.string;\n        let passwdConfi = this.pwdEditboxConfirm.string;\n        if (passwd == '' || passwdConfi == '') {\n            PanelHelp.showTip(i18n.ACCOUNT_LOGIN.ERROR.EMPTY_PWD)\n            return \"\"\n        }\n        if (passwd != passwdConfi) {\n            PanelHelp.showTip(i18n.ACCOUNT_LOGIN.ERROR.TWO_PWD_DISACCORD)\n            return \"\"\n        }\n        return passwd\n\n    }\n    checkPhone(phone) {\n        if (!phone) {\n            PanelHelp.showTip(i18n.EDITBOX.PHONENULL);\n            return null;\n        }\n        if (phone.length < 7) {\n            PanelHelp.showTip(i18n.EDITBOX.PHONETYPEERR);\n            return null;\n        }\n        return phone;\n    }\n    sendAccVerification() {\n        // this.sendVerificationCode.doSendVerificationCode({ phone: User._phone, areaCode: User._areaCode ,type:1});\n        this.sendVerificationCode.doSendVerificationCode({ phone: User._phone, areaCode: User._areaCode });\n    }\n   \n}\n"]}