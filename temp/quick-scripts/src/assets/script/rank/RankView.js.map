{"version":3,"sources":["assets/script/rank/RankView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\nimport ScroViewCtrl from \"../common/component/ScroViewCtrl\";\nimport { i18n } from \"../common/language/LanguageImpl\";\nimport { Manager } from \"../common/manager/Manager\";\nimport { protoPackage, serverType } from \"../common/net/CommonService\";\nimport { LobbyService } from \"../common/net/LobbyService\";\nimport { BUNDLE_RESOURCES } from \"../framework/base/Defines\";\nimport { IController } from \"../framework/controller/Controller\";\nimport { injectService, makeKey } from \"../framework/decorator/Decorators\";\nimport UIView from \"../framework/ui/UIView\";\nimport { User } from \"../global/User\";\nimport { UtilMgr } from \"../global/UtilMgr\";\nimport PanelHelp from \"../msgbox/PanelHelp\";\n\nconst { ccclass, property } = cc._decorator;\n\nexport enum rankType {\n    Friends = 1,  //好友\n    Wealth = 2,   //财富\n    DayEarn = 3,  //日赚\n}\n\n@ccclass\n@injectService(LobbyService.instance)\nexport default class RankView extends UIView implements IController<LobbyService>{\n\n    @property(cc.ScrollView)\n    scrollView: cc.ScrollView = null;\n\n    @property(cc.Label)\n    myName: cc.Label = null;\n\n    @property(cc.Label)\n    myId: cc.Label = null;\n\n    @property(cc.Label)\n    myRankIndex: cc.Label = null;\n\n    @property(cc.Label)\n    myGold: cc.Label = null;\n\n    @property(cc.Label)\n    myRank: cc.Label = null;\n\n    @property(cc.Sprite)\n    myHead: cc.Sprite = null;\n\n    _rankingList: any = []\n\n    _type: number = rankType.Wealth\n\n    _page: number = 1\n\n    _pageSize: number = 50\n\n    _pageTotal: number = 0\n\n    service: LobbyService;\n\n    public static getPrefabUrl() {\n        return \"rank/prefabs/RankView\";\n    }\n\n    onLoad() {\n        super.onLoad();\n        this.content = this.node.getChildByName('content');\n        //暂时只显示50条  先不做分页  后面有需要再加\n        //this.scrollView.node.on('bounce-bottom', this.onBounceBottom, this)\n    }\n\n    bindingEvents() {\n        super.bindingEvents();\n        this.registerEvent(makeKey(serverType.Lobby, protoPackage.hall.HallCmd.RANKING_LIST), this.updateList);\n        this.registerEvent(\"updateUserInfo\", this.updateUserInfo);\n\n    }\n    updateUserInfo() {\n        this.myName.string = UtilMgr.setString(User._userName);\n        this.myId.string = User._userID || '';\n        this.myGold.string = User.isRechargedPlayer ? UtilMgr.changeMoney(User._gold) : i18n.EXPERIENCE_FIELD.NoGold;\n        UtilMgr.loadHeadImg(this.myHead, User._headImgUrl, User._userID, this)\n    }\n    updateList(data) {\n        cc.log(data, \"Rank\")\n        if (data) {\n            if (data.statusMsg.status == 0) {\n                if (data.rankingList.length > 0) {\n                    this._rankingList = data.rankingList\n                    this._page = data.currPage\n                    this._pageTotal = data.total\n\n                    let meRankIndex = this.getMeRankIndex()\n                    this.myRankIndex.string = meRankIndex;\n\n                    //处理分页排行id\n                    data.rankingList.forEach((element) => {\n                        element.id = this._pageSize * (this._page - 1) + element.id\n                    });\n\n                    this.rankView(data.rankingList)\n                }\n            } else {\n                PanelHelp.showMsgBox('', Manager.makeLanguage(\"ERRORCODE.\" + data.statusMsg.status));\n            }\n        }\n    }\n\n    getMeRankIndex() {\n        let rankIndex = \"50+\"\n        for (let i = 0; i < this._rankingList.length; i++) {\n            let rankInfo = this._rankingList[i]\n            if (rankInfo.userId == User._userID) {\n                rankIndex = this._pageSize * (this._page - 1) + rankInfo.id\n                break;\n            }\n        }\n        return rankIndex\n    }\n\n    async rankView(rankingList) {\n        let scroViewCtrlCom = this.getComponent(ScroViewCtrl)\n        scroViewCtrlCom.dataList = rankingList\n        await scroViewCtrlCom.framingLoad(rankingList.length, false)\n        PanelHelp.hideLoading()\n    }\n\n    show(args) {\n        super.show(args);\n        this.showWithAction(true);\n    }\n\n    onBounceBottom() {\n        if (this._pageTotal > this._page) {\n            this._page = this._page + 1\n            this.refreshRank()\n        }\n    }\n\n    onClick(name, node) {\n        switch (name) {\n            case \"close\": this.closeWithAction(); break;\n\n            default: G.Logger.error(\"no find button name -> %s\", name);\n        }\n    }\n\n    refreshRank() {\n        let req = protoPackage.hall.base.RankingList.create({ userId: User._userID, type: this._type, page: this._page, size: this._pageSize });\n        let buffer = protoPackage.hall.base.RankingList.encode(req).finish();\n        this.service.sendMsg(serverType.Lobby,\n            protoPackage.hall.HallCmd.RANKING_LIST,\n            buffer);\n    }\n\n    start() {\n        this.myName.string = UtilMgr.setString(User._userName);\n        this.myId.string = User._userID || '';\n        this.myGold.string = User.isRechargedPlayer ? UtilMgr.changeMoney(User._gold) : i18n.EXPERIENCE_FIELD.NoGold;\n        UtilMgr.loadHeadImg(this.myHead, User._headImgUrl, User._userID, this)\n        PanelHelp.showLoading(i18n.WAIT.LOADING)\n        this.refreshRank()\n\n        this.myRank.language = i18n.RANK.MYRANK;\n    }\n\n    // update (dt) {}\n}\n"]}