{"version":3,"sources":["assets/script/common/bindItemView/BindEmailView.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA,mEAA2C;AAG3C,4DAAsD;AACtD,uEAA+C;AAG/C,sEAA8C;AAC9C,uEAA+C;AAC/C,+EAAuD;AACvD,2DAAgD;AAChD,gDAA6C;AAC7C,sDAAmD;AAGnD,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG,EAAE,CAAC,UAAU,CAAC;AAG5C,IAAqB,aAAa,GAAlC,MAAqB,aAAc,SAAQ,gBAAM;IAAjD;;QAOI,iBAAY,GAAe,IAAI,CAAC;QAChC,eAAU,GAAW,EAAE,CAAC;QAGxB,iBAAY,GAAY,IAAI,CAAC;QAG7B,gBAAW,GAAe,IAAI,CAAC;QAC/B,cAAS,GAAW,EAAE,CAAC;QACvB,OAAO;QACC,cAAS,GAAa,IAAI,CAAC;QA+KnC,iBAAiB;IACrB,CAAC;IA/LU,MAAM,CAAC,YAAY;QACtB,OAAO,8BAA8B,CAAC;IAC1C,CAAC;IAeD,MAAM;QACF,KAAK,CAAC,MAAM,EAAE,CAAC;QACf,IAAI,CAAC,UAAU,EAAE,CAAC;QAClB,IAAI,CAAC,QAAQ,EAAE,CAAC;QAEhB,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,KAAK,CAAC;IACrC,CAAC;IAED,KAAK;IAEL,CAAC;IAEM,IAAI,CAAC,IAAY;QACpB,sBAAsB;QACtB,uDAAuD;QACvD,uDAAuD;QAEvD,IAAI,CAAC,sBAAsB,EAAE,CAAC;IAClC,CAAC;IAED,UAAU;QACN,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC,mBAAmB,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;QACxE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC,mBAAmB,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;QACxE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC,gBAAgB,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;QACrE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC,cAAc,EAAE,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;QAErE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,mBAAmB,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;QACtE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,mBAAmB,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;QACtE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,gBAAgB,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;QACnE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,cAAc,EAAE,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;IACvE,CAAC;IAES,aAAa;QACnB,KAAK,CAAC,aAAa,EAAE,CAAC;QACtB,IAAI,CAAC,aAAa,CAAC,qBAAqB,EAAE,IAAI,CAAC,qBAAqB,CAAC,CAAC;QACtE,IAAI,CAAC,aAAa,CAAC,wBAAwB,EAAE,IAAI,CAAC,wBAAwB,CAAC,CAAC;IAChF,CAAC;IAEO,QAAQ;QACZ,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,kBAAQ,CAAC,CAAC;IAC7C,CAAC;IAED,sBAAsB;QAClB,IAAI,GAAG,GAAG,YAAG,CAAC,2BAA2B,CAAC,MAAM,CAAC;YAC7C,MAAM,EAAE,iBAAO,CAAC,UAAU,CAAC,WAAW,EAAE;SAC3C,CAAC,CAAC;QACH,IAAI,MAAM,GAAG,YAAG,CAAC,2BAA2B,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC;QAClE,2BAAY,CAAC,QAAQ,CAAC,OAAO,CAAC,YAAG,CAAC,2BAA2B,EAAE,YAAG,CAAC,iBAAiB,CAAC,2BAA2B,EAAE,MAAM,CAAC,CAAC;IAC9H,CAAC;IAEO,YAAY,CAAC,MAAkB;QACnC,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC;IAC/C,CAAC;IAEO,YAAY,CAAC,MAAkB;QACnC,IAAI,IAAI,CAAC,UAAU,CAAC,MAAM,IAAI,CAAC,EAAE;YAC7B,OAAO;SACV;QAED,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC;IAC/C,CAAC;IAEO,cAAc,CAAC,OAAmB;QACtC,IAAI,CAAC,UAAU,GAAG,OAAO,CAAC,MAAM,CAAC;IACrC,CAAC;IACO,WAAW,CAAC,MAAkB;QAClC,IAAI,CAAC,WAAW,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC;IAC7C,CAAC;IAEO,WAAW,CAAC,MAAkB;QAClC,IAAI,IAAI,CAAC,SAAS,CAAC,MAAM,IAAI,CAAC,EAAE;YAC5B,OAAO;SACV;QAED,IAAI,CAAC,WAAW,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC;IAC7C,CAAC;IAEO,aAAa,CAAC,OAAmB;QACrC,IAAI,CAAC,SAAS,GAAG,OAAO,CAAC,MAAM,CAAC;IACpC,CAAC;IAED,OAAO,CAAC,IAAY;QAChB,QAAQ,IAAI,EAAE;YACV,KAAK,UAAU;gBACX,IAAI,CAAC,KAAK,EAAE,CAAC;gBACb,MAAM;YACV,KAAK,SAAS;gBACV,IAAI,CAAC,YAAY,EAAE,CAAC;gBACpB,MAAM;YACV,KAAK,YAAY;gBACb,IAAI,CAAC,YAAY,EAAE,CAAC;gBACpB,MAAM;SACb;IACL,CAAC;IAED,YAAY;QACR,IAAI,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC;QAC/B,IAAI,SAAS,GAAG,IAAI,mBAAS,EAAE,CAAC;QAEhC,SAAS,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;gBACrB,QAAQ,EAAE,YAAY;gBACtB,QAAQ,EAAE,mBAAI,CAAC,QAAQ,CAAC,qBAAqB;aAChD,CAAC,CAAC,CAAC;QAEJ,IAAI,QAAQ,GAAG,SAAS,CAAC,KAAK,EAAE,CAAC;QACjC,IAAI,QAAQ,EAAE;YACV,mBAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;YAC5B,OAAO;SACV;QACD,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,GAAG,GAAG,YAAG,CAAC,gBAAgB,CAAC,MAAM,CAAC;YAClC,MAAM,EAAE,iBAAO,CAAC,UAAU,CAAC,WAAW,EAAE;YACxC,QAAQ;SACX,CAAC,CAAC;QACH,IAAI,MAAM,GAAG,YAAG,CAAC,gBAAgB,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC;QACvD,2BAAY,CAAC,QAAQ,CAAC,OAAO,CAAC,YAAG,CAAC,gBAAgB,EAAE,YAAG,CAAC,iBAAiB,CAAC,gBAAgB,EAAE,MAAM,CAAC,CAAC;IACxG,CAAC;IAED,cAAc;QACV,IAAI,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,uBAAa,CAAC,CAAC;QAC3D,MAAM,CAAC,YAAY,EAAE,CAAC;IAC1B,CAAC;IAGD,YAAY;QACR,IAAI,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC;QAC/B,IAAI,SAAS,GAAG,IAAI,mBAAS,EAAE,CAAC;QAEhC,IAAI,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC;QAC1B,SAAS,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;gBACjB,QAAQ,EAAE,YAAY;gBACtB,QAAQ,EAAE,mBAAI,CAAC,QAAQ,CAAC,oBAAoB;aAC/C,CAAC,CAAC,CAAC;QAEJ,SAAS,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;gBACrB,QAAQ,EAAE,YAAY;gBACtB,QAAQ,EAAE,mBAAI,CAAC,QAAQ,CAAC,qBAAqB;aAChD,CAAC,CAAC,CAAC;QACJ,SAAS,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;gBACrB,QAAQ,EAAE,SAAS;gBACnB,QAAQ,EAAE,mBAAI,CAAC,QAAQ,CAAC,UAAU;aACrC,CAAC,CAAC,CAAC;QAEJ,IAAI,QAAQ,GAAG,SAAS,CAAC,KAAK,EAAE,CAAC;QACjC,IAAI,QAAQ,EAAE;YACV,mBAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;YAC5B,OAAO;SACV;QAED,IAAI,CAAC,gBAAgB,EAAE,CAAC;IAC5B,CAAC;IAED,gBAAgB;QACZ,IAAI,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC;QAC5B,IAAI,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;QAC/B,IAAI,GAAG,GAAG,YAAG,CAAC,aAAa,CAAC,MAAM,CAAC;YAC/B,MAAM,EAAE,iBAAO,CAAC,UAAU,CAAC,WAAW,EAAE;YACxC,KAAK;YACL,SAAS;SACZ,CAAC,CAAC;QACH,IAAI,MAAM,GAAG,YAAG,CAAC,aAAa,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC;QACpD,2BAAY,CAAC,QAAQ,CAAC,OAAO,CAAC,YAAG,CAAC,aAAa,EAAE,YAAG,CAAC,iBAAiB,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC;IAClG,CAAC;IAED,qBAAqB;QACjB,mBAAS,CAAC,OAAO,CAAC,mBAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;QAC7C,IAAI,CAAC,KAAK,EAAE,CAAC;IACjB,CAAC;IAED,wBAAwB;QACpB,mBAAS,CAAC,OAAO,CAAC,mBAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;IAC3C,CAAC;CAGJ,CAAA;AA1LG;IADC,QAAQ,CAAC,EAAE,CAAC,OAAO,CAAC;mDACW;AAIhC;IADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;mDACW;AAG7B;IADC,QAAQ,CAAC,EAAE,CAAC,OAAO,CAAC;kDACU;AAdd,aAAa;IADjC,OAAO;GACa,aAAa,CAiMjC;kBAjMoB,aAAa","file":"","sourceRoot":"/","sourcesContent":["import UserData from \"../../data/UserData\";\nimport { BUNDLE_RESOURCES } from \"../../framework/base/Defines\";\nimport { IController } from \"../../framework/controller/Controller\";\nimport { MST } from \"../../framework/external/protoc\";\nimport UIView from \"../../framework/ui/UIView\";\nimport { UtilMgr } from \"../../global/UtilMgr\";\nimport LoginNewView from \"../../login/LoginNewView\";\nimport Validator from \"../../login/Validator\";\nimport PanelHelp from \"../../msgbox/PanelHelp\";\nimport CountDownCode from \"../component/CountDownCode\";\nimport { i18n } from \"../language/LanguageImpl\";\nimport { Manager } from \"../manager/Manager\";\nimport { LobbyService } from \"../net/LobbyService\";\nimport NumberUtils from \"../utils/NumberUtils\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class BindEmailView extends UIView implements IController<LobbyService>{\n    service: LobbyService;\n    public static getPrefabUrl() {\n        return \"common/prefabs/BindEmailView\";\n    }\n\n    @property(cc.EditBox)\n    emailEditBox: cc.EditBox = null;\n    m_emailStr: string = \"\";\n\n    @property(cc.Node)\n    btnCountDown: cc.Node = null;\n\n    @property(cc.EditBox)\n    codeEditBox: cc.EditBox = null;\n    m_codeStr: string = \"\";\n    // 用户数据\n    private _userData: UserData = null;\n\n    onLoad() {\n        super.onLoad();\n        this.bindEvents();\n        this.initData();\n\n        this.btnCountDown.active = false;\n    }\n\n    start() {\n\n    }\n\n    public show(args?: any[]): void {\n        // let type = args[0];\n        // this.phoneEditBox.node.active = type == 'BindPhone';\n        // this.emailEditBox.node.active = type == 'BindEmail';\n\n        this.requestGetRewardConfig();\n    }\n\n    bindEvents() {\n        this.emailEditBox.node.on(\"editing-did-began\", this.onEmailBegan, this);\n        this.emailEditBox.node.on(\"editing-did-ended\", this.onEmailEnded, this);\n        this.emailEditBox.node.on(\"editing-return\", this.onEmailEnded, this);\n        this.emailEditBox.node.on(\"text-changed\", this.onEmailChanged, this);\n\n        this.codeEditBox.node.on(\"editing-did-began\", this.onCodeBegan, this);\n        this.codeEditBox.node.on(\"editing-did-ended\", this.onCodeEnded, this);\n        this.codeEditBox.node.on(\"editing-return\", this.onCodeEnded, this);\n        this.codeEditBox.node.on(\"text-changed\", this.onCodeChanged, this);\n    }\n\n    protected bindingEvents(): void {\n        super.bindingEvents();\n        this.registerEvent(\"Event_S2C_BindEmail\", this.onEvent_S2C_BindEmail);\n        this.registerEvent(\"Event_S2C_GetCheckCode\", this.onEvent_S2C_GetCheckCode);\n    }\n\n    private initData(): void {\n        this._userData = G.DataMgr.get(UserData);\n    }\n\n    requestGetRewardConfig() {\n        let req = MST.C2S_GetRegisterRewardConfig.create({\n            serial: Manager.netManager.getNewSeqId()\n        });\n        let buffer = MST.C2S_GetRegisterRewardConfig.encode(req).finish();\n        LobbyService.instance.sendMsg(MST.C2S_GetRegisterRewardConfig, MST.OuterOpcode_Lobby.C2S_GetRegisterRewardConfig, buffer);\n    }\n\n    private onEmailBegan(target: cc.EditBox): void {\n        this.emailEditBox.string = this.m_emailStr;\n    }\n\n    private onEmailEnded(target: cc.EditBox): void {\n        if (this.m_emailStr.length <= 0) {\n            return;\n        }\n\n        this.emailEditBox.string = this.m_emailStr;\n    }\n\n    private onEmailChanged(content: cc.EditBox): void {\n        this.m_emailStr = content.string;\n    }\n    private onCodeBegan(target: cc.EditBox): void {\n        this.codeEditBox.string = this.m_codeStr;\n    }\n\n    private onCodeEnded(target: cc.EditBox): void {\n        if (this.m_codeStr.length <= 0) {\n            return;\n        }\n\n        this.codeEditBox.string = this.m_codeStr;\n    }\n\n    private onCodeChanged(content: cc.EditBox): void {\n        this.m_codeStr = content.string;\n    }\n\n    onClick(name: string): void {\n        switch (name) {\n            case \"btnClose\":\n                this.close();\n                break;\n            case \"btnBind\":\n                this.clickBtnBind();\n                break;\n            case 'btnGetCode':\n                this.clickGetCode();\n                break;\n        }\n    }\n\n    clickGetCode() {\n        let username = this.m_emailStr;\n        let validator = new Validator();\n\n        validator.add(username, [{\n            strategy: 'isNonEmpty',\n            errorMsg: i18n.REGISTER.EMAILINFORMATIONEMPTY\n        }]);\n\n        let errorMsg = validator.start();\n        if (errorMsg) {\n            PanelHelp.showTip(errorMsg);\n            return;\n        }\n        this.startCountDown();\n        let req = MST.C2S_GetCheckCode.create({\n            serial: Manager.netManager.getNewSeqId(),\n            username\n        });\n        let buffer = MST.C2S_GetCheckCode.encode(req).finish();\n        LobbyService.instance.sendMsg(MST.C2S_GetCheckCode, MST.OuterOpcode_Lobby.C2S_GetCheckCode, buffer);\n    }\n\n    startCountDown() {\n        let common = this.btnCountDown.getComponent(CountDownCode);\n        common._doStartTime();\n    }\n\n\n    clickBtnBind() {\n        let username = this.m_emailStr;\n        let validator = new Validator();\n\n        let Code = this.m_codeStr;\n        validator.add(Code, [{\n            strategy: 'isNonEmpty',\n            errorMsg: i18n.REGISTER.CODEINFORMATIONEMPTY\n        }]);\n\n        validator.add(username, [{\n            strategy: 'isNonEmpty',\n            errorMsg: i18n.REGISTER.EMAILINFORMATIONEMPTY\n        }]);\n        validator.add(username, [{\n            strategy: 'isEmail',\n            errorMsg: i18n.REGISTER.EMAILWRONG\n        }]);\n\n        let errorMsg = validator.start();\n        if (errorMsg) {\n            PanelHelp.showTip(errorMsg);\n            return;\n        }\n\n        this.requestBindEmail();\n    }\n\n    requestBindEmail() {\n        let email = this.m_emailStr;\n        let checkCode = this.m_codeStr;\n        let req = MST.C2S_BindEmail.create({\n            serial: Manager.netManager.getNewSeqId(),\n            email,\n            checkCode\n        });\n        let buffer = MST.C2S_BindEmail.encode(req).finish();\n        LobbyService.instance.sendMsg(MST.C2S_BindEmail, MST.OuterOpcode_Lobby.C2S_BindEmail, buffer);\n    }\n\n    onEvent_S2C_BindEmail() {\n        PanelHelp.showTip(i18n.REGISTER.BINDSUCCESS);\n        this.close();\n    }\n\n    onEvent_S2C_GetCheckCode() {\n        PanelHelp.showTip(i18n.TIPS.SENDCHECK);\n    }\n\n    // update (dt) {}\n}\n"]}