{"version":3,"sources":["assets/script/piggyBank/PBChangePasswdView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { i18n } from \"../common/language/LanguageImpl\";\nimport { Manager } from \"../common/manager/Manager\";\nimport { protoPackage, serverType } from \"../common/net/CommonService\";\nimport { LobbyService } from \"../common/net/LobbyService\";\nimport { injectService, makeKey } from \"../framework/decorator/Decorators\";\nimport UIView from \"../framework/ui/UIView\";\nimport PanelHelp from \"../msgbox/PanelHelp\";\nimport PBPasswdComponent from \"./PBPasswdComponent\";\n\nconst { ccclass, property } = cc._decorator;\n\nconst MAX_DIGIT: number = 6;\n\n@ccclass\n@injectService(LobbyService.instance)\nexport default class PBChangePasswdView extends UIView {\n    service: LobbyService;\n\n    @property(cc.EditBox)\n    private edbPasswd1: cc.EditBox = null;\n\n    @property(cc.EditBox)\n    private edbPasswd2: cc.EditBox = null;\n\n    @property(cc.EditBox)\n    private edbPasswd3: cc.EditBox = null;\n\n    public static getPrefabUrl() {\n        return \"piggyBank/prefabs/PBChangePasswdView\";\n    }\n\n    onLoad() {\n        super.onLoad();\n        this.content = this.node.getChildByName('imgBg');\n    }\n\n    start() {\n\n    }\n\n    bindingEvents() {\n        this.registerEvent(makeKey(serverType.Lobby, protoPackage.hall.HallCmd.CMD_CHANGE_PASSWD), this.onChangePasswd);\n    }\n\n    show(): void {\n        this.showWithAction(true);\n        super.show();\n    }\n\n    onClickClose(): void {\n        this.playDefaultEffect(\"close\");\n        this.closeWithAction();\n    }\n\n    onClickOK(): void {\n        this.playDefaultEffect();\n\n        let edbComponent1: PBPasswdComponent = this.edbPasswd1.getComponent(PBPasswdComponent);\n        let edbComponent2: PBPasswdComponent = this.edbPasswd2.getComponent(PBPasswdComponent);\n        let edbComponent3: PBPasswdComponent = this.edbPasswd3.getComponent(PBPasswdComponent);\n\n        if (this.isPasswordNull(edbComponent1.string) ||\n            this.isPasswordNull(edbComponent2.string) ||\n            this.isPasswordNull(edbComponent3.string)) {\n            PanelHelp.showTip(i18n.PIGGY_BANK.PLEASE_ENTER_PASSWORD);\n            return;\n        }\n\n        if (!this.isPasswordDigit(edbComponent1.string) ||\n            !this.isPasswordDigit(edbComponent2.string) ||\n            !this.isPasswordDigit(edbComponent3.string)) {\n            PanelHelp.showTip(i18n.PIGGY_BANK.PASSWORD_INCOMPLETE);\n            return;\n        }\n\n        if (this.isPasswordSame(edbComponent1.string, edbComponent2.string, edbComponent3.string)) {\n            PanelHelp.showTip(i18n.PIGGY_BANK.OLD_NEW_PASSWD_SAME);\n            return;\n        }\n\n        if (!this.isPasswordSame(edbComponent2.string, edbComponent3.string)) {\n            PanelHelp.showTip(i18n.PIGGY_BANK.NEW_PASSWD_DIFF);\n            return;\n        }\n\n        let req = protoPackage.hall.ChangePasswdReq.create({ oldPasswd: edbComponent1.string, newPasswd: edbComponent2.string });\n        let buffer = protoPackage.hall.ChangePasswdReq.encode(req).finish();\n        this.service.sendMsg(serverType.Lobby,\n            protoPackage.hall.HallCmd.CMD_CHANGE_PASSWD,\n            buffer);\n    }\n\n    private onChangePasswd(data): void {\n        if (data.statusMsg.status !== 0) {\n            PanelHelp.showTip(Manager.makeLanguage(\"ERRORCODE.\" + data.statusMsg.status));\n            return;\n        }\n        PanelHelp.showTip(i18n.PIGGY_BANK.CHANGE_SUCCESS);\n        this.closeWithAction();\n    }\n\n    /**\n     * 是否密码一致\n     * @return {boolean}\n     */\n    private isPasswordSame(...args: string[]): boolean {\n        let isSame: boolean = true;\n        let str: string = args[0];\n        for (let i: number = 1; i < args.length; ++i) {\n            if (args[i] !== str) {\n                isSame = false;\n                break;\n            }\n        }\n        return isSame;\n    }\n\n    /**\n     * 是否6满足位数\n     */\n    private isPasswordDigit(str: string): boolean {\n        if (str.length !== MAX_DIGIT) {\n            return false;\n        }\n\n        return true;\n    }\n\n    /**\n     * 密码是否为空\n     */\n    private isPasswordNull(str: string = \"\"): boolean {\n        if (str.length <= 0) {\n            return true;\n        }\n        return false;\n    }\n}\n"]}