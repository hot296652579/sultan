{"version":3,"sources":["assets/script/piggyBank/PBSettingPasswdView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { i18n } from \"../common/language/LanguageImpl\";\nimport { Manager } from \"../common/manager/Manager\";\nimport { protoPackage, serverType } from \"../common/net/CommonService\";\nimport { LobbyService } from \"../common/net/LobbyService\";\nimport { BUNDLE_RESOURCES } from \"../framework/base/Defines\";\nimport { injectService, makeKey } from \"../framework/decorator/Decorators\";\nimport UIView from \"../framework/ui/UIView\";\nimport { User } from \"../global/User\";\nimport PanelHelp from \"../msgbox/PanelHelp\";\nimport PBPasswdComponent from \"./PBPasswdComponent\";\nimport PiggyBankView from \"./PiggyBankView\";\n\nconst { ccclass, property } = cc._decorator;\n\nconst MAX_DIGIT: number = 6;\n\n@ccclass\n@injectService(LobbyService.instance)\nexport default class PBSettingPasswdView extends UIView {\n    service: LobbyService;\n\n    @property(cc.EditBox)\n    private edbPasswd1: cc.EditBox = null;\n\n    @property(cc.EditBox)\n    private edbPasswd2: cc.EditBox = null;\n\n    private edbComponent1: PBPasswdComponent = null;\n    private edbComponent2: PBPasswdComponent = null;\n\n    public static getPrefabUrl() {\n        return \"piggyBank/prefabs/PBSettingPasswdView\";\n    }\n\n    onLoad() {\n        super.onLoad();\n        this.content = this.node.getChildByName('imgBg');\n        this.initView();\n    }\n\n    start() {\n\n    }\n\n    initView(): void {\n        this.edbComponent1 = this.edbPasswd1.getComponent(PBPasswdComponent);\n        this.edbComponent2 = this.edbPasswd2.getComponent(PBPasswdComponent);\n    }\n\n    bindingEvents() {\n        super.bindingEvents();\n\n        this.registerEvent(makeKey(serverType.Lobby, protoPackage.hall.HallCmd.CMD_SETTING_PASSWD), this.onSettingPasswd);\n        this.registerEvent(makeKey(serverType.Lobby, protoPackage.hall.HallCmd.CMD_TOTAL_AMOUNT), this.onTotalAmount);\n    }\n\n    show(): void {\n        super.show();\n        this.showWithAction(true);\n    }\n\n    onClickClose(): void {\n        this.playDefaultEffect(\"close\");\n        this.closeWithAction();\n    }\n\n    onClickOK(): void {\n        this.playDefaultEffect();\n\n        if (!this.isPasswordSame()) {\n            PanelHelp.showTip(i18n.PIGGY_BANK.INCONSISTENT_PASSWORD);\n            return;\n        }\n        if (!this.isPasswordDigit()) {\n            PanelHelp.showTip(i18n.PIGGY_BANK.PASSWORD_INCOMPLETE);\n            return;\n        }\n\n        let req = protoPackage.hall.SettingPasswdReq.create({ passwd: this.edbComponent1.string });\n        let buffer = protoPackage.hall.SettingPasswdReq.encode(req).finish();\n        this.service.sendMsg(serverType.Lobby,\n            protoPackage.hall.HallCmd.CMD_SETTING_PASSWD,\n            buffer);\n    }\n\n    onSettingPasswd(data): void {\n        if (data.statusMsg.status !== 0) {\n            PanelHelp.showTip(Manager.makeLanguage(\"ERRORCODE.\" + data.statusMsg.status));\n            return;\n        }\n\n        User.piggyBank = true;\n        this.close();\n\n        this.service.sendMsg(serverType.Lobby,\n            protoPackage.hall.HallCmd.CMD_TOTAL_AMOUNT,\n            null);\n    }\n\n    onTotalAmount(data): void {\n        if (data.statusMsg.status !== 0) {\n            PanelHelp.showTip(Manager.makeLanguage(\"ERRORCODE.\" + data.statusMsg.status));\n            return;\n        }\n\n        Manager.uiManager.open({ type: PiggyBankView, bundle: BUNDLE_RESOURCES, args: data });\n    }\n\n    /**\n     * 是否密码一致\n     * @return {boolean}\n     */\n    private isPasswordSame(): boolean {\n        return this.edbComponent1.string === this.edbComponent2.string;\n    }\n\n    /**\n     * 是否6满足位数\n     */\n    private isPasswordDigit(): boolean {\n        let str1: string = this.edbComponent1.string;\n        if (str1.length !== MAX_DIGIT) {\n            return false;\n        }\n\n        let str2: string = this.edbComponent2.string;\n        if (str2.length !== MAX_DIGIT) {\n            return false;\n        }\n\n        return true;\n    }\n}\n"]}