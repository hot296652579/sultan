{"version":3,"sources":["assets/games/roulette/protocol/RouletteNetController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\nimport { Manager } from \"../../../script/common/manager/Manager\";\nimport { CmdResStruct } from \"../../../script/common/net/CmdResStruct\";\nimport { LobbyService } from \"../../../script/common/net/LobbyService\";\nimport UserData from \"../../../script/data/UserData\";\nimport Controller from \"../../../script/framework/controller/Controller\";\nimport { injectService } from \"../../../script/framework/decorator/Decorators\";\nimport { MST } from \"../../../script/framework/external/protoc\";\nimport PanelHelp from \"../../../script/msgbox/PanelHelp\";\nimport RouletteData from \"../script/data/RouletteData\";\nimport { RouletteInterface } from \"../script/interface/RouletteInterface\";\n\n/**\n * @description 逻辑流程控制器  \n */\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\n@injectService(LobbyService.instance)\nexport default class RouletteNetController extends Controller<LobbyService> {\n\n    protected bindingEvents() {\n        super.bindingEvents()\n        this.registerRes();\n        this.registerEvent(MST.OuterOpcode_Map.M2C_TransferMap_Res, this.onM2C_TransferMap_Res);\n        this.registerEvent(MST.OuterOpcode_Roulette.M2C_GetRouletteInfo_Res, this.onM2C_GetRouletteInfo_Res);\n        this.registerEvent(MST.OuterOpcode_Roulette.M2C_RouletteStartBet_Mes, this.onM2C_RouletteStartBet_Mes);\n        this.registerEvent(MST.OuterOpcode_Roulette.M2C_MyRouletteBet_Res, this.onM2C_MyRouletteBet_Res);\n        this.registerEvent(MST.OuterOpcode_Roulette.M2C_RouletteStart_mes, this.onM2C_RouletteStart_mes);\n        this.registerEvent(MST.OuterOpcode_Roulette.R2C_PaybackPhase_Mes, this.onR2C_PaybackPhase_Mes);\n        this.registerEvent(MST.OuterOpcode_Roulette.R2C_Bet_Mes, this.onR2C_Bet_Mes);\n        this.registerEvent(MST.OuterOpcode_Roulette.R2C_GetBetRandInfo_Res, this.onR2C_GetBetRandInfo_Res);\n        this.registerEvent(MST.OuterOpcode_Roulette.R2C_GetGameRecords_Res, this.onR2C_GetGameRecords_Res);\n        this.registerEvent(MST.OuterOpcode_Roulette.R2C_GetBetInfo_Res, this.onR2C_GetBetInfo_Res);\n    }\n\n    private registerRes() {\n        CmdResStruct.register(MST.OuterOpcode_Map.M2C_TransferMap_Res, MST.M2C_TransferMap_Res);\n        CmdResStruct.register(MST.OuterOpcode_Roulette.M2C_GetRouletteInfo_Res, MST.M2C_GetRouletteInfo_Res);\n        CmdResStruct.register(MST.OuterOpcode_Roulette.M2C_RouletteStartBet_Mes, MST.M2C_RouletteStartBet_Mes);\n        CmdResStruct.register(MST.OuterOpcode_Roulette.M2C_MyRouletteBet_Res, MST.M2C_MyRouletteBet_Res);\n        CmdResStruct.register(MST.OuterOpcode_Roulette.M2C_RouletteStart_mes, MST.M2C_RouletteStart_mes);\n        CmdResStruct.register(MST.OuterOpcode_Roulette.R2C_PaybackPhase_Mes, MST.R2C_PaybackPhase_Mes);\n        CmdResStruct.register(MST.OuterOpcode_Roulette.R2C_Bet_Mes, MST.R2C_Bet_Mes);\n        CmdResStruct.register(MST.OuterOpcode_Roulette.R2C_GetBetRandInfo_Res, MST.R2C_GetBetRandInfo_Res);\n        CmdResStruct.register(MST.OuterOpcode_Roulette.R2C_GetGameRecords_Res, MST.R2C_GetGameRecords_Res);\n        CmdResStruct.register(MST.OuterOpcode_Roulette.R2C_GetBetInfo_Res, MST.R2C_GetBetInfo_Res);\n    }\n\n    public onM2C_TransferMap_Res(data: MST.IM2C_TransferMap_Res) {\n        let userData = G.DataMgr.get(UserData);\n        userData.inGame = data.RoomName;\n        dispatch(\"Event_M2C_TransferMap_Res\", data);\n    }\n\n    onM2C_GetRouletteInfo_Res(data: MST.IM2C_GetRouletteInfo_Res) {\n        if (data.Error !== 0) {\n            PanelHelp.showErrTip(data.Error);\n            return\n        }\n\n        let rouletteData = G.DataMgr.get(RouletteData);\n        rouletteData.Status = data.Status;\n        rouletteData.EndTimeStamp = data.EndTimeStamp;\n        rouletteData.gameRecordList.length = 0;\n\n        rouletteData.onRoomBets = [];\n        for (let v of data.Bets) {\n            let betPlayer: RouletteInterface.BetPlayer = {\n                betInfo: v,\n            }\n            rouletteData.onRoomBets.push(betPlayer);\n        }\n        rouletteData.onRoomBets.reverse();\n\n        rouletteData.onRoomTotalBet = data.betRecord;\n        rouletteData.gameRecordList = [].concat(data.MultipleRecord);\n        rouletteData.curRound = data.round;\n        rouletteData.hashSalt = data.hashSalt;\n        rouletteData.randomNum = data.randomNo;\n        rouletteData.roundHash = data.roundHash;\n\n        if (data.Status == MST.RouletteStatus.BetPhase) {\n            rouletteData.stopBetTimeStamp = Number(data.EndTimeStamp);\n        }\n\n        dispatch(\"Event_M2C_GetRouletteInfo_Res\");\n    }\n\n    onM2C_RouletteStartBet_Mes(data: MST.M2C_RouletteStartBet_Mes) {\n        let rouletteData = G.DataMgr.get(RouletteData);\n        rouletteData.Status = MST.RouletteStatus.BetPhase;\n        rouletteData.stopBetTimeStamp = Number(data.StopBetTimeStamp);\n        rouletteData.roundHash = data.randHash;\n\n        rouletteData.clearRouletteData();\n        dispatch(\"Event_M2C_RouletteStartBet_Mes\");\n    }\n\n    onM2C_MyRouletteBet_Res(data: MST.M2C_MyRouletteBet_Res) {\n        if (data.Error !== 0) {\n            PanelHelp.showErrTip(data.Error);\n            return\n        }\n    }\n\n    onM2C_RouletteStart_mes(data: MST.M2C_RouletteStart_mes) {\n        let rouletteData = G.DataMgr.get(RouletteData);\n        rouletteData.Status = MST.RouletteStatus.AnimationPhase;\n\n        // rouletteData.StartTimeStamp = Number(data.StartTimeStamp);\n        rouletteData.StopTimeStamp = Number(data.StopTimeStamp);\n        rouletteData.endIndex = data.endIndex;\n\n        dispatch(\"Event_M2C_RouletteStart_mes\");\n    }\n\n    onR2C_PaybackPhase_Mes(data: MST.R2C_PaybackPhase_Mes) {\n        let rouletteData = G.DataMgr.get(RouletteData);\n        rouletteData.Status = MST.RouletteStatus.PaybackPhase;\n        let gameRecordList = rouletteData.gameRecordList;\n\n        rouletteData.curRound = data.nextRound;\n        rouletteData.hashSalt = data.hashSalt;\n        rouletteData.randomNum = data.randomNum;\n        rouletteData.endIndex = data.color;\n        gameRecordList.push(Number(data.color));\n\n        dispatch(\"Event_R2C_PaybackPhase_Mes\");\n    }\n\n    onR2C_Bet_Mes(data: MST.R2C_Bet_Mes) {\n        let rouletteData = G.DataMgr.get(RouletteData);\n        if (!data.info)\n            return;\n\n        let onRoomTotalBet = rouletteData.onRoomTotalBet;\n        let betPlayer: RouletteInterface.BetPlayer = {\n            betInfo: data.info\n        }\n        if (!rouletteData.onRoomBets)\n            rouletteData.onRoomBets = [];\n\n        rouletteData.onRoomBets.push(betPlayer);\n        rouletteData.onRoomBets.reverse();\n\n        for (let index = 0; index < onRoomTotalBet.length; index++) {\n            const totalData = onRoomTotalBet[index];\n            if (totalData.color == data.info.Color) {\n                let chips = Number(totalData.chips);\n                chips += Number(data.info.BetGold);\n                totalData.chips = chips;\n            }\n        }\n        dispatch(\"Event_R2C_Bet_Mes\");\n    }\n\n    onR2C_GetBetRandInfo_Res(data: MST.R2C_GetBetRandInfo_Res) {\n        if (data.Error !== 0) {\n            PanelHelp.showErrTip(data.Error);\n            return\n        }\n\n        let rouletteData = G.DataMgr.get(RouletteData);\n        rouletteData.betBigRankInfo = [];\n        for (let v of data.records) {\n            let betPlayer: RouletteInterface.BetPlayer = {\n                betInfo: v,\n            }\n            rouletteData.betBigRankInfo.push(betPlayer);\n        }\n        dispatch(\"Event_R2C_GetBetRandInfo_Res\");\n    }\n\n    onR2C_GetGameRecords_Res(data: MST.R2C_GetGameRecords_Res) {\n        dispatch(\"Event_R2C_GetGameRecords_Res\", data);\n    }\n\n    onR2C_GetBetInfo_Res(data: MST.R2C_GetBetInfo_Res) {\n        if (data.Error !== 0) {\n            PanelHelp.showErrTip(data.Error);\n            return\n        }\n        dispatch(\"Event_onR2C_GetBetInfo_Res\", data);\n    }\n\n}\n\nManager.netManager.push(RouletteNetController);\n"]}