{"version":3,"sources":["assets/games/crash/script/CrashLogic.ts"],"names":[],"mappings":";;;;;;;;;AAAA,6DAA0D;AAC1D,wEAAgG;AAChG,oEAAiE;AACjE,0EAAuE;AACvE,0FAA4F;AAE5F,wDAA6C;AAC7C,yEAAiD;AAEjD,MAAM,UAAW,SAAQ,aAAK;IAA9B;;QAEI,cAAS,GAAc,sBAAS,CAAC,IAAI,CAAC;IA4E1C,CAAC;IAzEG,MAAM;QACF,KAAK,CAAC,MAAM,EAAE,CAAC;IACnB,CAAC;IAES,aAAa;QACnB,KAAK,CAAC,aAAa,EAAE,CAAC;QACtB,IAAI,CAAC,aAAa,CAAC,uBAAU,CAAC,UAAU,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;IAChE,CAAC;IAED,IAAc,MAAM;QAChB,OAAO,OAAO,CAAC;IACnB,CAAC;IAEM,eAAe,CAAC,IAAoB;QACvC,KAAK,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;QAC5B,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,SAAS,EAAE;SAEhC;aAAM;YACH,QAAQ;YACR,IAAI,CAAC,kBAAkB,EAAE,CAAC;YAC1B,MAAM;YACN,IAAI,CAAC,OAAO,CAAC,eAAe,EAAE,CAAC;SAClC;IACL,CAAC;IAEO,WAAW,CAAC,GAAG;QACnB,IAAI,GAAG,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,EAAE;YAC3B,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;YACrB,yFAAyF;YACzF,SAAS;YACT,iBAAO,CAAC,QAAQ,GAAG,qBAAK,CAAC,QAAQ,CAAC;YAClC,iBAAO,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;YAEzB,WAAW;YACX,IAAI,CAAC,gBAAgB,EAAE,CAAC;YAExB,0BAA0B;YAC1B,2BAAY,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAC;YAC1C,MAAM;YACN,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,CAAC;SAChC;aAAM;YACH,QAAQ;YACR,IAAI,CAAC,kBAAkB,EAAE,CAAC;YAC1B,MAAM;YACN,IAAI,CAAC,OAAO,CAAC,eAAe,EAAE,CAAC;SAClC;IACL,CAAC;IAES,sBAAsB,CAAC,GAAwB;QACrD,IAAI,GAAG,IAAI,oCAAmB,CAAC,OAAO,EAAE;YACpC,OAAO;SACV;QACD,EAAE,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,MAAM,WAAW,CAAC,CAAC;QAClC,KAAK,CAAC,sBAAsB,CAAC,GAAG,CAAC,CAAC;QAElC,iBAAO,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,uBAAa,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;YAC9F,WAAW;YACX,2BAAY,CAAC,QAAQ,CAAC,kBAAkB,EAAE,CAAC;QAC/C,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE;YACX,2BAAY,CAAC,QAAQ,CAAC,kBAAkB,EAAE,CAAC;YAC3C,EAAE,CAAC,KAAK,CAAC,UAAU,uBAAa,CAAC,IAAI,OAAO,EAAE,CAAC,CAAC,CAAA;QACpD,CAAC,CAAC,CAAA;IAEN,CAAC;IAES,gBAAgB;QACtB,OAAO,CAAC,EAAE,WAAW,EAAE,uBAAa,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;IACjE,CAAC;IAES,gBAAgB;QACtB,KAAK,CAAC,gBAAgB,EAAE,CAAC;QACzB,qBAAK,CAAC,QAAQ,CAAC,gBAAgB,EAAE,CAAC;IACtC,CAAC;CACJ;AAED,iBAAO,CAAC,YAAY,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC","file":"","sourceRoot":"/","sourcesContent":["import { Logic } from \"../../../script/common/base/Logic\";\nimport { LogicType, LogicEvent, LogicEventData } from \"../../../script/common/event/LogicEvent\";\nimport { Manager } from \"../../../script/common/manager/Manager\";\nimport { LobbyService } from \"../../../script/common/net/LobbyService\";\nimport { ResourceLoaderError } from \"../../../script/framework/assetManager/ResourceLoader\";\nimport { ResourceData } from \"../../../script/framework/base/Defines\";\nimport { Crash } from \"./data/CrashGameData\";\nimport CrashGameView from \"./view/CrashGameView\";\n\nclass CrashLogic extends Logic {\n\n    logicType: LogicType = LogicType.GAME;\n    private data: any;\n\n    onLoad() {\n        super.onLoad();\n    }\n\n    protected bindingEvents() {\n        super.bindingEvents();\n        this.registerEvent(LogicEvent.ENTER_GAME, this.onEnterGame);\n    }\n\n    protected get bundle() {\n        return \"crash\";\n    }\n\n    public onEnterComplete(data: LogicEventData) {\n        super.onEnterComplete(data);\n        if (data.type == this.logicType) {\n\n        } else {\n            //移除网络组件\n            this.removeNetComponent();\n            //卸载资源\n            this._loader.unLoadResources();\n        }\n    }\n\n    private onEnterGame(msg) {\n        if (msg.bundle == this.bundle) {\n            this.data = msg.data;\n            // Manager.uiManager.open({ type: CrashGameView, bundle: this.bundle , args:[msg.data]});\n            //游戏数据初始化\n            Manager.gameData = Crash.gameData;\n            Manager.gameData.clear();\n\n            //子游戏语言包初始化\n            this.onLanguageChange();\n\n            //先暂停网络回调处理，等待资源加载完成后，恢复处理\n            LobbyService.instance.pauseMessageQueue();\n            //加载资源\n            this._loader.loadResources();\n        } else {\n            //移除网络组件\n            this.removeNetComponent();\n            //卸载资源\n            this._loader.unLoadResources();\n        }\n    }\n\n    protected onLoadResourceComplete(err: ResourceLoaderError) {\n        if (err == ResourceLoaderError.LOADING) {\n            return;\n        }\n        cc.log(`${this.bundle}资源加载完成!!!`);\n        super.onLoadResourceComplete(err);\n\n        Manager.uiManager.open({ type: CrashGameView, bundle: this.bundle, args: [this.data] }).then(() => {\n            //加载完成，恢复网络\n            LobbyService.instance.resumeMessageQueue();\n        }).catch((e) => {\n            LobbyService.instance.resumeMessageQueue();\n            cc.error(`打开游戏界面：${CrashGameView.name}时报错了:`, e)\n        })\n\n    }\n\n    protected getLoadResources(): ResourceData[] {\n        return [{ preloadView: CrashGameView, bundle: this.bundle }];\n    }\n\n    protected onLanguageChange() {\n        super.onLanguageChange();\n        Crash.gameData.onLanguageChange();\n    }\n}\n\nManager.logicManager.push(CrashLogic);"]}