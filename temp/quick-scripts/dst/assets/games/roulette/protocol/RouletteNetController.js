
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/games/roulette/protocol/RouletteNetController.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '32a36IIi0tIspdGLf5JgxUX', 'RouletteNetController');
// games/roulette/protocol/RouletteNetController.ts

"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Manager_1 = require("../../../script/common/manager/Manager");
const CmdResStruct_1 = require("../../../script/common/net/CmdResStruct");
const LobbyService_1 = require("../../../script/common/net/LobbyService");
const UserData_1 = __importDefault(require("../../../script/data/UserData"));
const Controller_1 = __importDefault(require("../../../script/framework/controller/Controller"));
const Decorators_1 = require("../../../script/framework/decorator/Decorators");
const protoc_1 = require("../../../script/framework/external/protoc");
const PanelHelp_1 = __importDefault(require("../../../script/msgbox/PanelHelp"));
const RouletteData_1 = __importDefault(require("../script/data/RouletteData"));
/**
 * @description 逻辑流程控制器
 */
const { ccclass, property } = cc._decorator;
let RouletteNetController = class RouletteNetController extends Controller_1.default {
    bindingEvents() {
        super.bindingEvents();
        this.registerRes();
        this.registerEvent(protoc_1.MST.OuterOpcode_Map.M2C_TransferMap_Res, this.onM2C_TransferMap_Res);
        this.registerEvent(protoc_1.MST.OuterOpcode_Roulette.M2C_GetRouletteInfo_Res, this.onM2C_GetRouletteInfo_Res);
        this.registerEvent(protoc_1.MST.OuterOpcode_Roulette.M2C_RouletteStartBet_Mes, this.onM2C_RouletteStartBet_Mes);
        this.registerEvent(protoc_1.MST.OuterOpcode_Roulette.M2C_MyRouletteBet_Res, this.onM2C_MyRouletteBet_Res);
        this.registerEvent(protoc_1.MST.OuterOpcode_Roulette.M2C_RouletteStart_mes, this.onM2C_RouletteStart_mes);
        this.registerEvent(protoc_1.MST.OuterOpcode_Roulette.R2C_PaybackPhase_Mes, this.onR2C_PaybackPhase_Mes);
        this.registerEvent(protoc_1.MST.OuterOpcode_Roulette.R2C_Bet_Mes, this.onR2C_Bet_Mes);
        this.registerEvent(protoc_1.MST.OuterOpcode_Roulette.R2C_GetBetRandInfo_Res, this.onR2C_GetBetRandInfo_Res);
        this.registerEvent(protoc_1.MST.OuterOpcode_Roulette.R2C_GetGameRecords_Res, this.onR2C_GetGameRecords_Res);
        this.registerEvent(protoc_1.MST.OuterOpcode_Roulette.R2C_GetBetInfo_Res, this.onR2C_GetBetInfo_Res);
    }
    registerRes() {
        CmdResStruct_1.CmdResStruct.register(protoc_1.MST.OuterOpcode_Map.M2C_TransferMap_Res, protoc_1.MST.M2C_TransferMap_Res);
        CmdResStruct_1.CmdResStruct.register(protoc_1.MST.OuterOpcode_Roulette.M2C_GetRouletteInfo_Res, protoc_1.MST.M2C_GetRouletteInfo_Res);
        CmdResStruct_1.CmdResStruct.register(protoc_1.MST.OuterOpcode_Roulette.M2C_RouletteStartBet_Mes, protoc_1.MST.M2C_RouletteStartBet_Mes);
        CmdResStruct_1.CmdResStruct.register(protoc_1.MST.OuterOpcode_Roulette.M2C_MyRouletteBet_Res, protoc_1.MST.M2C_MyRouletteBet_Res);
        CmdResStruct_1.CmdResStruct.register(protoc_1.MST.OuterOpcode_Roulette.M2C_RouletteStart_mes, protoc_1.MST.M2C_RouletteStart_mes);
        CmdResStruct_1.CmdResStruct.register(protoc_1.MST.OuterOpcode_Roulette.R2C_PaybackPhase_Mes, protoc_1.MST.R2C_PaybackPhase_Mes);
        CmdResStruct_1.CmdResStruct.register(protoc_1.MST.OuterOpcode_Roulette.R2C_Bet_Mes, protoc_1.MST.R2C_Bet_Mes);
        CmdResStruct_1.CmdResStruct.register(protoc_1.MST.OuterOpcode_Roulette.R2C_GetBetRandInfo_Res, protoc_1.MST.R2C_GetBetRandInfo_Res);
        CmdResStruct_1.CmdResStruct.register(protoc_1.MST.OuterOpcode_Roulette.R2C_GetGameRecords_Res, protoc_1.MST.R2C_GetGameRecords_Res);
        CmdResStruct_1.CmdResStruct.register(protoc_1.MST.OuterOpcode_Roulette.R2C_GetBetInfo_Res, protoc_1.MST.R2C_GetBetInfo_Res);
    }
    onM2C_TransferMap_Res(data) {
        let userData = G.DataMgr.get(UserData_1.default);
        userData.inGame = data.RoomName;
        dispatch("Event_M2C_TransferMap_Res", data);
    }
    onM2C_GetRouletteInfo_Res(data) {
        if (data.Error !== 0) {
            PanelHelp_1.default.showErrTip(data.Error);
            return;
        }
        let rouletteData = G.DataMgr.get(RouletteData_1.default);
        rouletteData.Status = data.Status;
        rouletteData.EndTimeStamp = data.EndTimeStamp;
        rouletteData.gameRecordList.length = 0;
        rouletteData.onRoomBets = [];
        for (let v of data.Bets) {
            let betPlayer = {
                betInfo: v,
            };
            rouletteData.onRoomBets.push(betPlayer);
        }
        rouletteData.onRoomBets.reverse();
        rouletteData.onRoomTotalBet = data.betRecord;
        rouletteData.gameRecordList = [].concat(data.MultipleRecord);
        rouletteData.curRound = data.round;
        rouletteData.hashSalt = data.hashSalt;
        rouletteData.randomNum = data.randomNo;
        rouletteData.roundHash = data.roundHash;
        if (data.Status == protoc_1.MST.RouletteStatus.BetPhase) {
            rouletteData.stopBetTimeStamp = Number(data.EndTimeStamp);
        }
        dispatch("Event_M2C_GetRouletteInfo_Res");
    }
    onM2C_RouletteStartBet_Mes(data) {
        let rouletteData = G.DataMgr.get(RouletteData_1.default);
        rouletteData.Status = protoc_1.MST.RouletteStatus.BetPhase;
        rouletteData.stopBetTimeStamp = Number(data.StopBetTimeStamp);
        rouletteData.roundHash = data.randHash;
        rouletteData.clearRouletteData();
        dispatch("Event_M2C_RouletteStartBet_Mes");
    }
    onM2C_MyRouletteBet_Res(data) {
        if (data.Error !== 0) {
            PanelHelp_1.default.showErrTip(data.Error);
            return;
        }
    }
    onM2C_RouletteStart_mes(data) {
        let rouletteData = G.DataMgr.get(RouletteData_1.default);
        rouletteData.Status = protoc_1.MST.RouletteStatus.AnimationPhase;
        // rouletteData.StartTimeStamp = Number(data.StartTimeStamp);
        rouletteData.StopTimeStamp = Number(data.StopTimeStamp);
        rouletteData.endIndex = data.endIndex;
        dispatch("Event_M2C_RouletteStart_mes");
    }
    onR2C_PaybackPhase_Mes(data) {
        let rouletteData = G.DataMgr.get(RouletteData_1.default);
        rouletteData.Status = protoc_1.MST.RouletteStatus.PaybackPhase;
        let gameRecordList = rouletteData.gameRecordList;
        rouletteData.curRound = data.nextRound;
        rouletteData.hashSalt = data.hashSalt;
        rouletteData.randomNum = data.randomNum;
        rouletteData.endIndex = data.color;
        gameRecordList.push(Number(data.color));
        dispatch("Event_R2C_PaybackPhase_Mes");
    }
    onR2C_Bet_Mes(data) {
        let rouletteData = G.DataMgr.get(RouletteData_1.default);
        if (!data.info)
            return;
        let onRoomTotalBet = rouletteData.onRoomTotalBet;
        let betPlayer = {
            betInfo: data.info
        };
        if (!rouletteData.onRoomBets)
            rouletteData.onRoomBets = [];
        rouletteData.onRoomBets.push(betPlayer);
        rouletteData.onRoomBets.reverse();
        for (let index = 0; index < onRoomTotalBet.length; index++) {
            const totalData = onRoomTotalBet[index];
            if (totalData.color == data.info.Color) {
                let chips = Number(totalData.chips);
                chips += Number(data.info.BetGold);
                totalData.chips = chips;
            }
        }
        dispatch("Event_R2C_Bet_Mes");
    }
    onR2C_GetBetRandInfo_Res(data) {
        if (data.Error !== 0) {
            PanelHelp_1.default.showErrTip(data.Error);
            return;
        }
        let rouletteData = G.DataMgr.get(RouletteData_1.default);
        rouletteData.betBigRankInfo = [];
        for (let v of data.records) {
            let betPlayer = {
                betInfo: v,
            };
            rouletteData.betBigRankInfo.push(betPlayer);
        }
        dispatch("Event_R2C_GetBetRandInfo_Res");
    }
    onR2C_GetGameRecords_Res(data) {
        dispatch("Event_R2C_GetGameRecords_Res", data);
    }
    onR2C_GetBetInfo_Res(data) {
        if (data.Error !== 0) {
            PanelHelp_1.default.showErrTip(data.Error);
            return;
        }
        dispatch("Event_onR2C_GetBetInfo_Res", data);
    }
};
RouletteNetController = __decorate([
    ccclass,
    Decorators_1.injectService(LobbyService_1.LobbyService.instance)
], RouletteNetController);
exports.default = RouletteNetController;
Manager_1.Manager.netManager.push(RouletteNetController);

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9nYW1lcy9yb3VsZXR0ZS9wcm90b2NvbC9Sb3VsZXR0ZU5ldENvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQSxvRUFBaUU7QUFDakUsMEVBQXVFO0FBQ3ZFLDBFQUF1RTtBQUN2RSw2RUFBcUQ7QUFDckQsaUdBQXlFO0FBQ3pFLCtFQUErRTtBQUMvRSxzRUFBZ0U7QUFDaEUsaUZBQXlEO0FBQ3pELCtFQUF1RDtBQUd2RDs7R0FFRztBQUNILE1BQU0sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQztBQUk1QyxJQUFxQixxQkFBcUIsR0FBMUMsTUFBcUIscUJBQXNCLFNBQVEsb0JBQXdCO0lBRTdELGFBQWE7UUFDbkIsS0FBSyxDQUFDLGFBQWEsRUFBRSxDQUFBO1FBQ3JCLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsYUFBYSxDQUFDLFlBQUcsQ0FBQyxlQUFlLENBQUMsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDeEYsSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFHLENBQUMsb0JBQW9CLENBQUMsdUJBQXVCLEVBQUUsSUFBSSxDQUFDLHlCQUF5QixDQUFDLENBQUM7UUFDckcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFHLENBQUMsb0JBQW9CLENBQUMsd0JBQXdCLEVBQUUsSUFBSSxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDdkcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFHLENBQUMsb0JBQW9CLENBQUMscUJBQXFCLEVBQUUsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDakcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFHLENBQUMsb0JBQW9CLENBQUMscUJBQXFCLEVBQUUsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDakcsSUFBSSxDQUFDLGFBQWEsQ0FB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QjtBQXlLMUMsaUJBQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUMiLCJmaWxlIjoiIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7IE1hbmFnZXIgfSBmcm9tIFwiLi4vLi4vLi4vc2NyaXB0L2NvbW1vbi9tYW5hZ2VyL01hbmFnZXJcIjtcbmltcG9ydCB7IENtZFJlc1N0cnVjdCB9IGZyb20gXCIuLi8uLi8uLi9zY3JpcHQvY29tbW9uL25ldC9DbWRSZXNTdHJ1Y3RcIjtcbmltcG9ydCB7IExvYmJ5U2VydmljZSB9IGZyb20gXCIuLi8uLi8uLi9zY3JpcHQvY29tbW9uL25ldC9Mb2JieVNlcnZpY2VcIjtcbmltcG9ydCBVc2VyRGF0YSBmcm9tIFwiLi4vLi4vLi4vc2NyaXB0L2RhdGEvVXNlckRhdGFcIjtcbmltcG9ydCBDb250cm9sbGVyIGZyb20gXCIuLi8uLi8uLi9zY3JpcHQvZnJhbWV3b3JrL2NvbnRyb2xsZXIvQ29udHJvbGxlclwiO1xuaW1wb3J0IHsgaW5qZWN0U2VydmljZSB9IGZyb20gXCIuLi8uLi8uLi9zY3JpcHQvZnJhbWV3b3JrL2RlY29yYXRvci9EZWNvcmF0b3JzXCI7XG5pbXBvcnQgeyBNU1QgfSBmcm9tIFwiLi4vLi4vLi4vc2NyaXB0L2ZyYW1ld29yay9leHRlcm5hbC9wcm90b2NcIjtcbmltcG9ydCBQYW5lbEhlbHAgZnJvbSBcIi4uLy4uLy4uL3NjcmlwdC9tc2dib3gvUGFuZWxIZWxwXCI7XG5pbXBvcnQgUm91bGV0dGVEYXRhIGZyb20gXCIuLi9zY3JpcHQvZGF0YS9Sb3VsZXR0ZURhdGFcIjtcbmltcG9ydCB7IFJvdWxldHRlSW50ZXJmYWNlIH0gZnJvbSBcIi4uL3NjcmlwdC9pbnRlcmZhY2UvUm91bGV0dGVJbnRlcmZhY2VcIjtcblxuLyoqXG4gKiBAZGVzY3JpcHRpb24g6YC76L6R5rWB56iL5o6n5Yi25ZmoICBcbiAqL1xuY29uc3QgeyBjY2NsYXNzLCBwcm9wZXJ0eSB9ID0gY2MuX2RlY29yYXRvcjtcblxuQGNjY2xhc3NcbkBpbmplY3RTZXJ2aWNlKExvYmJ5U2VydmljZS5pbnN0YW5jZSlcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJvdWxldHRlTmV0Q29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXI8TG9iYnlTZXJ2aWNlPiB7XG5cbiAgICBwcm90ZWN0ZWQgYmluZGluZ0V2ZW50cygpIHtcbiAgICAgICAgc3VwZXIuYmluZGluZ0V2ZW50cygpXG4gICAgICAgIHRoaXMucmVnaXN0ZXJSZXMoKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KE1TVC5PdXRlck9wY29kZV9NYXAuTTJDX1RyYW5zZmVyTWFwX1JlcywgdGhpcy5vbk0yQ19UcmFuc2Zlck1hcF9SZXMpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoTVNULk91dGVyT3Bjb2RlX1JvdWxldHRlLk0yQ19HZXRSb3VsZXR0ZUluZm9fUmVzLCB0aGlzLm9uTTJDX0dldFJvdWxldHRlSW5mb19SZXMpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoTVNULk91dGVyT3Bjb2RlX1JvdWxldHRlLk0yQ19Sb3VsZXR0ZVN0YXJ0QmV0X01lcywgdGhpcy5vbk0yQ19Sb3VsZXR0ZVN0YXJ0QmV0X01lcyk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudChNU1QuT3V0ZXJPcGNvZGVfUm91bGV0dGUuTTJDX015Um91bGV0dGVCZXRfUmVzLCB0aGlzLm9uTTJDX015Um91bGV0dGVCZXRfUmVzKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KE1TVC5PdXRlck9wY29kZV9Sb3VsZXR0ZS5NMkNfUm91bGV0dGVTdGFydF9tZXMsIHRoaXMub25NMkNfUm91bGV0dGVTdGFydF9tZXMpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoTVNULk91dGVyT3Bjb2RlX1JvdWxldHRlLlIyQ19QYXliYWNrUGhhc2VfTWVzLCB0aGlzLm9uUjJDX1BheWJhY2tQaGFzZV9NZXMpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoTVNULk91dGVyT3Bjb2RlX1JvdWxldHRlLlIyQ19CZXRfTWVzLCB0aGlzLm9uUjJDX0JldF9NZXMpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoTVNULk91dGVyT3Bjb2RlX1JvdWxldHRlLlIyQ19HZXRCZXRSYW5kSW5mb19SZXMsIHRoaXMub25SMkNfR2V0QmV0UmFuZEluZm9fUmVzKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KE1TVC5PdXRlck9wY29kZV9Sb3VsZXR0ZS5SMkNfR2V0R2FtZVJlY29yZHNfUmVzLCB0aGlzLm9uUjJDX0dldEdhbWVSZWNvcmRzX1Jlcyk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudChNU1QuT3V0ZXJPcGNvZGVfUm91bGV0dGUuUjJDX0dldEJldEluZm9fUmVzLCB0aGlzLm9uUjJDX0dldEJldEluZm9fUmVzKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlZ2lzdGVyUmVzKCkge1xuICAgICAgICBDbWRSZXNTdHJ1Y3QucmVnaXN0ZXIoTVNULk91dGVyT3Bjb2RlX01hcC5NMkNfVHJhbnNmZXJNYXBfUmVzLCBNU1QuTTJDX1RyYW5zZmVyTWFwX1Jlcyk7XG4gICAgICAgIENtZFJlc1N0cnVjdC5yZWdpc3RlcihNU1QuT3V0ZXJPcGNvZGVfUm91bGV0dGUuTTJDX0dldFJvdWxldHRlSW5mb19SZXMsIE1TVC5NMkNfR2V0Um91bGV0dGVJbmZvX1Jlcyk7XG4gICAgICAgIENtZFJlc1N0cnVjdC5yZWdpc3RlcihNU1QuT3V0ZXJPcGNvZGVfUm91bGV0dGUuTTJDX1JvdWxldHRlU3RhcnRCZXRfTWVzLCBNU1QuTTJDX1JvdWxldHRlU3RhcnRCZXRfTWVzKTtcbiAgICAgICAgQ21kUmVzU3RydWN0LnJlZ2lzdGVyKE1TVC5PdXRlck9wY29kZV9Sb3VsZXR0ZS5NMkNfTXlSb3VsZXR0ZUJldF9SZXMsIE1TVC5NMkNfTXlSb3VsZXR0ZUJldF9SZXMpO1xuICAgICAgICBDbWRSZXNTdHJ1Y3QucmVnaXN0ZXIoTVNULk91dGVyT3Bjb2RlX1JvdWxldHRlLk0yQ19Sb3VsZXR0ZVN0YXJ0X21lcywgTVNULk0yQ19Sb3VsZXR0ZVN0YXJ0X21lcyk7XG4gICAgICAgIENtZFJlc1N0cnVjdC5yZWdpc3RlcihNU1QuT3V0ZXJPcGNvZGVfUm91bGV0dGUuUjJDX1BheWJhY2tQaGFzZV9NZXMsIE1TVC5SMkNfUGF5YmFja1BoYXNlX01lcyk7XG4gICAgICAgIENtZFJlc1N0cnVjdC5yZWdpc3RlcihNU1QuT3V0ZXJPcGNvZGVfUm91bGV0dGUuUjJDX0JldF9NZXMsIE1TVC5SMkNfQmV0X01lcyk7XG4gICAgICAgIENtZFJlc1N0cnVjdC5yZWdpc3RlcihNU1QuT3V0ZXJPcGNvZGVfUm91bGV0dGUuUjJDX0dldEJldFJhbmRJbmZvX1JlcywgTVNULlIyQ19HZXRCZXRSYW5kSW5mb19SZXMpO1xuICAgICAgICBDbWRSZXNTdHJ1Y3QucmVnaXN0ZXIoTVNULk91dGVyT3Bjb2RlX1JvdWxldHRlLlIyQ19HZXRHYW1lUmVjb3Jkc19SZXMsIE1TVC5SMkNfR2V0R2FtZVJlY29yZHNfUmVzKTtcbiAgICAgICAgQ21kUmVzU3RydWN0LnJlZ2lzdGVyKE1TVC5PdXRlck9wY29kZV9Sb3VsZXR0ZS5SMkNfR2V0QmV0SW5mb19SZXMsIE1TVC5SMkNfR2V0QmV0SW5mb19SZXMpO1xuICAgIH1cblxuICAgIHB1YmxpYyBvbk0yQ19UcmFuc2Zlck1hcF9SZXMoZGF0YTogTVNULklNMkNfVHJhbnNmZXJNYXBfUmVzKSB7XG4gICAgICAgIGxldCB1c2VyRGF0YSA9IEcuRGF0YU1nci5nZXQoVXNlckRhdGEpO1xuICAgICAgICB1c2VyRGF0YS5pbkdhbWUgPSBkYXRhLlJvb21OYW1lO1xuICAgICAgICBkaXNwYXRjaChcIkV2ZW50X00yQ19UcmFuc2Zlck1hcF9SZXNcIiwgZGF0YSk7XG4gICAgfVxuXG4gICAgb25NMkNfR2V0Um91bGV0dGVJbmZvX1JlcyhkYXRhOiBNU1QuSU0yQ19HZXRSb3VsZXR0ZUluZm9fUmVzKSB7XG4gICAgICAgIGlmIChkYXRhLkVycm9yICE9PSAwKSB7XG4gICAgICAgICAgICBQYW5lbEhlbHAuc2hvd0VyclRpcChkYXRhLkVycm9yKTtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHJvdWxldHRlRGF0YSA9IEcuRGF0YU1nci5nZXQoUm91bGV0dGVEYXRhKTtcbiAgICAgICAgcm91bGV0dGVEYXRhLlN0YXR1cyA9IGRhdGEuU3RhdHVzO1xuICAgICAgICByb3VsZXR0ZURhdGEuRW5kVGltZVN0YW1wID0gZGF0YS5FbmRUaW1lU3RhbXA7XG4gICAgICAgIHJvdWxldHRlRGF0YS5nYW1lUmVjb3JkTGlzdC5sZW5ndGggPSAwO1xuXG4gICAgICAgIHJvdWxldHRlRGF0YS5vblJvb21CZXRzID0gW107XG4gICAgICAgIGZvciAobGV0IHYgb2YgZGF0YS5CZXRzKSB7XG4gICAgICAgICAgICBsZXQgYmV0UGxheWVyOiBSb3VsZXR0ZUludGVyZmFjZS5CZXRQbGF5ZXIgPSB7XG4gICAgICAgICAgICAgICAgYmV0SW5mbzogdixcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJvdWxldHRlRGF0YS5vblJvb21CZXRzLnB1c2goYmV0UGxheWVyKTtcbiAgICAgICAgfVxuICAgICAgICByb3VsZXR0ZURhdGEub25Sb29tQmV0cy5yZXZlcnNlKCk7XG5cbiAgICAgICAgcm91bGV0dGVEYXRhLm9uUm9vbVRvdGFsQmV0ID0gZGF0YS5iZXRSZWNvcmQ7XG4gICAgICAgIHJvdWxldHRlRGF0YS5nYW1lUmVjb3JkTGlzdCA9IFtdLmNvbmNhdChkYXRhLk11bHRpcGxlUmVjb3JkKTtcbiAgICAgICAgcm91bGV0dGVEYXRhLmN1clJvdW5kID0gZGF0YS5yb3VuZDtcbiAgICAgICAgcm91bGV0dGVEYXRhLmhhc2hTYWx0ID0gZGF0YS5oYXNoU2FsdDtcbiAgICAgICAgcm91bGV0dGVEYXRhLnJhbmRvbU51bSA9IGRhdGEucmFuZG9tTm87XG4gICAgICAgIHJvdWxldHRlRGF0YS5yb3VuZEhhc2ggPSBkYXRhLnJvdW5kSGFzaDtcblxuICAgICAgICBpZiAoZGF0YS5TdGF0dXMgPT0gTVNULlJvdWxldHRlU3RhdHVzLkJldFBoYXNlKSB7XG4gICAgICAgICAgICByb3VsZXR0ZURhdGEuc3RvcEJldFRpbWVTdGFtcCA9IE51bWJlcihkYXRhLkVuZFRpbWVTdGFtcCk7XG4gICAgICAgIH1cblxuICAgICAgICBkaXNwYXRjaChcIkV2ZW50X00yQ19HZXRSb3VsZXR0ZUluZm9fUmVzXCIpO1xuICAgIH1cblxuICAgIG9uTTJDX1JvdWxldHRlU3RhcnRCZXRfTWVzKGRhdGE6IE1TVC5NMkNfUm91bGV0dGVTdGFydEJldF9NZXMpIHtcbiAgICAgICAgbGV0IHJvdWxldHRlRGF0YSA9IEcuRGF0YU1nci5nZXQoUm91bGV0dGVEYXRhKTtcbiAgICAgICAgcm91bGV0dGVEYXRhLlN0YXR1cyA9IE1TVC5Sb3VsZXR0ZVN0YXR1cy5CZXRQaGFzZTtcbiAgICAgICAgcm91bGV0dGVEYXRhLnN0b3BCZXRUaW1lU3RhbXAgPSBOdW1iZXIoZGF0YS5TdG9wQmV0VGltZVN0YW1wKTtcbiAgICAgICAgcm91bGV0dGVEYXRhLnJvdW5kSGFzaCA9IGRhdGEucmFuZEhhc2g7XG5cbiAgICAgICAgcm91bGV0dGVEYXRhLmNsZWFyUm91bGV0dGVEYXRhKCk7XG4gICAgICAgIGRpc3BhdGNoKFwiRXZlbnRfTTJDX1JvdWxldHRlU3RhcnRCZXRfTWVzXCIpO1xuICAgIH1cblxuICAgIG9uTTJDX015Um91bGV0dGVCZXRfUmVzKGRhdGE6IE1TVC5NMkNfTXlSb3VsZXR0ZUJldF9SZXMpIHtcbiAgICAgICAgaWYgKGRhdGEuRXJyb3IgIT09IDApIHtcbiAgICAgICAgICAgIFBhbmVsSGVscC5zaG93RXJyVGlwKGRhdGEuRXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbk0yQ19Sb3VsZXR0ZVN0YXJ0X21lcyhkYXRhOiBNU1QuTTJDX1JvdWxldHRlU3RhcnRfbWVzKSB7XG4gICAgICAgIGxldCByb3VsZXR0ZURhdGEgPSBHLkRhdGFNZ3IuZ2V0KFJvdWxldHRlRGF0YSk7XG4gICAgICAgIHJvdWxldHRlRGF0YS5TdGF0dXMgPSBNU1QuUm91bGV0dGVTdGF0dXMuQW5pbWF0aW9uUGhhc2U7XG5cbiAgICAgICAgLy8gcm91bGV0dGVEYXRhLlN0YXJ0VGltZVN0YW1wID0gTnVtYmVyKGRhdGEuU3RhcnRUaW1lU3RhbXApO1xuICAgICAgICByb3VsZXR0ZURhdGEuU3RvcFRpbWVTdGFtcCA9IE51bWJlcihkYXRhLlN0b3BUaW1lU3RhbXApO1xuICAgICAgICByb3VsZXR0ZURhdGEuZW5kSW5kZXggPSBkYXRhLmVuZEluZGV4O1xuXG4gICAgICAgIGRpc3BhdGNoKFwiRXZlbnRfTTJDX1JvdWxldHRlU3RhcnRfbWVzXCIpO1xuICAgIH1cblxuICAgIG9uUjJDX1BheWJhY2tQaGFzZV9NZXMoZGF0YTogTVNULlIyQ19QYXliYWNrUGhhc2VfTWVzKSB7XG4gICAgICAgIGxldCByb3VsZXR0ZURhdGEgPSBHLkRhdGFNZ3IuZ2V0KFJvdWxldHRlRGF0YSk7XG4gICAgICAgIHJvdWxldHRlRGF0YS5TdGF0dXMgPSBNU1QuUm91bGV0dGVTdGF0dXMuUGF5YmFja1BoYXNlO1xuICAgICAgICBsZXQgZ2FtZVJlY29yZExpc3QgPSByb3VsZXR0ZURhdGEuZ2FtZVJlY29yZExpc3Q7XG5cbiAgICAgICAgcm91bGV0dGVEYXRhLmN1clJvdW5kID0gZGF0YS5uZXh0Um91bmQ7XG4gICAgICAgIHJvdWxldHRlRGF0YS5oYXNoU2FsdCA9IGRhdGEuaGFzaFNhbHQ7XG4gICAgICAgIHJvdWxldHRlRGF0YS5yYW5kb21OdW0gPSBkYXRhLnJhbmRvbU51bTtcbiAgICAgICAgcm91bGV0dGVEYXRhLmVuZEluZGV4ID0gZGF0YS5jb2xvcjtcbiAgICAgICAgZ2FtZVJlY29yZExpc3QucHVzaChOdW1iZXIoZGF0YS5jb2xvcikpO1xuXG4gICAgICAgIGRpc3BhdGNoKFwiRXZlbnRfUjJDX1BheWJhY2tQaGFzZV9NZXNcIik7XG4gICAgfVxuXG4gICAgb25SMkNfQmV0X01lcyhkYXRhOiBNU1QuUjJDX0JldF9NZXMpIHtcbiAgICAgICAgbGV0IHJvdWxldHRlRGF0YSA9IEcuRGF0YU1nci5nZXQoUm91bGV0dGVEYXRhKTtcbiAgICAgICAgaWYgKCFkYXRhLmluZm8pXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgbGV0IG9uUm9vbVRvdGFsQmV0ID0gcm91bGV0dGVEYXRhLm9uUm9vbVRvdGFsQmV0O1xuICAgICAgICBsZXQgYmV0UGxheWVyOiBSb3VsZXR0ZUludGVyZmFjZS5CZXRQbGF5ZXIgPSB7XG4gICAgICAgICAgICBiZXRJbmZvOiBkYXRhLmluZm9cbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJvdWxldHRlRGF0YS5vblJvb21CZXRzKVxuICAgICAgICAgICAgcm91bGV0dGVEYXRhLm9uUm9vbUJldHMgPSBbXTtcblxuICAgICAgICByb3VsZXR0ZURhdGEub25Sb29tQmV0cy5wdXNoKGJldFBsYXllcik7XG4gICAgICAgIHJvdWxldHRlRGF0YS5vblJvb21CZXRzLnJldmVyc2UoKTtcblxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgb25Sb29tVG90YWxCZXQubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICBjb25zdCB0b3RhbERhdGEgPSBvblJvb21Ub3RhbEJldFtpbmRleF07XG4gICAgICAgICAgICBpZiAodG90YWxEYXRhLmNvbG9yID09IGRhdGEuaW5mby5Db2xvcikge1xuICAgICAgICAgICAgICAgIGxldCBjaGlwcyA9IE51bWJlcih0b3RhbERhdGEuY2hpcHMpO1xuICAgICAgICAgICAgICAgIGNoaXBzICs9IE51bWJlcihkYXRhLmluZm8uQmV0R29sZCk7XG4gICAgICAgICAgICAgICAgdG90YWxEYXRhLmNoaXBzID0gY2hpcHM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZGlzcGF0Y2goXCJFdmVudF9SMkNfQmV0X01lc1wiKTtcbiAgICB9XG5cbiAgICBvblIyQ19HZXRCZXRSYW5kSW5mb19SZXMoZGF0YTogTVNULlIyQ19HZXRCZXRSYW5kSW5mb19SZXMpIHtcbiAgICAgICAgaWYgKGRhdGEuRXJyb3IgIT09IDApIHtcbiAgICAgICAgICAgIFBhbmVsSGVscC5zaG93RXJyVGlwKGRhdGEuRXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcm91bGV0dGVEYXRhID0gRy5EYXRhTWdyLmdldChSb3VsZXR0ZURhdGEpO1xuICAgICAgICByb3VsZXR0ZURhdGEuYmV0QmlnUmFua0luZm8gPSBbXTtcbiAgICAgICAgZm9yIChsZXQgdiBvZiBkYXRhLnJlY29yZHMpIHtcbiAgICAgICAgICAgIGxldCBiZXRQbGF5ZXI6IFJvdWxldHRlSW50ZXJmYWNlLkJldFBsYXllciA9IHtcbiAgICAgICAgICAgICAgICBiZXRJbmZvOiB2LFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcm91bGV0dGVEYXRhLmJldEJpZ1JhbmtJbmZvLnB1c2goYmV0UGxheWVyKTtcbiAgICAgICAgfVxuICAgICAgICBkaXNwYXRjaChcIkV2ZW50X1IyQ19HZXRCZXRSYW5kSW5mb19SZXNcIik7XG4gICAgfVxuXG4gICAgb25SMkNfR2V0R2FtZVJlY29yZHNfUmVzKGRhdGE6IE1TVC5SMkNfR2V0R2FtZVJlY29yZHNfUmVzKSB7XG4gICAgICAgIGRpc3BhdGNoKFwiRXZlbnRfUjJDX0dldEdhbWVSZWNvcmRzX1Jlc1wiLCBkYXRhKTtcbiAgICB9XG5cbiAgICBvblIyQ19HZXRCZXRJbmZvX1JlcyhkYXRhOiBNU1QuUjJDX0dldEJldEluZm9fUmVzKSB7XG4gICAgICAgIGlmIChkYXRhLkVycm9yICE9PSAwKSB7XG4gICAgICAgICAgICBQYW5lbEhlbHAuc2hvd0VyclRpcChkYXRhLkVycm9yKTtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICAgIGRpc3BhdGNoKFwiRXZlbnRfb25SMkNfR2V0QmV0SW5mb19SZXNcIiwgZGF0YSk7XG4gICAgfVxuXG59XG5cbk1hbmFnZXIubmV0TWFuYWdlci5wdXNoKFJvdWxldHRlTmV0Q29udHJvbGxlcik7XG4iXX0=