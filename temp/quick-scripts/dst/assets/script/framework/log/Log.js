
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/script/framework/log/Log.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'b2666lmhPFG6rCsrUUmDtv5', 'Log');
// script/framework/log/Log.ts

"use strict";
/**
 * @description 日志封装
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.Log = exports.LogLevel = void 0;
var LogLevel;
(function (LogLevel) {
    LogLevel[LogLevel["LOG"] = 1] = "LOG";
    LogLevel[LogLevel["DUMP"] = 16] = "DUMP";
    LogLevel[LogLevel["WARN"] = 256] = "WARN";
    LogLevel[LogLevel["ERROR"] = 4096] = "ERROR";
    LogLevel[LogLevel["ALL"] = 4369] = "ALL";
})(LogLevel = exports.LogLevel || (exports.LogLevel = {}));
class _Log {
    constructor() {
        this._level = LogLevel.ALL;
        this._forceNativeLog = false;
    }
    get logLevel() {
        return this._level;
    }
    set logLevel(value) {
        this._level = value;
        this.bindLogHandler();
    }
    get forceNativeLog() {
        return this._forceNativeLog;
    }
    set forceNativeLog(value) {
        this._forceNativeLog = value;
    }
    /**@description 是否使用附加控制台方式,强制*/
    get isUsingConsole() {
        let win = window;
        if (win.vConsole) {
            return true;
        }
        return false;
    }
    get isDebug() {
        if (this.isUsingConsole) {
            return true;
        }
        if (cc.sys.isNative && this.forceNativeLog) {
            return true;
        }
        return CC_DEBUG;
    }
    _bindLogHanler(usingCustom) {
        if (usingCustom) {
            G.Logger.log("--------using custom log--------");
            let backupcc = window["cc"];
            if (!backupcc.dump) {
                window["cc"].dump = this.dump.bind(this);
            }
            cc.log = this.log.bind(this);
            cc.warn = this.warn.bind(this);
            cc.error = this.error.bind(this);
            if ((this.logLevel & LogLevel.LOG) && this.isDebug) {
                window["cc"].time = console.time;
                window["cc"].timeEnd = console.timeEnd;
            }
            else {
                window["cc"].time = this.doNothing.bind(this);
                window["cc"].timeEnd = this.doNothing.bind(this);
            }
        }
        else {
            G.Logger.log(`--------using default log--------`);
            if (this.logLevel & LogLevel.DUMP) {
                let backupcc = window["cc"];
                if (!backupcc.dump) {
                    window["cc"].dump = this.dump.bind(this);
                }
            }
            else {
                cc.dump = this.doNothing.bind(this);
            }
            if (this.logLevel & LogLevel.WARN) {
            }
            else {
                cc.warn = this.doNothing.bind(this);
            }
            if ((this.logLevel & LogLevel.LOG) && this.isDebug) {
                window["cc"].time = console.time;
                window["cc"].timeEnd = console.timeEnd;
            }
            else {
                window["cc"].time = this.doNothing.bind(this);
                window["cc"].timeEnd = this.doNothing.bind(this);
            }
        }
    }
    bindLogHandler() {
        if (this.isUsingConsole) {
            this._bindLogHanler(true);
        }
        else {
            if (cc.sys.isMobile) {
                G.Logger.log("--------isMobile-----------");
                this._bindLogHanler(true);
            }
            else {
                G.Logger.log(`--------other------os-----${cc.sys.os}`);
                G.Logger.log(`isdebug : ${CC_DEBUG}`);
                this._bindLogHanler(false);
            }
        }
    }
    log() {
        if (this.logLevel & LogLevel.LOG) {
            if (!this.isDebug)
                return;
            let backupLog = G.Logger.log || cc.log || window["log"];
            backupLog.call(_Log, `${this.getDateString()} INFO : ` + cc.js.formatStr.apply(cc, arguments), this.stack());
        }
    }
    dump() {
        if (this.logLevel & LogLevel.DUMP) {
            if (!this.isDebug)
                return;
            let ret = this._dump(arguments[0], arguments[1], arguments[2], arguments[4]);
            let backupLog = console.info || cc.log || window["info"];
            backupLog.call(_Log, `${this.getDateString()} DUMP : ` + cc.js.formatStr.apply(cc, [ret]), this.stack());
        }
    }
    warn() {
        if (this.logLevel & LogLevel.WARN) {
            if (!this.isDebug)
                return;
            let backupLog = G.Logger.warn || cc.warn || window["warn"];
            backupLog.call(_Log, `${this.getDateString()} WARN : ` + cc.js.formatStr.apply(cc, arguments), this.stack());
        }
    }
    error() {
        if (this.logLevel & LogLevel.ERROR) {
            if (!this.isDebug)
                return;
            if (cc.sys.isNative) {
                try {
                    let backupLog = G.Logger.log || cc.log || window["log"];
                    backupLog.call(_Log, `${this.getDateString()} ERROR : ` + cc.js.formatStr.apply(cc, arguments), this.stack());
                }
                catch (error) {
                    G.Logger.log(`---error---`);
                    G.Logger.error(error);
                }
            }
            else {
                let backupLog = G.Logger.error || cc.error || window["error"];
                backupLog.call(_Log, `${this.getDateString()} ERROR : ` + cc.js.formatStr.apply(cc, arguments), this.stack());
            }
        }
    }
    getDateString() {
        var d = new Date();
        var str = d.getHours() + "";
        var timeStr = "";
        timeStr += (str.length === 1 ? ("0" + str) : str) + ":";
        str = d.getMinutes() + "";
        timeStr += (str.length === 1 ? ("0" + str) : str) + ":";
        str = d.getSeconds() + "";
        timeStr += (str.length === 1 ? ("0" + str) : str) + ".";
        str = d.getMilliseconds() + "";
        if (str.length === 1)
            str = "00" + str;
        if (str.length === 2)
            str = "0" + str;
        timeStr += str;
        timeStr = '[' + timeStr + ']';
        return timeStr;
    }
    stack() {
        var e = new Error();
        var lines = e.stack.split("\n");
        lines.shift();
        var result = [];
        lines.forEach((line) => {
            line = line.substring(7);
            var lineBreak = line.split(" ");
            if (lineBreak.length < 2) {
                result.push(lineBreak[0]);
            }
            else {
                result.push({ [lineBreak[0]]: lineBreak[1] });
            }
        });
        if (result.length > 2) {
            let temp = "\n" + JSON.stringify(result[2]);
            return temp;
        }
        else {
            let temp = "";
            return temp;
        }
    }
    _dump(var_value, var_name = "unkown_dump_name", level = 2, indent_by = 0) {
        if (level < 0) {
            return "...";
        }
        indent_by = indent_by + 3;
        let self = this;
        let do_boolean = function (v) {
            return 'Boolean(1) ' + (v ? 'TRUE' : 'FALSE');
        };
        let do_number = function (v) {
            return v;
        };
        let do_string = function (v) {
            return '"' + v + '"';
        };
        let do_object = function (v) {
            if (v === null) {
                return "NULL(0)";
            }
            let out = '';
            let num_elem = 0;
            let indent = '';
            if (v instanceof Array) {
                num_elem = v.length;
                for (let d = 0; d < indent_by; ++d) {
                    indent += ' ';
                }
                out = "Array(" + num_elem + ") " + (indent.length === 0 ? '' : '') + "[";
                for (let i = 0; i < num_elem; ++i) {
                    out += "\n" + (indent.length === 0 ? '' : '' + indent) + "   [" + i + "] = " + self._dump(v[i], '', level, indent_by);
                }
                out += "\n" + (indent.length === 0 ? '' : '' + indent + '') + "]";
                return out;
            }
            else if (v instanceof Object) {
                for (let d = 0; d < indent_by; ++d) {
                    indent += ' ';
                }
                out = "{";
                for (let p in v) {
                    out += "\n" + (indent.length === 0 ? '' : '' + indent) + "   [" + p + "] = " + self._dump(v[p], '', level, indent_by);
                }
                out += "\n" + (indent.length === 0 ? '' : '' + indent + '') + "}";
                return out;
            }
            else {
                return 'Unknown Object Type!';
            }
        };
        var_name = typeof var_name === 'undefined' ? '' : var_name;
        let out = '';
        let v_name = '';
        switch (typeof var_value) {
            case "boolean":
                v_name = var_name.length > 0 ? var_name + ' = ' : '';
                out += v_name + do_boolean(var_value);
                break;
            case "number":
                v_name = var_name.length > 0 ? var_name + ' = ' : '';
                out += v_name + do_number(var_value);
                break;
            case "string":
                v_name = var_name.length > 0 ? var_name + ' = ' : '';
                out += v_name + do_string(var_value);
                break;
            case "object":
                v_name = var_name.length > 0 ? var_name + ' => ' : '';
                out += v_name + do_object(var_value);
                break;
            case "function":
                v_name = var_name.length > 0 ? var_name + ' = ' : '';
                out += v_name + "Function";
                break;
            case "undefined":
                v_name = var_name.length > 0 ? var_name + ' = ' : '';
                out += v_name + "Undefined";
                break;
            default:
                out += v_name + ' is unknown type!';
        }
        return out;
    }
    doNothing() {
    }
}
exports.Log = new _Log();

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHQvZnJhbWV3b3JrL2xvZy9Mb2cudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztHQUVHOzs7QUFFSCxJQUFZLFFBTVg7QUFORCxXQUFZLFFBQVE7SUFDaEIscUNBQWdCLENBQUE7SUFDaEIsd0NBQWlCLENBQUE7SUFDakIseUNBQWlCLENBQUE7SUFDakIsNENBQWtCLENBQUE7SUFDbEIsd0NBQStCLENBQUE7QUFDbkMsQ0FBQyxFQU5XLFFBQVEsR0FBUixnQkFBUSxLQUFSLGdCQUFRLFFBTW5CO0FBRUQsTUFBTSxJQUFJO0lBQVY7UUFDWSxXQUFNLEdBQVcsUUFBUSxDQUFDLEdBQUcsQ0FBQztRQUM5QixvQkFBZSxHQUFZLEtBQUssQ0FBQztJQWdSN0MsQ0FBQztJQS9RRyxJQUFXLFFBQVE7UUFDZixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDdkIsQ0FBQztJQUNELElBQVcsUUFBUSxDQUFDLEtBQWE7UUFDN0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFDcEIsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQzFCLENBQUM7SUFFRCxJQUFXLGNBQWM7UUFDckIsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDO0lBQ2hDLENBQUM7SUFDRCxJQUFXLGNBQWMsQ0FBQyxLQUFjO1FBQ3BDLElBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDO0lBQ2pDLENBQUM7SUFDRCxnQ0FBZ0M7SUFDaEMsSUFBWSxjQUFjO1FBQ3RCLElBQUksR0FBRyxHQUFTLE1BQU0sQ0FBQztRQUN2QixJQUFLLEdBQUcsQ0FBQyxRQUFRLEVBQUU7WUFDZixPQUFPLElBQUksQ0FBQztTQUNmO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQUVELElBQVcsT0FBTztRQUNkLElBQUssSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUN0QixPQUFPLElBQUksQ0FBQztTQUNmO1FBQ0QsSUFBSSxFQUFFLENB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QUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7Z0JBQ3RELEdBQUcsSUFBSSxNQUFNLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUNyQyxNQUFNO1lBQ1YsS0FBSyxVQUFVO2dCQUNYLE1BQU0sR0FBRyxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO2dCQUNyRCxHQUFHLElBQUksTUFBTSxHQUFHLFVBQVUsQ0FBQztnQkFDM0IsTUFBTTtZQUNWLEtBQUssV0FBVztnQkFDWixNQUFNLEdBQUcsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztnQkFDckQsR0FBRyxJQUFJLE1BQU0sR0FBRyxXQUFXLENBQUM7Z0JBQzVCLE1BQU07WUFDVjtnQkFDSSxHQUFHLElBQUksTUFBTSxHQUFHLG1CQUFtQixDQUFDO1NBQzNDO1FBQ0QsT0FBTyxHQUFHLENBQUM7SUFDZixDQUFDO0lBRU8sU0FBUztJQUVqQixDQUFDO0NBQ0o7QUFFVSxRQUFBLEdBQUcsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDIiwiZmlsZSI6IiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZGVzY3JpcHRpb24g5pel5b+X5bCB6KOFXG4gKi9cblxuZXhwb3J0IGVudW0gTG9nTGV2ZWwge1xuICAgIExPRyA9IDBYMDAwMDAwMDEsXG4gICAgRFVNUCA9IDBYMDAwMDAwMTAsXG4gICAgV0FSTiA9IDBYMDAwMDAxMDAsXG4gICAgRVJST1IgPSAwWDAwMDAxMDAwLFxuICAgIEFMTCA9IExPRyB8IERVTVAgfCBXQVJOIHwgRVJST1IgLFxufVxuXG5jbGFzcyBfTG9nIHtcbiAgICBwcml2YXRlIF9sZXZlbDogbnVtYmVyID0gTG9nTGV2ZWwuQUxMO1xuICAgIHByaXZhdGUgX2ZvcmNlTmF0aXZlTG9nOiBib29sZWFuID0gZmFsc2U7XG4gICAgcHVibGljIGdldCBsb2dMZXZlbCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fbGV2ZWw7XG4gICAgfVxuICAgIHB1YmxpYyBzZXQgbG9nTGV2ZWwodmFsdWU6IG51bWJlcikge1xuICAgICAgICB0aGlzLl9sZXZlbCA9IHZhbHVlO1xuICAgICAgICB0aGlzLmJpbmRMb2dIYW5kbGVyKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldCBmb3JjZU5hdGl2ZUxvZygpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ZvcmNlTmF0aXZlTG9nO1xuICAgIH1cbiAgICBwdWJsaWMgc2V0IGZvcmNlTmF0aXZlTG9nKHZhbHVlOiBib29sZWFuKSB7XG4gICAgICAgIHRoaXMuX2ZvcmNlTmF0aXZlTG9nID0gdmFsdWU7XG4gICAgfVxuICAgIC8qKkBkZXNjcmlwdGlvbiDmmK/lkKbkvb/nlKjpmYTliqDmjqfliLblj7DmlrnlvI8s5by65Yi2Ki9cbiAgICBwcml2YXRlIGdldCBpc1VzaW5nQ29uc29sZSggKXtcbiAgICAgICAgbGV0IHdpbiA6IGFueSA9IHdpbmRvdztcbiAgICAgICAgaWYgKCB3aW4udkNvbnNvbGUgKXtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IGlzRGVidWcoICl7XG4gICAgICAgIGlmICggdGhpcy5pc1VzaW5nQ29uc29sZSApe1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSAmJiB0aGlzLmZvcmNlTmF0aXZlTG9nKXtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDQ19ERUJVRztcbiAgICB9XG5cbiAgICBwcml2YXRlIF9iaW5kTG9nSGFubGVyKCB1c2luZ0N1c3RvbSA6IGJvb2xlYW4gKXtcbiAgICAgICAgaWYgKHVzaW5nQ3VzdG9tKSB7XG4gICAgICAgICAgICBHLkxvZ2dlci5sb2coXCItLS0tLS0tLXVzaW5nIGN1c3RvbSBsb2ctLS0tLS0tLVwiKTtcbiAgICAgICAgICAgIGxldCBiYWNrdXBjYyA9IHdpbmRvd1tcImNjXCJdO1xuICAgICAgICAgICAgaWYgKCFiYWNrdXBjYy5kdW1wKSB7XG4gICAgICAgICAgICAgICAgd2luZG93W1wiY2NcIl0uZHVtcCA9IHRoaXMuZHVtcC5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2MubG9nID0gdGhpcy5sb2cuYmluZCh0aGlzKTtcbiAgICAgICAgICAgIGNjLndhcm4gPSB0aGlzLndhcm4uYmluZCh0aGlzKTtcbiAgICAgICAgICAgIGNjLmVycm9yID0gdGhpcy5lcnJvci5iaW5kKHRoaXMpO1xuXG4gICAgICAgICAgICBpZiAoICh0aGlzLmxvZ0xldmVsICYgTG9nTGV2ZWwuTE9HKSAmJiB0aGlzLmlzRGVidWcgKXtcbiAgICAgICAgICAgICAgICB3aW5kb3dbXCJjY1wiXS50aW1lID0gY29uc29sZS50aW1lO1xuICAgICAgICAgICAgICAgIHdpbmRvd1tcImNjXCJdLnRpbWVFbmQgPSBjb25zb2xlLnRpbWVFbmQ7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICB3aW5kb3dbXCJjY1wiXS50aW1lID0gdGhpcy5kb05vdGhpbmcuYmluZCh0aGlzKTtcbiAgICAgICAgICAgICAgICB3aW5kb3dbXCJjY1wiXS50aW1lRW5kID0gdGhpcy5kb05vdGhpbmcuYmluZCh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIEcuTG9nZ2VyLmxvZyhgLS0tLS0tLS11c2luZyBkZWZhdWx0IGxvZy0tLS0tLS0tYCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmxvZ0xldmVsICYgTG9nTGV2ZWwuRFVNUCkge1xuICAgICAgICAgICAgICAgIGxldCBiYWNrdXBjYyA9IHdpbmRvd1tcImNjXCJdO1xuICAgICAgICAgICAgICAgIGlmICghYmFja3VwY2MuZHVtcCkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3dbXCJjY1wiXS5kdW1wID0gdGhpcy5kdW1wLmJpbmQodGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYy5kdW1wID0gdGhpcy5kb05vdGhpbmcuYmluZCh0aGlzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMubG9nTGV2ZWwgJiBMb2dMZXZlbC5XQVJOKSB7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2Mud2FybiA9IHRoaXMuZG9Ob3RoaW5nLmJpbmQodGhpcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggKHRoaXMubG9nTGV2ZWwgJiBMb2dMZXZlbC5MT0cpICYmIHRoaXMuaXNEZWJ1ZyApe1xuICAgICAgICAgICAgICAgIHdpbmRvd1tcImNjXCJdLnRpbWUgPSBjb25zb2xlLnRpbWU7XG4gICAgICAgICAgICAgICAgd2luZG93W1wiY2NcIl0udGltZUVuZCA9IGNvbnNvbGUudGltZUVuZDtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHdpbmRvd1tcImNjXCJdLnRpbWUgPSB0aGlzLmRvTm90aGluZy5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgICAgIHdpbmRvd1tcImNjXCJdLnRpbWVFbmQgPSB0aGlzLmRvTm90aGluZy5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBiaW5kTG9nSGFuZGxlcigpIHtcbiAgICAgICAgaWYgKCB0aGlzLmlzVXNpbmdDb25zb2xlICl7XG4gICAgICAgICAgICB0aGlzLl9iaW5kTG9nSGFubGVyKHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgICBpZiAoY2Muc3lzLmlzTW9iaWxlKSB7XG4gICAgICAgICAgICAgICAgRy5Mb2dnZXIubG9nKFwiLS0tLS0tLS1pc01vYmlsZS0tLS0tLS0tLS0tXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2JpbmRMb2dIYW5sZXIodHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBHLkxvZ2dlci5sb2coYC0tLS0tLS0tb3RoZXItLS0tLS1vcy0tLS0tJHtjYy5zeXMub3N9YCk7XG4gICAgICAgICAgICAgICAgRy5Mb2dnZXIubG9nKGBpc2RlYnVnIDogJHtDQ19ERUJVR31gKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9iaW5kTG9nSGFubGVyKGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBsb2coKSB7XG4gICAgICAgIGlmICh0aGlzLmxvZ0xldmVsICYgTG9nTGV2ZWwuTE9HKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNEZWJ1ZykgcmV0dXJuO1xuICAgICAgICAgICAgbGV0IGJhY2t1cExvZyA9IEcuTG9nZ2VyLmxvZyB8fCBjYy5sb2cgfHwgd2luZG93W1wibG9nXCJdO1xuICAgICAgICAgICAgYmFja3VwTG9nLmNhbGwoX0xvZywgYCR7dGhpcy5nZXREYXRlU3RyaW5nKCl9IElORk8gOiBgICsgY2MuanMuZm9ybWF0U3RyLmFwcGx5KGNjLCBhcmd1bWVudHMpLCB0aGlzLnN0YWNrKCkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGR1bXAoKSB7XG4gICAgICAgIGlmICh0aGlzLmxvZ0xldmVsICYgTG9nTGV2ZWwuRFVNUCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzRGVidWcpIHJldHVybjtcbiAgICAgICAgICAgIGxldCByZXQgPSB0aGlzLl9kdW1wKGFyZ3VtZW50c1swXSwgYXJndW1lbnRzWzFdLCBhcmd1bWVudHNbMl0sIGFyZ3VtZW50c1s0XSk7XG4gICAgICAgICAgICBsZXQgYmFja3VwTG9nID0gY29uc29sZS5pbmZvIHx8IGNjLmxvZyB8fCB3aW5kb3dbXCJpbmZvXCJdO1xuICAgICAgICAgICAgYmFja3VwTG9nLmNhbGwoX0xvZywgYCR7dGhpcy5nZXREYXRlU3RyaW5nKCl9IERVTVAgOiBgICsgY2MuanMuZm9ybWF0U3RyLmFwcGx5KGNjLCBbcmV0XSksIHRoaXMuc3RhY2soKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgd2FybigpIHtcbiAgICAgICAgaWYgKHRoaXMubG9nTGV2ZWwgJiBMb2dMZXZlbC5XQVJOKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNEZWJ1ZykgcmV0dXJuO1xuICAgICAgICAgICAgbGV0IGJhY2t1cExvZyA9IEcuTG9nZ2VyLndhcm4gfHwgY2Mud2FybiB8fCB3aW5kb3dbXCJ3YXJuXCJdO1xuICAgICAgICAgICAgYmFja3VwTG9nLmNhbGwoX0xvZywgYCR7dGhpcy5nZXREYXRlU3RyaW5nKCl9IFdBUk4gOiBgICsgY2MuanMuZm9ybWF0U3RyLmFwcGx5KGNjLCBhcmd1bWVudHMpLCB0aGlzLnN0YWNrKCkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGVycm9yKCkge1xuICAgICAgICBpZiAodGhpcy5sb2dMZXZlbCAmIExvZ0xldmVsLkVSUk9SKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNEZWJ1ZykgcmV0dXJuO1xuICAgICAgICAgICAgaWYgKCBjYy5zeXMuaXNOYXRpdmUgKXtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgYmFja3VwTG9nID0gRy5Mb2dnZXIubG9nIHx8IGNjLmxvZyB8fCB3aW5kb3dbXCJsb2dcIl07XG4gICAgICAgICAgICAgICAgICAgIGJhY2t1cExvZy5jYWxsKF9Mb2csIGAke3RoaXMuZ2V0RGF0ZVN0cmluZygpfSBFUlJPUiA6IGAgKyBjYy5qcy5mb3JtYXRTdHIuYXBwbHkoY2MsIGFyZ3VtZW50cyksIHRoaXMuc3RhY2soKSk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgRy5Mb2dnZXIubG9nKGAtLS1lcnJvci0tLWApO1xuICAgICAgICAgICAgICAgICAgICBHLkxvZ2dlci5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgbGV0IGJhY2t1cExvZyA9IEcuTG9nZ2VyLmVycm9yIHx8IGNjLmVycm9yIHx8IHdpbmRvd1tcImVycm9yXCJdO1xuICAgICAgICAgICAgICAgIGJhY2t1cExvZy5jYWxsKF9Mb2csIGAke3RoaXMuZ2V0RGF0ZVN0cmluZygpfSBFUlJPUiA6IGAgKyBjYy5qcy5mb3JtYXRTdHIuYXBwbHkoY2MsIGFyZ3VtZW50cyksIHRoaXMuc3RhY2soKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldERhdGVTdHJpbmcoKSB7XG4gICAgICAgIHZhciBkID0gbmV3IERhdGUoKTtcbiAgICAgICAgdmFyIHN0ciA9IGQuZ2V0SG91cnMoKSArIFwiXCI7XG4gICAgICAgIHZhciB0aW1lU3RyID0gXCJcIjtcbiAgICAgICAgdGltZVN0ciArPSAoc3RyLmxlbmd0aCA9PT0gMSA/IChcIjBcIiArIHN0cikgOiBzdHIpICsgXCI6XCI7XG5cbiAgICAgICAgc3RyID0gZC5nZXRNaW51dGVzKCkgKyBcIlwiO1xuICAgICAgICB0aW1lU3RyICs9IChzdHIubGVuZ3RoID09PSAxID8gKFwiMFwiICsgc3RyKSA6IHN0cikgKyBcIjpcIjtcblxuICAgICAgICBzdHIgPSBkLmdldFNlY29uZHMoKSArIFwiXCI7XG4gICAgICAgIHRpbWVTdHIgKz0gKHN0ci5sZW5ndGggPT09IDEgPyAoXCIwXCIgKyBzdHIpIDogc3RyKSArIFwiLlwiO1xuXG4gICAgICAgIHN0ciA9IGQuZ2V0TWlsbGlzZWNvbmRzKCkgKyBcIlwiO1xuICAgICAgICBpZiAoc3RyLmxlbmd0aCA9PT0gMSkgc3RyID0gXCIwMFwiICsgc3RyO1xuICAgICAgICBpZiAoc3RyLmxlbmd0aCA9PT0gMikgc3RyID0gXCIwXCIgKyBzdHI7XG4gICAgICAgIHRpbWVTdHIgKz0gc3RyO1xuXG4gICAgICAgIHRpbWVTdHIgPSAnWycgKyB0aW1lU3RyICsgJ10nO1xuXG4gICAgICAgIHJldHVybiB0aW1lU3RyO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhY2soKSB7XG4gICAgICAgIHZhciBlID0gbmV3IEVycm9yKCk7XG4gICAgICAgIHZhciBsaW5lcyA9IGUuc3RhY2suc3BsaXQoXCJcXG5cIik7XG4gICAgICAgIGxpbmVzLnNoaWZ0KCk7XG4gICAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgICAgbGluZXMuZm9yRWFjaCgobGluZSkgPT4ge1xuICAgICAgICAgICAgbGluZSA9IGxpbmUuc3Vic3RyaW5nKDcpO1xuICAgICAgICAgICAgdmFyIGxpbmVCcmVhayA9IGxpbmUuc3BsaXQoXCIgXCIpO1xuICAgICAgICAgICAgaWYgKGxpbmVCcmVhay5sZW5ndGggPCAyKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobGluZUJyZWFrWzBdKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goeyBbbGluZUJyZWFrWzBdXTogbGluZUJyZWFrWzFdIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCByZXN1bHQubGVuZ3RoID4gMiApe1xuICAgICAgICAgICAgbGV0IHRlbXAgPSBcIlxcblwiICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0WzJdKTtcbiAgICAgICAgICAgIHJldHVybiB0ZW1wO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGxldCB0ZW1wID0gXCJcIjtcbiAgICAgICAgICAgIHJldHVybiB0ZW1wO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICBwcml2YXRlIF9kdW1wKHZhcl92YWx1ZTogYW55LCB2YXJfbmFtZTogc3RyaW5nID0gXCJ1bmtvd25fZHVtcF9uYW1lXCIsIGxldmVsOiBudW1iZXIgPSAyLCBpbmRlbnRfYnk6IG51bWJlciA9IDApOiBzdHJpbmcge1xuICAgICAgICBpZiAobGV2ZWwgPCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gXCIuLi5cIlxuICAgICAgICB9XG4gICAgICAgIGluZGVudF9ieSA9IGluZGVudF9ieSArIDM7XG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcbiAgICAgICAgbGV0IGRvX2Jvb2xlYW4gPSBmdW5jdGlvbiAodjogYm9vbGVhbikge1xuICAgICAgICAgICAgcmV0dXJuICdCb29sZWFuKDEpICcgKyAodiA/ICdUUlVFJyA6ICdGQUxTRScpO1xuICAgICAgICB9O1xuICAgICAgICBsZXQgZG9fbnVtYmVyID0gZnVuY3Rpb24gKHY6IG51bWJlcikge1xuICAgICAgICAgICAgcmV0dXJuIHY7XG4gICAgICAgIH07XG4gICAgICAgIGxldCBkb19zdHJpbmcgPSBmdW5jdGlvbiAodjogc3RyaW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gJ1wiJyArIHYgKyAnXCInO1xuICAgICAgICB9O1xuICAgICAgICBsZXQgZG9fb2JqZWN0ID0gZnVuY3Rpb24gKHY6IGFueSkge1xuICAgICAgICAgICAgaWYgKHYgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJOVUxMKDApXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgb3V0ID0gJyc7XG4gICAgICAgICAgICBsZXQgbnVtX2VsZW0gPSAwO1xuICAgICAgICAgICAgbGV0IGluZGVudCA9ICcnO1xuXG4gICAgICAgICAgICBpZiAodiBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICAgICAgbnVtX2VsZW0gPSB2Lmxlbmd0aDtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBkID0gMDsgZCA8IGluZGVudF9ieTsgKytkKSB7XG4gICAgICAgICAgICAgICAgICAgIGluZGVudCArPSAnICc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG91dCA9IFwiQXJyYXkoXCIgKyBudW1fZWxlbSArIFwiKSBcIiArIChpbmRlbnQubGVuZ3RoID09PSAwID8gJycgOiAnJykgKyBcIltcIjtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bV9lbGVtOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgb3V0ICs9IFwiXFxuXCIgKyAoaW5kZW50Lmxlbmd0aCA9PT0gMCA/ICcnIDogJycgKyBpbmRlbnQpICsgXCIgICBbXCIgKyBpICsgXCJdID0gXCIgKyBzZWxmLl9kdW1wKHZbaV0sICcnLCBsZXZlbCwgaW5kZW50X2J5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgb3V0ICs9IFwiXFxuXCIgKyAoaW5kZW50Lmxlbmd0aCA9PT0gMCA/ICcnIDogJycgKyBpbmRlbnQgKyAnJykgKyBcIl1cIjtcbiAgICAgICAgICAgICAgICByZXR1cm4gb3V0O1xuICAgICAgICAgICAgfSBlbHNlIGlmICh2IGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgZCA9IDA7IGQgPCBpbmRlbnRfYnk7ICsrZCkge1xuICAgICAgICAgICAgICAgICAgICBpbmRlbnQgKz0gJyAnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvdXQgPSBcIntcIjtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBwIGluIHYpIHtcbiAgICAgICAgICAgICAgICAgICAgb3V0ICs9IFwiXFxuXCIgKyAoaW5kZW50Lmxlbmd0aCA9PT0gMCA/ICcnIDogJycgKyBpbmRlbnQpICsgXCIgICBbXCIgKyBwICsgXCJdID0gXCIgKyBzZWxmLl9kdW1wKHZbcF0sICcnLCBsZXZlbCwgaW5kZW50X2J5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgb3V0ICs9IFwiXFxuXCIgKyAoaW5kZW50Lmxlbmd0aCA9PT0gMCA/ICcnIDogJycgKyBpbmRlbnQgKyAnJykgKyBcIn1cIjtcbiAgICAgICAgICAgICAgICByZXR1cm4gb3V0O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ1Vua25vd24gT2JqZWN0IFR5cGUhJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdmFyX25hbWUgPSB0eXBlb2YgdmFyX25hbWUgPT09ICd1bmRlZmluZWQnID8gJycgOiB2YXJfbmFtZTtcbiAgICAgICAgbGV0IG91dCA9ICcnO1xuICAgICAgICBsZXQgdl9uYW1lID0gJyc7XG4gICAgICAgIHN3aXRjaCAodHlwZW9mIHZhcl92YWx1ZSkge1xuICAgICAgICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgICAgICAgICAgICB2X25hbWUgPSB2YXJfbmFtZS5sZW5ndGggPiAwID8gdmFyX25hbWUgKyAnID0gJyA6ICcnO1xuICAgICAgICAgICAgICAgIG91dCArPSB2X25hbWUgKyBkb19ib29sZWFuKHZhcl92YWx1ZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgICAgICAgICAgICAgdl9uYW1lID0gdmFyX25hbWUubGVuZ3RoID4gMCA/IHZhcl9uYW1lICsgJyA9ICcgOiAnJztcbiAgICAgICAgICAgICAgICBvdXQgKz0gdl9uYW1lICsgZG9fbnVtYmVyKHZhcl92YWx1ZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgICAgICAgICAgICAgdl9uYW1lID0gdmFyX25hbWUubGVuZ3RoID4gMCA/IHZhcl9uYW1lICsgJyA9ICcgOiAnJztcbiAgICAgICAgICAgICAgICBvdXQgKz0gdl9uYW1lICsgZG9fc3RyaW5nKHZhcl92YWx1ZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwib2JqZWN0XCI6XG4gICAgICAgICAgICAgICAgdl9uYW1lID0gdmFyX25hbWUubGVuZ3RoID4gMCA/IHZhcl9uYW1lICsgJyA9PiAnIDogJyc7XG4gICAgICAgICAgICAgICAgb3V0ICs9IHZfbmFtZSArIGRvX29iamVjdCh2YXJfdmFsdWUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImZ1bmN0aW9uXCI6XG4gICAgICAgICAgICAgICAgdl9uYW1lID0gdmFyX25hbWUubGVuZ3RoID4gMCA/IHZhcl9uYW1lICsgJyA9ICcgOiAnJztcbiAgICAgICAgICAgICAgICBvdXQgKz0gdl9uYW1lICsgXCJGdW5jdGlvblwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgICAgICAgICAgICAgIHZfbmFtZSA9IHZhcl9uYW1lLmxlbmd0aCA+IDAgPyB2YXJfbmFtZSArICcgPSAnIDogJyc7XG4gICAgICAgICAgICAgICAgb3V0ICs9IHZfbmFtZSArIFwiVW5kZWZpbmVkXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIG91dCArPSB2X25hbWUgKyAnIGlzIHVua25vd24gdHlwZSEnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvdXQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkb05vdGhpbmcoKSB7XG5cbiAgICB9XG59XG5cbmV4cG9ydCBsZXQgTG9nID0gbmV3IF9Mb2coKTtcbiJdfQ==