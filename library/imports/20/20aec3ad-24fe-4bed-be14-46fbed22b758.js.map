{"version":3,"sources":["assets/script/Helpder/shareTrace/ShareTraceHelpder.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Manager } from \"../../common/manager/Manager\";\nimport { protoPackage, serverType } from \"../../common/net/CommonService\";\nimport { LobbyService } from \"../../common/net/LobbyService\";\nimport { makeKey } from \"../../framework/decorator/Decorators\";\nimport { User } from \"../../global/User\";\n\nlet AppClassName_ShareTrace = \"com/threeoctopus/shareTrace/ShareTraceHelpder\"\n\nclass _ShareTraceHelpder {\n    inviterId = 0 //邀请码\n    agentId = 0//代理ID\n    //最大 定时检测次数\n    timerCheckCount = 0;\n    //最大 定时检测次数\n    maxCount = 3;\n\n    isInit = false;\n    init() {\n        Manager.eventDispatcher.addEventListener(makeKey(serverType.Lobby, protoPackage.hall.HallCmd.CMD_BIND_AGENT), () => {\n            User._inviterId = this.inviterId\n        }, this);\n    }\n\n    //获得邀请码由底层来回调这个方法--- \n    inviteCodeCallBack(dataStr) {\n        G.Logger.log(\"获取邀请码信息成功：\" + dataStr)\n        this.handleData(dataStr);\n    }\n    failed(dataStr) {\n        G.Logger.error(\"ShareTraceHelpder.获取邀请码失败：\" + dataStr)\n    }\n    getData() {\n        var dataInfo = \"\"\n        if (cc.sys.os === cc.sys.OS_IOS) {\n            dataInfo = jsb.reflection.callStaticMethod(\"ShareTraceHelpder\", \"getShareTraceAppDate\", '');\n        }\n        else if (cc.sys.os === cc.sys.OS_ANDROID) {\n            dataInfo = jsb.reflection.callStaticMethod(AppClassName_ShareTrace, \"getShareTraceAppDate\", \"()Ljava/lang/String;\");\n        }\n        // dataInfo = 'http://192.168.6.57:8081/preDownload?agentId=1'\n        // dataInfo = \"http://192.168.6.78/m/preDownload&&userId=3300\"\n        return dataInfo\n\n    }\n    handleData(dataInfo) {\n        G.Logger.warn('getInviterId' + dataInfo)\n        if (dataInfo) {\n            let inviterId = dataInfo.split(\"userId=\")[1] || ''\n            if (inviterId) {\n                this.inviterId = Number(inviterId)\n            } else {\n                let agentId = dataInfo.split(\"agentId=\")[1] || ''\n                if (agentId) {\n                    this.agentId = Number(agentId)\n                }\n            }\n        }\n    }\n    //获取免填邀请码数据\n    getInviterId() {\n        if (cc.sys.isBrowser) return 0;\n        if (this.inviterId != 0) return this.inviterId\n        var dataInfo = this.getData();\n        this.handleData(dataInfo)\n        G.Logger.log(\"邀请码：\" + this.inviterId)\n        return this.inviterId\n    }\n    getAgentId() {\n        if (cc.sys.isBrowser) return 0;\n        if (this.agentId != 0) return this.agentId\n        var dataInfo = this.getData();\n        this.handleData(dataInfo)\n        G.Logger.log(\"代理id：\" + this.agentId)\n        return this.agentId\n    }\n    //检测需要绑定 邀请码不\n    checkNeedBindInviterId(islogin = false) {\n        if (cc.sys.isBrowser) return\n\n        if (User._inviterId != 0) return G.Logger.log(\"已经绑定邀请码：\" + User._inviterId)\n        if (islogin) this.timerCheckCount = this.maxCount;\n        if (this.isInit == false) {\n            this.isInit = true;\n            this.init();\n        }\n\n        G.Logger.warn('checkNeedBindInviterId')\n\n        if (this.inviterId == 0) {\n            this.getInviterId();\n        }\n        if (this.inviterId > 0) {\n            this.bindInviterIdId();\n        } else if (this.timerCheckCount > 0) {\n            this.timerCheckCount -= 1\n            setTimeout(() => {\n                this.checkNeedBindInviterId();\n            }, 3000);\n\n        }\n\n    }\n    //绑定邀请码\n    bindInviterIdId() {\n        if (this.inviterId == 0) return;\n        let req = protoPackage.hall.base.BindAgentReq.create({ inviterId: this.inviterId });\n        let buffer = protoPackage.hall.base.BindAgentReq.encode(req).finish();\n        LobbyService.instance.sendMsg(serverType.Lobby,\n            protoPackage.hall.HallCmd.CMD_BIND_AGENT,\n            buffer);\n    }\n\n}\n\n\nexport let ShareTraceHelpder = new _ShareTraceHelpder()\n"]}