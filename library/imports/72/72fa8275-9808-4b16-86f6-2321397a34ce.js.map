{"version":3,"sources":["assets/script/wallet/AttractRecordView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ListView from \"../common/component/ListView\";\nimport NoneItem from \"../common/item/NoneItem\";\nimport { Manager } from \"../common/manager/Manager\";\nimport { LobbyService } from \"../common/net/LobbyService\";\nimport TypeUtils from \"../common/utils/TypeUtils\";\nimport AppData from \"../data/AppData\";\nimport { ENABLE_CHANGE_LANGUAGE } from \"../framework/base/Defines\";\nimport { IController } from \"../framework/controller/Controller\";\nimport { injectService } from \"../framework/decorator/Decorators\";\nimport { EventApi } from \"../framework/event/EventApi\";\nimport { MST } from \"../framework/external/protoc\";\nimport UIView from \"../framework/ui/UIView\";\nimport PanelHelp from \"../msgbox/PanelHelp\";\n\n\n// 每页数量\nconst PAGE_COUNT: number = 10;\n// 一天毫秒\nconst ONE_DAY_MS: number = 86400000;\n// 默认首次请求分页 ID\nconst DEFAULT_FIRST_ID: number = 0;\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\n@injectService(LobbyService.instance)\nexport default class AttractRecordView extends UIView implements IController<LobbyService> {\n    service: LobbyService;\n\n    @property(cc.Label)\n    private labDate: cc.Label = null;\n\n    @property(cc.Label)\n    private labBankCode: cc.Label = null;\n\n    @property(cc.Label)\n    private labAmount: cc.Label = null;\n\n    @property(ListView)\n    private lsvRecord: ListView = null;\n\n    @property(cc.Node)\n    private titleItem: cc.Node = null;\n\n    @property(NoneItem)\n    private noneItem: NoneItem = null;\n\n    // App 数据\n    private _appData: AppData = null;\n    // 是否最后一页\n    private _isLastPage: boolean = false;\n    // 个人历史下注数据列表\n    private _dataList: MST.IWithDrawRecord[] = null;\n    currentIndexPage: number = 0;\n\n    public static getPrefabUrl() {\n        return \"wallet/prefabes/AttractRecordView\";\n    }\n\n    onLoad() {\n        super.onLoad();\n\n        this.initData();\n        this.initView();\n\n        this.C2S_MyRecord();\n    }\n\n    start() {\n\n    }\n\n    public show(args?: any[]): void {\n        super.show(args);\n\n        this.onLanguageChange();\n    }\n\n    private initData(): void {\n        this._appData = G.DataMgr.get(AppData);\n        this._isLastPage = false;\n        this._dataList = [];\n    }\n\n    private initView(): void {\n        // this.labGameNoTitle.string = \"\";\n        // this.labDate.string = \"\";\n        // this.labBankCode.string = \"\";\n        // this.labAmount.string = \"\";\n\n        // this.noneItem.node.active = false;\n    }\n\n    bindingEvents() {\n        super.bindingEvents();\n\n        if (ENABLE_CHANGE_LANGUAGE) {\n            this.registerEvent(EventApi.CHANGE_LANGUAGE, this.onLanguageChange);\n        }\n\n        this.registerEvent(\"Event_L2C_WithdrawRecord\", this.onEvent_L2C_WithdrawRecord);\n\n    }\n\n    onLanguageChange() {\n\n    }\n\n    private getLastRecordId(): number {\n        let id;\n        id = this.currentIndexPage + PAGE_COUNT;\n        return id;\n    }\n\n    /**\n     * 查询历史记录\n     * @param id {number} id 为了避免查询后，出现重复数据 首次请求默认为 -1 （查询后的数据不包含自身 ID）\n     */\n    private C2S_MyRecord(index?: number): void {\n        if (TypeUtils.isNull(index)) {\n            index = DEFAULT_FIRST_ID;\n        }\n\n        let data: MST.C2L_GetWithdrawReocrds_Req = {\n            RpcId: Manager.netManager.getNewSeqId(),\n            index,\n            limit: PAGE_COUNT,\n        }\n        console.log('C2S_MyRecord ->index :' + index);\n        let req = MST.C2L_GetWithdrawReocrds_Req.create(data);\n        let buffer = MST.C2L_GetWithdrawReocrds_Req.encode(req).finish();\n        this.service.sendMsg(MST.C2L_GetWithdrawReocrds_Req, MST.OuterOpcode_Lobby.C2L_GetWithdrawReocrds_Req, buffer);\n    }\n\n    private onEvent_L2C_WithdrawRecord(data: MST.L2C_GetWithdrawRecords_Res): void {\n        if (data.Error !== 0) {\n            PanelHelp.showErrTip(data.Error);\n            return;\n        }\n        this.currentIndexPage = data.index;\n        if (data.records.length <= 0) {\n            this.noneItem.node.active = true;\n            this.lsvRecord.node.active = false;\n        } else {\n            this.noneItem.node.active = false;\n            this.lsvRecord.node.active = true;\n        }\n\n        // 是否最后一页\n        this._isLastPage = data.records.length < PAGE_COUNT;\n        this._dataList = this._dataList.concat(data.records);\n        this.lsvRecord.insert(data.records);\n    }\n\n    public onClick(ButtonName: any, ButtonNode: any, data?: string): void {\n        switch (ButtonName) {\n            case \"btnClose\":\n                this.close();\n                break;\n        }\n    }\n\n    /**\n     * 上拉回调\n     * @param target \n     */\n    private onPullTop(target: ListView): void {\n        this.C2S_MyRecord(0);\n    }\n\n    /**\n     * 下拉回调\n     */\n    private onPullBottom(target: ListView): void {\n        if (this._isLastPage) {\n            G.Logger.log(\"Crash 浏览个人历史记录 已是最后一页 无需请求翻页\");\n            return;\n        }\n        this.C2S_MyRecord(this.getLastRecordId());\n    }\n\n}\n"]}