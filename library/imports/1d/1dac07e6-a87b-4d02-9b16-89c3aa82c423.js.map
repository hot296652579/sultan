{"version":3,"sources":["assets/script/common/item/TitleItemPageUser.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import UserData from \"../../data/UserData\";\nimport { BUNDLE_RESOURCES } from \"../../framework/base/Defines\";\nimport UIView from \"../../framework/ui/UIView\";\nimport { UtilMgr } from \"../../global/UtilMgr\";\nimport LoginNewView from \"../../login/LoginNewView\";\nimport RechargeNewView from \"../../wallet/RechargeNewView\";\nimport { Manager } from \"../manager/Manager\";\nimport NumberUtils from \"../utils/NumberUtils\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class TitleItemPageUser extends UIView {\n\n    @property(cc.Label)\n    protected labPageName: cc.Label = null;\n\n    @property(cc.Button)\n    protected btnLogin: cc.Button = null;\n\n    @property(cc.Node)\n    protected nodUserInfo: cc.Node = null;\n\n    @property(cc.Sprite)\n    protected imgAvatar: cc.Sprite = null;\n\n    @property(cc.Label)\n    protected labUserName: cc.Label = null;\n\n    @property(cc.Sprite)\n    protected imgGold: cc.Sprite = null;\n\n    @property(cc.Label)\n    protected labGold: cc.Label = null;\n\n    // 用户数据\n    protected _userData: UserData = null;\n\n    onLoad() {\n        super.onLoad();\n\n        this.initData();\n        this.initUI()\n        this.refreshUser();\n    }\n\n    start() {\n\n    }\n\n    protected bindingEvents(): void {\n        super.bindingEvents();\n\n        this.registerEvent(\"Event_M2C_GoldChange_Mes\", this.onEvent_M2C_GoldChange_Mes);\n        this.registerEvent('Event_S2C_ModifyAvartar', this.onRefreshUserInfo);\n        this.registerEvent(\"updateUserInfo\", this.onRefreshUserInfo)\n    }\n\n    protected initData(): void {\n        this._userData = G.DataMgr.get(UserData);\n    }\n\n    protected initUI(): void {\n        this.labPageName.string = \"\";\n        this.btnLogin.node.active = false;\n        this.nodUserInfo.active = false;\n        this.imgAvatar.spriteFrame = null;\n        this.labGold.string = \"\";\n    }\n\n    public onRefreshUserInfo() {\n        this.refreshUser();\n    }\n\n    public setPageName(name: string): void {\n        this.labPageName.string = name;\n    }\n\n    public languagePageName(i18n: (string | number)[] | string): void {\n        this.labPageName.language = i18n;\n    }\n\n    public refreshUser(): void {\n        this.btnLogin.node.active = false;\n        this.nodUserInfo.active = false;\n        if (this._userData.isLogined()) {\n            this.nodUserInfo.active = true;\n            this.refreshAvatar();\n            this.refreshGold();\n            this.refreshNick();\n        } else {\n            this.btnLogin.node.active = true;\n        }\n    }\n\n    protected refreshAvatar(): void {\n        UtilMgr.loadHeadImg(this.imgAvatar, this._userData.info.HeaderUrl, this._userData.info.UnitId, this);\n    }\n\n    public refreshGold(): void {\n        this.labGold.string = NumberUtils.converToC(Number(this._userData.info.Gold));\n    }\n\n    protected refreshNick(): void {\n        this.labUserName.string = UtilMgr.setString(this._userData.info.Nick);\n    }\n\n    /**\n     * 获取金币世界坐标\n     * @returns {cc.Vec2}\n     */\n    public getGoldWorldPos(): cc.Vec2 {\n        return this.imgGold.node.convertToWorldSpaceAR(cc.v2(0, 0));\n    }\n\n    protected onEvent_M2C_GoldChange_Mes(oldGold: number): void {\n        this.refreshGold();\n    }\n\n    onClick(name: string): void {\n        switch (name) {\n            case \"btnLogin\":\n                Manager.uiManager.open({ type: LoginNewView, bundle: BUNDLE_RESOURCES });\n                break;\n            case \"btnBuyGold\":\n                Manager.uiManager.open({ type: RechargeNewView, bundle: BUNDLE_RESOURCES });\n                break;\n        }\n    }\n\n    // update (dt) {}\n}\n"]}