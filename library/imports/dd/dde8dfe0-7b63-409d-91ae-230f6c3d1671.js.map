{"version":3,"sources":["assets/script/common/manager/MainController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { BUNDLE_RESOURCES } from \"../../framework/base/Defines\";\nimport Controller from \"../../framework/controller/Controller\";\nimport { makeKey } from \"../../framework/decorator/Decorators\";\nimport { reStartGame } from \"../../global/Global\";\nimport Loading from \"../../loading/Loading\";\nimport PanelHelp from \"../../msgbox/PanelHelp\";\nimport { android } from \"../../platform/android\";\nimport { ios } from \"../../platform/ios\";\nimport { web } from \"../../platform/web\";\nimport { Config } from \"../config/Config\";\nimport { CommonService, protoPackage, serverType } from \"../net/CommonService\";\nimport { LobbyService } from \"../net/LobbyService\";\nimport { Manager } from \"./Manager\";\nimport { goToLogin } from \"../../global/Global\";\nimport { i18n } from \"../language/LanguageImpl\";\nimport UserInfo from \"../../userInfo/UserInfo\";\nimport { LogicEvent } from \"../event/LogicEvent\";\nimport { MST } from \"../../framework/external/protoc\";\nimport ConfirmBox from \"../../msgbox/ConfirmBox\";\nimport DisconnectWait from \"../../wait/DisconnectWait\";\nimport { EventDefine } from \"../define/EventDefine\";\nimport { GameConfig } from \"../base/HotUpdate\";\nimport { gameManager } from \"./GameManager\";\nimport AppData from \"../../data/AppData\";\nimport { RequestPackge } from \"../../framework/net/HttpClient\";\nimport UIView from \"../../framework/ui/UIView\";\n\n/**\n * @description 主控制器 \n */\n\nconst { ccclass, property, menu } = cc._decorator;\n\n// 置顶按钮集间隔\nconst TOP_BTNS_INTERVAL: number = 20;\n// 置顶按钮集边缘宽\nconst TOP_BTNS_PADDING_W: number = 20;\n// 置顶按钮集边缘高\nconst TOP_BTNS_PADDING_H: number = 50;\n\n@ccclass\n@menu(\"manager/MainController\")\nexport default class MainController extends Controller<CommonService> {\n\n    /**@description 进入后台的时间 */\n    private _enterBackgroundTime = 0;\n    private _appData: AppData = null;\n    private _diffWorldPos: cc.Vec2 = null;\n    private _startMsgBtnPos: cc.Vec2 = null;\n\n    @property(cc.Node)\n    private nodTopBtn: cc.Node = null;\n\n    @property(cc.Button)\n    private btnMsg: cc.Button = null;\n\n    @property(cc.Layout)\n    private latBtns: cc.Layout = null;\n\n    @property(cc.Button)\n    private btnToTop: cc.Button = null;\n\n    onLoad() {\n        super.onLoad()\n\n        this._appData = G.DataMgr.get(AppData);\n\n        if (cc.sys.isBrowser) {\n            window['platformUtil'] = web;\n        }\n        else if (cc.sys.os === cc.sys.OS_IOS) {\n            window['platformUtil'] = ios;\n        }\n        else if (cc.sys.os === cc.sys.OS_ANDROID) {\n            window['platformUtil'] = android;\n        }\n\n        this._appData.invcode = window[\"platformUtil\"].getQueryString(\"invcode\");\n        G.Logger.color(\"邀请码\", this._appData.invcode);\n\n        //显示 FPS 调试信息\n        if (Config.WS_URL === \"192.168.2.254:10000\" || Config.WS_URL === \"game.sultan777.io:8443\") {\n            cc.debug.setDisplayStats(false);\n        } else {\n            cc.debug.setDisplayStats(true);\n        }\n        // 动态合批\n        // cc.macro.CLEANUP_IMAGE_CACHE = false;\n        // cc.dynamicAtlasManager.enabled = true;\n        // cc.dynamicAtlasManager.maxFrameSize = 512;\n        // cc.dynamicAtlasManager.showDebug(true);\n\n        this.latBtns.node.active = false;\n        this.nodTopBtn.zIndex = 9999;\n\n        Manager.adaptor.onLoad(this.node);\n\n        //本地缓存数据库打开\n        Manager.dataBase.open();\n\n        //先添加全局的网络组件\n        Manager.netManager.addNetControllers(this.node);\n\n        //预先加载预置体\n        Manager.uiManager.preload(Loading, BUNDLE_RESOURCES);\n        Manager.uiManager.preload(ConfirmBox, BUNDLE_RESOURCES);\n        Manager.uiManager.preload(DisconnectWait, BUNDLE_RESOURCES);\n\n        //调试按钮事件注册\n        let showUI = cc.find(\"showUI\", this.node);\n        let showNode = cc.find(\"showNode\", this.node);\n        let showRes = cc.find(\"showRes\", this.node);\n        if (showUI && showNode && showRes) {\n            showUI.zIndex = 9999;\n            showNode.zIndex = 9999;\n            showRes.zIndex = 9999;\n            let isShow = false;\n            if (Config.isShowDebugButton) {\n                isShow = true;\n                showUI.on(cc.Node.EventType.TOUCH_END, () => {\n                    Manager.uiManager.printViews();\n                });\n                showNode.on(cc.Node.EventType.TOUCH_END, () => {\n                    Manager.uiManager.printCanvasChildren();\n                });\n                showRes.on(cc.Node.EventType.TOUCH_END, () => {\n\n                    // if (Manager.language.getLanguage() == cc.sys.LANGUAGE_ENGLISH) {\n                    //     Manager.language.change(cc.sys.LANGUAGE_CHINESE);\n                    // } else {\n                    //     Manager.language.change(cc.sys.LANGUAGE_ENGLISH);\n                    // }\n                    // reStartGame();\n\n\n                });\n            }\n            showUI.active = isShow;\n            showNode.active = isShow;\n            showRes.active = isShow;\n        }\n\n        let loadingNode = cc.find(\"updateNode\", this.node);\n        loadingNode.active = true;\n        // setTimeout(() => {\n        //     dispatch(LogicEvent.ENTER_HALL)\n        // }, 1000);\n\n        //游戏事件注册\n        cc.game.on(cc.game.EVENT_HIDE, this.onEnterBackground, this);\n        cc.game.on(cc.game.EVENT_SHOW, this.onEnterForgeground, this);\n\n        cc.director.on(cc.Director.EVENT_AFTER_DRAW, this._onDirectorAfterDraw, this);\n\n        //逻辑管理器\n        Manager.logicManager.onLoad(this.node);\n\n\n        if (cc.sys.isNative) cc.game.setFrameRate(60);\n\n        this.onRefreshVersion()\n        //web 窗口尺寸改变\n        cc.view.setResizeCallback(function () {\n            dispatch(\"reWinSize\")\n        });\n\n    }\n\n    protected bindingEvents() {\n        super.bindingEvents()\n\n        this.registerEvent(\"RefreshVersion\", this.onRefreshVersion);\n        // this.registerEvent(\"OpenUserHeadInfo\", this.showUserInfo);\n        this.registerEvent(EventDefine.NOT_LOGIN_CLICK_BUTTON, this.onNotLoginClickButton);\n\n        this.btnMsg.node.on(cc.Node.EventType.TOUCH_START, this.onTopTouchStart, this);\n        this.btnMsg.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTopTouchMove, this);\n        this.btnMsg.node.on(cc.Node.EventType.TOUCH_END, this.onTopTouchEnd, this);\n        this.btnMsg.node.on(cc.Node.EventType.TOUCH_CANCEL, this.onTopTouchCancel, this);\n\n        //监听返回按钮\n        this.registerEvent(\"handleKeyBackClicked\", () => {\n            PanelHelp.showDialog('', i18n.TIPS.QUITGAME, () => {\n                cc.game.end()\n            });\n        })\n    }\n\n    private onRefreshVersion() {\n        //APP 版本\n        let versionNode = cc.find(\"version\", this.node);\n        if (versionNode) {\n            let version = window['platformUtil'].getVersionName();\n            let resversion = window['platformUtil'].getResVersionName();\n            if (version) {\n                versionNode.getComponent(cc.Label).string = \"App:\" + version + \" Res:\" + resversion\n            }\n        }\n    }\n\n    private onNotifyOtherLogin(data) {\n        cc.log(data, \"onNotifyOtherLogin\")\n        PanelHelp.showMsgBox('', i18n.ERRORCODE[data.errorCode], () => {\n            goToLogin()\n        }, null, false);\n    }\n\n    /**@description 游戏完成一次渲染过程之后 */\n    private _onDirectorAfterDraw() {\n        Manager.uiManager.onDirectorAfterDraw();\n    }\n\n    update() {\n\n        //大厅网络连接调度\n        LobbyService.instance.handMessage();\n\n        //远程资源下载任务调度\n        Manager.assetManager.remote.update();\n    }\n\n    onDestroy() {\n        super.onDestroy()\n        G.Logger.log('移除网络组件');\n\n        Manager.adaptor.onDestroy();\n\n        //移除网络组件 \n        Manager.netManager.removeNetControllers(this.node);\n        //移除键盘事件\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP);\n\n        //移除游戏事件注册\n        cc.game.off(cc.game.EVENT_HIDE);\n        cc.game.off(cc.game.EVENT_SHOW);\n\n        //逻辑管理器\n        Manager.logicManager.onDestroy(this.node);\n\n\n    }\n    private showUserInfo(data) {\n        Manager.uiManager.open({ type: UserInfo, bundle: BUNDLE_RESOURCES, args: [data] });\n    }\n\n    private onNotLoginClickButton(): void {\n        PanelHelp.showTip(i18n.Tips.SilakanMasuk);\n    }\n\n\n    private onTopTouchStart(e: cc.Event.EventTouch): void {\n        let clickLocalPos: cc.Vec2 = this.node.convertToNodeSpaceAR(e.getLocation());\n        let btnWorldPos: cc.Vec2 = this.btnMsg.node.convertToWorldSpaceAR(cc.v2(0, 0));\n        let btnLocalPos: cc.Vec2 = this.node.convertToNodeSpaceAR(btnWorldPos);\n        this._diffWorldPos = btnLocalPos.sub(clickLocalPos);\n        this._startMsgBtnPos = e.getLocation();\n    }\n\n    private onTopTouchMove(e: cc.Event.EventTouch): void {\n        let clickLocalPos: cc.Vec2 = this.node.convertToNodeSpaceAR(e.getLocation());\n        this.btnMsg.node.setPosition(clickLocalPos.add(this._diffWorldPos));\n\n        this.refreshLatBtns();\n    }\n\n    private onTopTouchEnd(e: cc.Event.EventTouch): void {\n        this.topTouchEnd(e);\n    }\n\n    private onTopTouchCancel(e: cc.Event.EventTouch): void {\n        this.topTouchEnd(e);\n    }\n\n    private topTouchEnd(e: cc.Event.EventTouch): void {\n        let btnWorldPos: cc.Vec2 = this.btnMsg.node.convertToWorldSpaceAR(cc.v2(0, 0));\n\n        // 左右\n        if (btnWorldPos.x - this.btnMsg.node.width / 2 < 0 + TOP_BTNS_PADDING_W) {\n            this.btnMsg.node.x = 0 + (this.btnMsg.node.width / 2) - (cc.winSize.width / 2) + TOP_BTNS_PADDING_W;\n        } else if (btnWorldPos.x + this.btnMsg.node.width / 2 > cc.winSize.width - TOP_BTNS_PADDING_W) {\n            this.btnMsg.node.x = cc.winSize.width - (this.btnMsg.node.width / 2) - (cc.winSize.width / 2) - TOP_BTNS_PADDING_W;\n        }\n\n        // 上下\n        if (btnWorldPos.y - this.btnMsg.node.height / 2 < 0 + TOP_BTNS_PADDING_H) {\n            this.btnMsg.node.y = 0 + (this.btnMsg.node.height / 2) - (cc.winSize.height / 2) + TOP_BTNS_PADDING_H;\n        } else if (btnWorldPos.y + this.btnMsg.node.height / 2 > cc.winSize.height - TOP_BTNS_PADDING_H) {\n            this.btnMsg.node.y = cc.winSize.height - (this.btnMsg.node.height / 2) - (cc.winSize.height / 2) - TOP_BTNS_PADDING_H;\n        }\n\n        let moveDiffPos: cc.Vec2 = e.getLocation().sub(this._startMsgBtnPos);\n        if (Math.abs(moveDiffPos.x) < 10\n            && Math.abs(moveDiffPos.y) < 10) {\n            this.onClickMsg();\n        }\n    }\n\n    private onEnterBackground() {\n        this._enterBackgroundTime = Date.timeNow();\n        cc.log(`[MainController]`, `onEnterBackground ${this._enterBackgroundTime}`);\n        Manager.globalAudio.onEnterBackground();\n        LobbyService.instance.onEnterBackground();\n    }\n\n    private onEnterForgeground() {\n        if (this._enterBackgroundTime == 0) {\n            return\n        }\n        let now = Date.timeNow();\n        let inBackgroundTime = now - this._enterBackgroundTime;\n        cc.log(`[MainController]`, `onEnterForgeground ${now} background total time : ${inBackgroundTime}`);\n        Manager.globalAudio.onEnterForgeground(inBackgroundTime);\n        LobbyService.instance.onEnterForgeground(inBackgroundTime);\n        this._enterBackgroundTime = 0\n        if (inBackgroundTime > 60) {\n            reStartGame();\n        }\n    }\n\n    /**\n     * 点击置顶按钮\n     */\n    onClickToTop(): void {\n        let currView: UIView = Manager.uiManager.getLastView();\n        if (currView) {\n            currView.onScrollTop();\n        }\n    }\n\n    /**\n     * 点击 Telegram 聊天室\n     */\n    onClickTelegram(): void {\n        cc.sys.openURL(Config.TelegramURL);\n        this.latBtns.node.active = false;\n    }\n\n    /**\n     * 点击客服\n     */\n    onClickService(): void {\n        this.latBtns.node.active = false;\n    }\n\n    private refreshLatBtns(): void {\n        if (!this.latBtns.node.active) {\n            return;\n        }\n        let btnWorldPos: cc.Vec2 = this.btnMsg.node.convertToWorldSpaceAR(cc.v2(0, 0));\n\n        let latTopBtnPos: cc.Vec2 = cc.v2(0, 0);\n        if (btnWorldPos.x > cc.winSize.width / 2) {\n            latTopBtnPos.x = 0 - ((this.btnMsg.node.width / 2) + (this.latBtns.node.width / 2) + TOP_BTNS_INTERVAL);\n        } else {\n            latTopBtnPos.x = 0 + ((this.btnMsg.node.width / 2) + (this.latBtns.node.width / 2) + TOP_BTNS_INTERVAL);\n        }\n\n        this.latBtns.node.position = latTopBtnPos;\n    }\n\n    /**\n     * 点击消息集合\n     */\n    onClickMsg(): void {\n        this.latBtns.node.active = !this.latBtns.node.active;\n        this.refreshLatBtns();\n    }\n\n}\n"]}