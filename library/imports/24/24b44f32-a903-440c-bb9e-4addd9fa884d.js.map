{"version":3,"sources":["assets/games/crash/script/view/CrashMyRecordView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ListView from \"../../../../script/common/component/ListView\";\nimport NoneItem from \"../../../../script/common/item/NoneItem\";\nimport TitleItemPage from \"../../../../script/common/item/TitleItemPage\";\nimport { Manager } from \"../../../../script/common/manager/Manager\";\nimport { LobbyService } from \"../../../../script/common/net/LobbyService\";\nimport TypeUtils from \"../../../../script/common/utils/TypeUtils\";\nimport AppData from \"../../../../script/data/AppData\";\nimport { ENABLE_CHANGE_LANGUAGE } from \"../../../../script/framework/base/Defines\";\nimport { IController } from \"../../../../script/framework/controller/Controller\";\nimport { injectService } from \"../../../../script/framework/decorator/Decorators\";\nimport { EventApi } from \"../../../../script/framework/event/EventApi\";\nimport DateUtils from \"../../../../script/framework/extentions/DateUtils\";\nimport { MST } from \"../../../../script/framework/external/protoc\";\nimport UIView from \"../../../../script/framework/ui/UIView\";\nimport PanelHelp from \"../../../../script/msgbox/PanelHelp\";\n\n// 每页数量\nconst PAGE_COUNT: number = 20;\n// 一天毫秒\nconst ONE_DAY_MS: number = 86400000;\n// 默认首次请求分页 ID\nconst DEFAULT_FIRST_ID: number = -1;\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\n@injectService(LobbyService.instance)\nexport default class CrashMyRecordView extends UIView implements IController<LobbyService> {\n    service: LobbyService;\n\n    @property(cc.Label)\n    private labGameNoTitle: cc.Label = null;\n\n    @property(cc.Label)\n    private labDate: cc.Label = null;\n\n    @property(cc.Label)\n    private labBetRate: cc.Label = null;\n\n    @property(cc.Label)\n    private labBetGold: cc.Label = null;\n\n    @property(cc.Label)\n    private labIncome: cc.Label = null;\n\n    @property(ListView)\n    private lsvRecord: ListView = null;\n\n    @property(TitleItemPage)\n    private titleItemPage: TitleItemPage = null;\n\n    @property(NoneItem)\n    private noneItem: NoneItem = null;\n\n    // App 数据\n    private _appData: AppData = null;\n    // 是否最后一页\n    private _isLastPage: boolean = false;\n    // 个人历史下注数据列表\n    private _dataList: MST.IMyRecordInfo[] = null;\n\n    public static getPrefabUrl() {\n        return \"prefabs/CrashMyRecordView\";\n    }\n\n    onLoad() {\n        super.onLoad();\n\n        this.initData();\n        this.initView();\n\n        this.C2S_CrashMyRecord();\n    }\n\n    start() {\n\n    }\n\n    public show(args?: any[]): void {\n        super.show(args);\n\n        this.onLanguageChange();\n    }\n\n    private initData(): void {\n        this._appData = G.DataMgr.get(AppData);\n        this._isLastPage = false;\n        this._dataList = [];\n    }\n\n    private initView(): void {\n        this.labGameNoTitle.string = \"\";\n        this.labDate.string = \"\";\n        this.labBetRate.string = \"\";\n        this.labBetGold.string = \"\";\n        this.labIncome.string = \"\";\n\n        this.noneItem.node.active = false;\n    }\n\n    bindingEvents() {\n        super.bindingEvents();\n\n        if (ENABLE_CHANGE_LANGUAGE) {\n            this.registerEvent(EventApi.CHANGE_LANGUAGE, this.onLanguageChange);\n        }\n\n        this.registerEvent(\"Event_S2C_CrashMyRecord\", this.onEvent_S2C_CrashMyRecord);\n\n    }\n\n    onLanguageChange() {\n        this.titleItemPage.languagePageName(Manager.makeLanguage(\"labMyRecordPageName\", true));\n\n        this.labGameNoTitle.language = Manager.makeLanguage(\"labGameNoTitle\", true);\n        this.labDate.language = Manager.makeLanguage(\"labDate\", true);\n        this.labBetRate.language = Manager.makeLanguage(\"labBetRate\", true);\n        this.labBetGold.language = Manager.makeLanguage(\"labBetGold\", true);\n        this.labIncome.language = Manager.makeLanguage(\"labIncome\", true);\n\n    }\n\n    private getLastRecordId(): number {\n        let id: number = DEFAULT_FIRST_ID;\n        if (this._dataList.length > 0) {\n            let lastRecordData: MST.IMyRecordInfo = this._dataList[this._dataList.length - 1];\n            id = lastRecordData.id;\n        }\n        return id;\n    }\n\n    /**\n     * 查询历史记录\n     * @param id {number} id 为了避免查询后，出现重复数据 首次请求默认为 -1 （查询后的数据不包含自身 ID）\n     */\n    private C2S_CrashMyRecord(id?: number): void {\n        if (TypeUtils.isNull(id)) {\n            id = DEFAULT_FIRST_ID;\n        }\n\n        let data: MST.IC2S_CrashMyRecord = {\n            serial: Manager.netManager.getNewSeqId(),\n            id: id,\n            count: PAGE_COUNT,\n        }\n        let req = MST.C2S_CrashMyRecord.create(data);\n        let buffer = MST.C2S_CrashMyRecord.encode(req).finish();\n        this.service.sendMsg(MST.C2S_CrashMyRecord, MST.OuterOpcode_CrashGame.C2S_CrashMyRecord, buffer);\n    }\n\n    private onEvent_S2C_CrashMyRecord(data: MST.IS2C_CrashMyRecord): void {\n        if (data.code !== 0) {\n            PanelHelp.showErrTip(data.code);\n            return;\n        }\n\n        if (data.id === DEFAULT_FIRST_ID && data.myRecordInfo.length <= 0) {\n            this.noneItem.node.active = true;\n            this.lsvRecord.node.active = false;\n        } else {\n            this.noneItem.node.active = false;\n            this.lsvRecord.node.active = true;\n        }\n\n        // 是否最后一页\n        this._isLastPage = data.myRecordInfo.length < PAGE_COUNT;\n\n        if (data.id === DEFAULT_FIRST_ID) {\n            this._dataList = [].concat(data.myRecordInfo);\n            this.lsvRecord.set(data.myRecordInfo);\n        } else {\n            this._dataList = this._dataList.concat(data.myRecordInfo);\n            this.lsvRecord.insert(data.myRecordInfo);\n        }\n\n    }\n\n    public onClick(ButtonName: any, ButtonNode: any, data?: string): void {\n        switch (ButtonName) {\n            case \"btnClose\":\n                this.close();\n                break;\n        }\n    }\n\n    /**\n     * 上拉回调\n     * @param target \n     */\n    private onPullTop(target: ListView): void {\n        this.C2S_CrashMyRecord();\n    }\n\n    /**\n     * 下拉回调\n     */\n    private onPullBottom(target: ListView): void {\n        if (this._isLastPage) {\n            G.Logger.log(\"Crash 浏览个人历史记录 已是最后一页 无需请求翻页\");\n            return;\n        }\n        this.C2S_CrashMyRecord(this.getLastRecordId());\n    }\n\n}\n"]}