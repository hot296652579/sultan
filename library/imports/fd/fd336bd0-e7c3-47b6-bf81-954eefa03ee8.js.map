{"version":3,"sources":["assets/script/redPakge/RedPakgeShareView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\nimport { i18n } from \"../common/language/LanguageImpl\";\nimport { Manager } from \"../common/manager/Manager\";\nimport UIView from \"../framework/ui/UIView\";\nimport { User } from \"../global/User\";\nimport { UtilMgr } from \"../global/UtilMgr\";\nimport PanelHelp from \"../msgbox/PanelHelp\";\nimport { shareType } from \"../platform/android\";\nimport RedPakgeView from \"./RedPakgeView\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class RedPakgeShareView extends UIView {\n\n    @property(cc.Node)\n    share: cc.Node = null\n    @property(cc.Sprite)\n    head: cc.Sprite = null\n    @property(cc.Graphics)\n    icon: cc.Graphics = null\n\n    @property(cc.Label)\n    shareLabel: cc.Label = null\n\n    @property(cc.Label)\n    faceBookLabel: cc.Label = null\n\n    @property(cc.Label)\n    saveImageLabel: cc.Label = null\n\n\n    @property(cc.Label)\n    copyLineLabel: cc.Label = null\n\n    shareUrl: string = null;\n    private _isSaveIamge: boolean = false;\n\n    public static getPrefabUrl() {\n        return \"redPakge/prefabs/RedPakgeShareView\";\n    }\n\n    onLoad() {\n        super.onLoad();\n        this.content = this.node.getChildByName('content');\n\n    }\n\n    bindingEvents() {\n        super.bindingEvents();\n        this.registerEvent(\"handleSaveImageToLocal\", (isSuccess) => {\n            if (isSuccess) {\n                this.unscheduleAllCallbacks()\n                PanelHelp.showTip(i18n.REDPAKGE.saveSuccess)\n                this._isSaveIamge = false;\n            }\n\n        });\n\n    }\n    show(args) {\n        super.show(args);\n        this.showWithAction(true);\n        if (args[0]) {\n            this.shareUrl = args[0]\n        }\n    }\n    start() {\n        this.initIU()\n        Manager.uiManager.getView(RedPakgeView).then((view) => {\n            if (view) {\n                view.node.active = false\n            }\n        });\n    }\n    private initIU() {\n        if (this.shareUrl) {\n            UtilMgr.loadHeadImg(this.head, User._headImgUrl, User._userID, this)\n            let qrcode = this.shareUrl.split(\"&url=\")[1]\n            this.createQRcode(decodeURIComponent(qrcode));\n            this.shareLabel.language = Manager.makeLanguage(\"REDPAKGE.shareTo\");\n            this.faceBookLabel.language = Manager.makeLanguage(\"REDPAKGE.faceBook\");\n            this.saveImageLabel.language = Manager.makeLanguage(\"REDPAKGE.saveImage\");\n            this.copyLineLabel.language = Manager.makeLanguage(\"REDPAKGE.copyLink\");\n        }\n\n    }\n    createQRcode(url: string) {\n        var qrcode = new window[\"QRCode\"](-1, 3);\n        qrcode.addData(url);\n        qrcode.make();\n\n        this.icon.fillColor = cc.Color.BLACK;\n        //块宽高\n        var tileW = this.icon.node.width / qrcode.getModuleCount();\n        var tileH = this.icon.node.height / qrcode.getModuleCount();\n\n        // draw in the Graphics\n        for (var row = 0; row < qrcode.getModuleCount(); row++) {\n            for (var col = 0; col < qrcode.getModuleCount(); col++) {\n                if (qrcode.isDark(row, col)) {\n                    // ctx.fillColor = cc.Color.BLACK;\n                    var w = (Math.ceil((col + 1) * tileW) - Math.floor(col * tileW));\n                    var h = (Math.ceil((row + 1) * tileW) - Math.floor(row * tileW));\n                    this.icon.rect(Math.round(col * tileW), Math.round(row * tileH), w, h);\n                    this.icon.fill();\n                }\n            }\n        }\n    }\n    onClick(name, node) {\n        switch (name) {\n            case \"close\":\n                this.closeWithAction();\n                Manager.uiManager.getView(RedPakgeView).then((view) => {\n                    if (view) {\n                        view.node.active = true\n                    }\n                });\n                break;\n            case \"facebook\": this.shareToFacebook(); break;\n            case \"instagram\": this.shareToInstagram(); break;\n            case \"whatApp\": this.shareToWhatsApp(); break;\n            case \"more\": this.onMove(); break;\n            case \"copy\": this.onCopyInvateURL(); break;\n            case \"save\": this.onSaveImage(); break;\n            default: G.Logger.error(\"no find button name -> %s\", name);\n        }\n    }\n\n    private shareToFacebook() {\n        window['platformUtil'].shareToFacebook(shareType.PHOTO, this.shareUrl, this.shareUrl);\n    }\n    private shareToInstagram() {\n        G.ShareHelpder.instagram.shareImage(this.shareUrl);\n    }\n    private shareToWhatsApp() {\n        G.ShareHelpder.whatsapp.shareImage(this.shareUrl);\n    }\n    private onMove() {\n        // G.ShareHelpder.instagram.downRemoteImage(this.shareUrl, (imagePath) => {\n        //     if (cc.sys.os === cc.sys.OS_ANDROID) {\n        //         window['platformUtil'].shareImageToLocal(imagePath);\n        //     }\n        // })\n    }\n\n    private onSaveImage() {\n        if (this._isSaveIamge) {\n            return\n        }\n        this._isSaveIamge = true;\n        UtilMgr.captureTexture(this.share)\n        this.scheduleOnce(() => {\n            this._isSaveIamge = false;\n        }, 5)\n    }\n\n    /**\n     * 复制邀请链接\n     */\n    private onCopyInvateURL(): void {\n        let copy = this.shareUrl.split(\"&url=\")[1]\n        window['platformUtil'].copyToClip(decodeURIComponent(copy));\n    }\n\n    onDestroy() {\n        super.onDestroy();\n        this.unscheduleAllCallbacks()\n    }\n}\n"]}