{"version":3,"sources":["assets/script/WelfareCenter/WelfareCenterView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\nimport { i18n } from \"../common/language/LanguageImpl\";\nimport { Manager } from \"../common/manager/Manager\";\nimport { protoPackage, serverType } from \"../common/net/CommonService\";\nimport { LobbyService } from \"../common/net/LobbyService\";\nimport { IController } from \"../framework/controller/Controller\";\nimport { injectService, makeKey } from \"../framework/decorator/Decorators\";\nimport UIView from \"../framework/ui/UIView\";\n\nimport PanelHelp from \"../msgbox/PanelHelp\";\n\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\n@injectService(LobbyService.instance)\nexport default class WelfareCenterView extends UIView implements IController<LobbyService>{\n    service: LobbyService;\n\n    @property(cc.ScrollView)\n    scrollView: cc.ScrollView = null\n\n    @property(cc.Node)\n    item: cc.Node = null\n\n    @property(cc.Sprite)\n    itemSprite: cc.Sprite = null\n\n    @property(cc.Node)\n    noTip: cc.Node = null\n\n    @property(cc.Node)\n    loadNode: cc.Node = null\n\n    welfareCentersData: any = null;\n    selectData: any = null;\n\n   \n\n   \n    public static getPrefabUrl() {\n        return \"WelfareCenter/prefabs/WelfareCenterView\";\n    }\n\n    onLoad() {\n        super.onLoad();\n        this.content = this.node.getChildByName('content');\n        this.noTip.getComponent(cc.Label).language = i18n.WelfareCenter.noTip;\n    }\n    bindingEvents() {\n        super.bindingEvents();\n        this.registerEvent(makeKey(serverType.Lobby, protoPackage.hall.HallCmd.CMD_WelfareCenter), this.refreshWelfareCenter);\n        \n    }\n    refreshWelfareCenter(data) {\n        G.Logger.log(data, \"WelfareCenter\")\n        if (data) {\n            if (data.statusMsg.status == 0) {\n                if (data.welfareCenters && data.welfareCenters.length) {\n                    this.welfareCentersData = data.welfareCenters;\n                    this.noTip.active = false;\n                    this.loadWelfareCentersView(data.welfareCenters)\n                 }\n            } else {\n                PanelHelp.showMsgBox('', Manager.makeLanguage(\"ERRORCODE.\" + data.statusMsg.status));\n            }\n        }\n    }\n    private loadWelfareCentersView(data){\n        let language = Manager.language.getLanguage();\n        for (let index = 0; index < data.length; index++) {\n            const element = data[index];\n            let welfareCenterData = element.welfareCenter.find(config => { return config.index == 1 });;\n            if (language == cc.sys.LANGUAGE_ENGLISH) {\n                welfareCenterData  =  element.welfareCenter.find(config => { return config.index == 1 });\n            }else if (language == cc.sys.LANGUAGE_HINDI) {\n                welfareCenterData  =  element.welfareCenter.find(config => { return config.index == 2 });\n            }\n            if (welfareCenterData) {\n                let sp = cc.instantiate(this.item);\n                sp.active = true;\n                sp.x = 0;\n                sp.name = welfareCenterData.name;\n                sp.getChildByName(\"Label\").getComponent(cc.Label).string = welfareCenterData.name\n                sp.parent = this.scrollView.content;\n                if (!this.selectData &&  welfareCenterData.imgUrl) {\n                    this.loadNode.parent.active = true;\n                    this.itemSprite.loadRemoteImage({url:welfareCenterData.imgUrl,view:this,completeCallback:(data)=>{\n                        console.log(data);\n                        if (data) {\n                            this.loadNode.parent.active = false;\n                        }\n                    }})\n                    this.selectData = welfareCenterData;\n                }\n            }\n        }\n\n    }\n    onClick(name, node) {\n        switch (name) {\n            case \"close\": this.closeWithAction(); break;\n            case \"itemSprite\": this.openSpriteURL(); break;\n            default: {\n                let language = Manager.language.getLanguage();\n                let lg = 1\n                if (language == cc.sys.LANGUAGE_ENGLISH) {\n                    lg = 1\n                }else if (language == cc.sys.LANGUAGE_HINDI) {\n                    lg = 2\n                }\n                for (let index = 0; index < this.welfareCentersData.length; index++) {\n                    const element = this.welfareCentersData[index];\n                    let welfareCenterData  = element.welfareCenter.find(config => { return config.name == name && config.index == lg});\n                    if (welfareCenterData) {\n                        this.selectData = welfareCenterData;\n                        this.loadNode.parent.active = true;\n                        this.itemSprite.loadRemoteImage({url:welfareCenterData.imgUrl,view:this,completeCallback:(data)=>{\n                            if (data) {\n                                this.loadNode.parent.active = false;\n                            }\n                        }})\n                    }\n                }\n            };\n        }\n    }\n    private openSpriteURL(){\n        if (this.selectData) {\n            if (this.selectData.jumpType == 0) {\n                if (this.selectData.jumpValue && this.selectData.jumpValue != \"empty\") {\n                    let HallView = Manager.uiManager.getView(\"HallView\");\n                    if (HallView) {\n                        let jumpValue = this.selectData.jumpValue\n                        this.closeWithAction()\n                        HallView.then((view) => {\n                            if (view) {\n                                view.onClickByWelfareCenter(jumpValue)\n                            }\n                        })\n                    }\n                }\n\n            }else if(this.selectData.jumpType == 1){\n                if (this.selectData.imgUrl) {\n                    window['platformUtil'].openURL(this.selectData.jumpValue)\n                }\n            }\n            \n        }\n    }\n    start() {\n        this.reqWelfareCenterList()\n        cc.tween(this.loadNode)\n        .repeatForever(cc.tween().by(0.2,{angle : 30})\n        .delay(0.01))\n        .start()\n    }\n\n    private reqWelfareCenterList(){\n        this.service.sendMsg(serverType.Lobby,\n            protoPackage.hall.HallCmd.CMD_WelfareCenter,\n            null);\n    }\n    show(args){\n        super.show(args);\n        this.showWithAction(true);\n    }\n    // update (dt) {}\n}\n"]}