{"version":3,"sources":["assets/script/recharge/RechargeView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Config } from \"../common/config/Config\";\nimport { i18n } from \"../common/language/LanguageImpl\";\nimport { Manager } from \"../common/manager/Manager\";\nimport { protoPackage, serverType } from \"../common/net/CommonService\";\nimport { LobbyService } from \"../common/net/LobbyService\";\nimport { IController } from \"../framework/controller/Controller\";\nimport { injectService, makeKey } from \"../framework/decorator/Decorators\";\nimport UIView from \"../framework/ui/UIView\";\nimport PanelHelp from \"../msgbox/PanelHelp\";\nimport GoodsItem from \"./GoodsItem\";\nimport { BUNDLE_RESOURCES } from \"../framework/base/Defines\";\nimport { com } from \"../framework/external/protoc\";\nimport RechargeOrderView from \"./RechargeOrderView\";\nimport { User } from \"../global/User\";\nimport { UtilMgr } from \"../global/UtilMgr\";\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\n@injectService(LobbyService.instance)\nexport default class RechargeView extends UIView implements IController<LobbyService>{\n\n    @property(cc.ScrollView)\n    scrollView: cc.ScrollView = null\n\n    @property(cc.Prefab)\n    goodsItem: cc.Prefab = null\n\n    @property(cc.Node)\n    rechargePanel: cc.Node = null\n\n\n    @property(cc.Node)\n    recordPanel: cc.Node = null\n\n\n\n    _nodePool: cc.NodePool = null\n\n    _insItemCount: number = 8\n\n    _goodsList: any = []\n\n    private selectIndex: number = null;\n\n    service: LobbyService;\n\n    public static getPrefabUrl() {\n        return \"recharge/prefabs/RechargeView\";\n    }\n\n    onLoad() {\n\n        super.onLoad();\n        this.content = this.node.getChildByName('content');\n\n        this._nodePool = new cc.NodePool()\n        for (let i = 0; i < this._insItemCount; i++) {\n            let goodsItem = cc.instantiate(this.goodsItem)\n            this._nodePool.put(goodsItem)\n        }\n    }\n\n    bindingEvents() {\n        super.bindingEvents();\n        this.registerEvent(makeKey(serverType.Lobby, protoPackage.hall.HallCmd.FETCH_PROUCTS), this.refreshList);\n        this.registerEvent(makeKey(serverType.Lobby, protoPackage.hall.HallCmd.CMD_PAY_CHANNEL_LIST), this.onPayChannelListRes);\n\n\n    }\n\n    refreshList(data) {\n        cc.log(data, \"Recharge\")\n        if (data) {\n            if (data.statusMsg.status == 0) {\n                this.rechargeView(data)\n            } else {\n                PanelHelp.showMsgBox('', Manager.makeLanguage(\"ERRORCODE.\" + data.statusMsg.status));\n            }\n        }\n    }\n\n    rechargeView(data) {\n        let goodsList = data.product\n        if (goodsList.length > 0) {\n            this._goodsList = goodsList\n            this.scrollView.enabled = goodsList.length > this._insItemCount\n            for (let i = 0; i < goodsList.length; i++) {\n                let goodsItem = this.getGoodsItem()\n                goodsItem.parent = this.scrollView.content\n                goodsItem.getComponent(GoodsItem).init(this, goodsList[i], i)\n            }\n        } else {\n            PanelHelp.showTip(i18n.RECHARGE.NOGOODS)\n        }\n    }\n\n    getGoodsItem() {\n        let goodsItem = null\n        if (this._nodePool.size() > 0) {\n            goodsItem = this._nodePool.get()\n        } else {\n            goodsItem = cc.instantiate(this.goodsItem)\n        }\n        return goodsItem\n    }\n\n    show(args) {\n        super.show(args);\n        this.showWithAction(true);\n        this.changgePanel(false)\n    }\n\n\n    onClick(name, node) {\n        switch (name) {\n            case 'recharge': ;\n            case 'rechargeRecord':\n                this.changgePanel(name == 'rechargeRecord')\n                break;\n            case \"close\": this.closeWithAction(); break;\n            default: G.Logger.error(\"no find button name -> %s\", name);\n        }\n    }\n    changgePanel(isRecord) {\n        this.recordPanel.active = isRecord;\n        this.rechargePanel.active = !this.recordPanel.active\n    }\n\n    onClickGoodsItem(itemId) {\n        if (User._phone.length > 0) {\n            this.selectIndex = itemId;\n            let productNo = this._goodsList[itemId].productNo\n            // this.reqRecharge(productNo)\n            this.reqChannel();\n            this.audioHelper.playEffect(\"common/audio/click\", BUNDLE_RESOURCES);\n        } else {\n            PanelHelp.showMsgBoxIcon(\"\", i18n.WITHDRAWAL.NOBINDPHONETIP, () => {\n            }, i18n.WITHDRAWAL.GOTOBINDPHONE)\n        }\n\n    }\n\n    private reqChannel(): void {\n        this.service.sendMsg(serverType.Lobby,\n            protoPackage.hall.HallCmd.CMD_PAY_CHANNEL_LIST,\n            null);\n    }\n\n    reqRecharge(productNo) {\n        let req = protoPackage.hall.FetchHwPayRequestId.create({ productNo: productNo });\n        let buffer = protoPackage.hall.FetchHwPayRequestId.encode(req).finish();\n        this.service.sendMsg(serverType.Lobby,\n            protoPackage.hall.HallCmd.FETCH_HW_PAY_ORDERID,\n            buffer);\n    }\n\n    refreshRecharge() {\n        let req = protoPackage.hall.FetchProducts.create({});\n        let buffer = protoPackage.hall.FetchProducts.encode(req).finish();\n        this.service.sendMsg(serverType.Lobby,\n            protoPackage.hall.HallCmd.FETCH_PROUCTS,\n            buffer);\n    }\n\n    start() {\n        this.refreshRecharge()\n    }\n\n    private onPayChannelListRes(data: com.bt.game.proto.hall.IPayChannelListRes): void {\n        if (data.statusMsg.status !== 0) {\n            PanelHelp.showMsgBox('', Manager.makeLanguage(\"ERRORCODE.\" + data.statusMsg.status));\n            return;\n        }\n\n        Manager.uiManager.open({ type: RechargeOrderView, bundle: BUNDLE_RESOURCES, args: [data.payChannelList, this._goodsList[this.selectIndex], this.selectIndex] });\n    }\n    onDestroy() {\n        super.onDestroy();\n        UtilMgr.popWindows();\n    }\n    // update (dt) {}\n}\n"]}