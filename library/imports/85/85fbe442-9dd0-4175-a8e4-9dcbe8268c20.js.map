{"version":3,"sources":["assets/script/rank/RecordView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\nimport ScroViewCtrl from \"../common/component/ScroViewCtrl\";\nimport { Manager } from \"../common/manager/Manager\";\nimport { protoPackage, serverType } from \"../common/net/CommonService\";\nimport { LobbyService } from \"../common/net/LobbyService\";\nimport { IController } from \"../framework/controller/Controller\";\nimport { injectService, makeKey } from \"../framework/decorator/Decorators\";\nimport UIView from \"../framework/ui/UIView\";\nimport { User } from \"../global/User\";\nimport { UtilMgr } from \"../global/UtilMgr\";\nimport PanelHelp from \"../msgbox/PanelHelp\";\n\nconst { ccclass, property } = cc._decorator;\n\nexport enum rankType {\n    Friends = 1,  //好友\n    Wealth = 2,   //财富\n    DayEarn = 3,  //日赚\n}\n\n@ccclass\n@injectService(LobbyService.instance)\nexport default class RecordView extends UIView implements IController<LobbyService>{\n\n    @property(cc.ScrollView)\n    scrollView: cc.ScrollView = null;\n\n    @property(cc.Node)\n    noRecords: cc.Node = null;\n\n    @property(cc.Node)\n    boxNode: cc.Node = null;\n\n    @property(cc.Label)\n    boxTime: cc.Label = null;\n\n    @property(cc.Node)\n    draw: cc.Node = null;\n\n    _rankingList: any = []\n\n    service: LobbyService;\n\n\n    _receiveStatus: number;//是否领取\n\n    _isWin: number;//是否中奖\n\n    _contDown: number;\n\n    timeInterval = null;\n\n\n    public static getPrefabUrl() {\n        return \"rank/prefabs/RecordView\";\n    }\n\n    onLoad() {\n        super.onLoad();\n        this.content = this.node.getChildByName('content');\n    }\n\n    bindingEvents() {\n        super.bindingEvents();\n        this.registerEvent(makeKey(serverType.Lobby, protoPackage.hall.HallCmd.CMD_NewRankingRecord), this.updateList);\n        this.registerEvent(makeKey(serverType.Lobby, protoPackage.hall.HallCmd.CMD_NewRankingReceive), this.newRankingReceiveRes);\n\n    }\n\n    updateList(data) {\n        cc.log(data, \"newRankingRecord\")\n        if (data) {\n            if (data.statusMsg.status == 0) {\n                if (data.newRankingRecordP.length > 0) {\n                    this._rankingList = data.newRankingRecordP\n                    this.rankView();\n                }\n                this._receiveStatus = data.receiveStatus;\n                this._isWin = data.isWin;\n                this._contDown = data.contDown;\n                this.showBox();\n                this.noRecords.active = !this._rankingList.length;\n            } else {\n                PanelHelp.showMsgBox('', Manager.makeLanguage(\"ERRORCODE.\" + data.statusMsg.status));\n            }\n        }\n    }\n\n    async rankView() {\n        let scroViewCtrlCom = this.getComponent(ScroViewCtrl)\n        scroViewCtrlCom.dataList = this._rankingList\n        await scroViewCtrlCom.framingLoad(this._rankingList.length)\n        PanelHelp.hideLoading()\n    }\n\n    show(args) {\n        super.show(args);\n        this.showWithAction(true);\n    }\n\n\n\n    onClick(name, node) {\n        switch (name) {\n            case \"close\": this.closeWithAction(); break;\n            case \"boxBtn\": this.reqReceive(); break;\n            default: G.Logger.error(\"no find button name -> %s\", name);\n        }\n    }\n    reqReceive() {\n        this.service.sendMsg(serverType.Lobby,\n            protoPackage.hall.HallCmd.CMD_NewRankingReceive,\n            null);\n    }\n\n\n    refreshRank() {\n        this.service.sendMsg(serverType.Lobby,\n            protoPackage.hall.HallCmd.CMD_NewRankingRecord,\n            null);\n    }\n\n    start() {\n        this.refreshRank()\n    }\n\n    newRankingReceiveRes(data) {\n        if (data.statusMsg.status == 0) {\n            this.boxNode.getComponent(sp.Skeleton).setAnimation(0, \"kaixiang\", false);\n            this.boxNode.getComponent(sp.Skeleton).setCompleteListener(() => {\n                this.boxNode.active = false;\n                this.refreshRank()\n            });\n            dispatch(\"OpenBox\");\n            PanelHelp.showMsgBox(\"\", Manager.makeLanguage([\"RANK.Receive\", UtilMgr.changeMoney(data.reward)]), null, \"btn_OK\");\n        } else {\n            PanelHelp.showMsgBox('', Manager.makeLanguage(\"ERRORCODE.\" + data.statusMsg.status));\n        }\n    }\n\n    showBox() {\n        if (this._isWin == 1 && this._receiveStatus == 0) {\n            this.boxNode.active = true;\n            this.boxNode.getComponent(sp.Skeleton).setAnimation(0, \"daiji\", true);\n        } else {\n            this.boxNode.active = false;\n        }\n        this.draw.active = this._isWin == 1 ? (this._receiveStatus ? true : false) : true;\n\n        this.updateBoxTime(this._contDown);\n        if (this._contDown <= 0) {\n            this.boxTime.node.active = false;\n            this.draw.active = false;\n        }\n\n        this.boxTime.node.active = this.draw.active;\n    }\n\n\n    updateBoxTime(time: number) {\n        this.timeInterval = () => {\n            time -= 1000;\n            this.conversionTime(time);\n            if (time == 0) {\n                this.unschedule(this.timeInterval)\n                this.timeInterval = null;\n                this.refreshRank()\n            }\n        }\n        if (time > 0) {\n            this.schedule(this.timeInterval, 1);\n        } else if (time == 0) {\n            this.unscheduleAllCallbacks();\n            if (this.timeInterval) {\n                this.unschedule(this.timeInterval);\n                this.timeInterval = null;\n            }\n            this.refreshRank()\n        }\n\n    }\n\n\n    conversionTime(data) {\n        let hours = parseInt(data) / (1000 * 60 * 60);\n        let h = parseInt(hours.toString());\n        let minutes = (data % (1000 * 60 * 60)) / (1000 * 60);\n        let m = parseInt(minutes.toString());\n        let seconds = (data % (1000 * 60)) / 1000;\n        let s = parseInt(seconds.toString());\n        let time = (h < 10 ? ('0' + h) : h) + ':' + (m < 10 ? ('0' + m) : m) + ':' + (s < 10 ? ('0' + s) : s);\n        this.boxTime.string = time;\n    }\n\n    onDestroy() {\n        super.onDestroy();\n        this.unscheduleAllCallbacks();\n        if (this.timeInterval) {\n            this.unschedule(this.timeInterval);\n            this.timeInterval = null;\n        }\n    }\n}\n"]}