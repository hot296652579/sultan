{"version":3,"sources":["assets/script/common/component/CaptureUtil.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import PanelHelp from \"../../msgbox/PanelHelp\";\nimport { i18n } from \"../language/LanguageImpl\";\n\n\n\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class CaptureUtil {\n    private static _instance: CaptureUtil = null;\n    public static Instance() { return this._instance || (this._instance = new CaptureUtil()); }\n\n\n    private camera: cc.Camera = null\n    private texture: cc.RenderTexture = null\n    private _canvas: any = null\n\n    private inint(sender) {\n        if (!this.camera) {\n            let node = new cc.Node();\n            let rootScene = cc.director.getScene();\n            let root = rootScene.getChildByName(\"Canvas\");\n            node.parent = root;\n            node.zIndex = 10000;\n            this.camera = node.addComponent(cc.Camera);\n            this.camera.backgroundColor = cc.Color.TRANSPARENT\n            this.camera.clearFlags = cc.Camera.ClearFlags.DEPTH | cc.Camera.ClearFlags.STENCIL || cc.Camera.ClearFlags.COLOR\n            // 设置你想要的截图内容的 cullingMask\n            this.camera.cullingMask = -4;\n            this.camera.alignWithScreen = false;\n            // this.camera.orthoSize = sender.width/2;\n            // this.camera.node.position = cc.v2(0, 0);\n            this.camera.alignWithScreen = false;\n            this.camera.orthoSize = sender.height/2;\n            this.camera.node.y = sender.y;\n            let texture = new cc.RenderTexture();\n            texture.initWithSize(sender.width, sender.height, cc.RenderTexture.DepthStencilFormat.RB_FMT_S8);\n            this.camera.targetTexture = texture;\n            this.texture = texture;\n            this.camera.enabled = true;\n            \n        }\n       \n    }\n\n    public capture(node) {\n\n        if (node) {\n            this.inint(node)\n            node.groupIndex = 2\n            if (cc.sys.isNative) {//原生\n                setTimeout(() => {\n                    let picData = this.initImage();\n                    // this.createCanvas(picData);\n                    this.saveFile(picData);\n                    this.camera.enabled = false;\n                    this.camera.node.destroy();\n                    this.camera = null\n                }, 1000)\n\n            } else if (cc.sys.isBrowser) {//web\n                this.createCanvasWeb();\n                let img = this.createImg()\n                setTimeout(() => {\n                    // this.showImage(img);\n                    this.downloadFile_web('share_redPacke_image.png', img.src);\n                    dispatch(\"handleSaveImageToLocal\",true)\n                }, 1000)\n            }\n        }\n    }\n    private base64Img2Blob_web(code) {\n        var parts = code.split(';base64,');\n        var contentType = parts[0].split(':')[1];\n        var raw = window.atob(parts[1]);\n        var rawLength = raw.length;\n\n        var uInt8Array = new Uint8Array(rawLength);\n\n        for (var i = 0; i < rawLength; ++i) {\n            uInt8Array[i] = raw.charCodeAt(i);\n        }\n\n        return new Blob([uInt8Array], { type: contentType });\n\n\n    }\n    private downloadFile_web(fileName, content) {\n\n        var aLink = document.createElement('a');\n        var blob = this.base64Img2Blob_web(content);\n\n        var evt = document.createEvent(\"MouseEvents\");\n        evt.initEvent(\"click\", false, false);\n        aLink.download = fileName;\n        aLink.href = URL.createObjectURL(blob);\n        PanelHelp.showTip(i18n.REDPAKGE.saveSuccess)\n        aLink.dispatchEvent(evt);\n        this.camera.node.destroy();\n        this.camera = null\n    }\n    private createCanvasWeb() {\n        let width = this.texture.width;\n        let height = this.texture.height;\n        if (!this._canvas) {\n            this._canvas = document.createElement('canvas');\n\n            this._canvas.width = width;\n            this._canvas.height = height;\n        }\n        else {\n            this.clearCanvas();\n        }\n        let ctx = this._canvas.getContext('2d');\n        this.camera.render();\n        let data = this.texture.readPixels();\n        // write the render data\n        let rowBytes = width * 4;\n        for (let row = 0; row < height; row++) {\n            let srow = height - 1 - row;\n            let imageData = ctx.createImageData(width, 1);\n            let start = srow * width * 4;\n            for (let i = 0; i < rowBytes; i++) {\n                imageData.data[i] = data[start + i];\n            }\n\n            ctx.putImageData(imageData, 0, row);\n        }\n        return this._canvas;\n    }\n    private createImg() {\n        // return the type and dataUrl\n        var dataURL = this._canvas.toDataURL(\"share_redPacke_image/png\");\n        var img = document.createElement(\"img\");\n        img.src = dataURL;\n        return img;\n    }\n    private showImage(img) {\n        let texture = new cc.Texture2D();\n        texture.initWithElement(img);\n\n        let spriteFrame = new cc.SpriteFrame();\n        spriteFrame.setTexture(texture);\n\n        let node = new cc.Node();\n        let sprite = node.addComponent(cc.Sprite);\n        sprite.spriteFrame = spriteFrame;\n\n        node.zIndex = cc.macro.MAX_ZINDEX;\n        node.parent = cc.director.getScene();\n        // set position\n        let width = cc.winSize.width;\n        let height = cc.winSize.height;\n        node.x = width / 2;\n        node.y = height / 2;\n        node.on(cc.Node.EventType.TOUCH_START, () => {\n            node.parent = null;\n            node.destroy();\n        });\n\n        this.captureAction(node, width, height);\n    }\n    private clearCanvas() {\n        let ctx = this._canvas.getContext('2d');\n        ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\n    }\n\n    private initImage() {\n        this.camera.render();\n        let data = this.texture.readPixels();\n        let picData = this.filpYImage(data, this.texture.width, this.texture.height);\n        return picData;\n    }\n    private createCanvas(picData) {\n        let texture = new cc.Texture2D();\n        texture.initWithData(picData, 32, this.texture.width, this.texture.height);\n\n        let spriteFrame = new cc.SpriteFrame();\n        spriteFrame.setTexture(texture);\n\n        let node = new cc.Node();\n        let sprite = node.addComponent(cc.Sprite);\n        sprite.spriteFrame = spriteFrame;\n\n        node.zIndex = cc.macro.MAX_ZINDEX;\n        node.parent = cc.director.getScene();\n        // set position\n        let width = cc.winSize.width;\n        let height = cc.winSize.height;\n        node.x = width / 2;\n        node.y = height / 2;\n        node.on(cc.Node.EventType.TOUCH_START, () => {\n            node.parent = null;\n            node.destroy();\n        });\n\n        this.captureAction(node, width, height);\n    }\n    private filpYImage(data, width, height) {\n        // create the data array\n        let picData = new Uint8Array(width * height * 4);\n        let rowBytes = width * 4;\n        for (let row = 0; row < height; row++) {\n            let srow = height - 1 - row;\n            let start = srow * width * 4;\n            let reStart = row * width * 4;\n            // save the piexls data\n            for (let i = 0; i < rowBytes; i++) {\n                picData[reStart + i] = data[start + i];\n            }\n        }\n        return picData;\n    }\n    private saveFile(picData) {\n        if (CC_JSB) {\n            let filePath = jsb.fileUtils.getWritablePath() + 'share_redPacke_image.png';\n\n            // let success = jsb.fileUtils.writeDataToFile(picData, filePath)\n            let success = jsb.saveImageData(picData, this.texture.width, this.texture.height, filePath)\n            if (success) {\n                cc.log(\"save image data success, file: \" + filePath);\n                window['platformUtil'].saveTextureToLocal(filePath);\n                // PanelHelp.showTip(i18n.REDPAKGE.saveSuccess)\n\n            }\n            else {\n                cc.error(\"save image data failed!\");\n                PanelHelp.showTip(i18n.REDPAKGE.saveFailed)\n            }\n        }\n    }\n\n    private captureAction(capture, width, height) {\n        let scaleAction = cc.scaleTo(1, 0.3);\n        let targetPos = cc.v2(width - width / 6, height / 4);\n        let moveAction = cc.moveTo(1, targetPos);\n        let spawn = cc.spawn(scaleAction, moveAction);\n        capture.runAction(spawn);\n    }\n\n}\n\n\n"]}