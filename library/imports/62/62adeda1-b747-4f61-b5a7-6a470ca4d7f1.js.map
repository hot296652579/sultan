{"version":3,"sources":["assets/script/common/base/HotUpdate.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { reStartGame } from \"../../global/Global\";\nimport { Config } from \"../config/Config\";\n\ninterface Manifest {\n    /**@description 大厅版本 */\n    version?: string,\n    /**@description 子游戏版本 大厅的manifest不包含该字段 */\n    subVersion?: string,\n    /**@description 资源服务器地址 */\n    packageUrl?: string,\n    /**@description 远程project.manifest地址 */\n    remoteManifestUrl?: string,\n    /**@description 远程version.manifest地址 */\n    remoteVersionUrl?: string,\n    /**@description 包含资源 */\n    assets?: any,\n    searchPaths?: any\n}\n\nclass AssetsManager {\n\n    constructor(name: string) {\n        this.name = name;\n    }\n\n    /**@description  当前资源管理器的状态*/\n    code: any = -1;\n    /**@description 当前资源管理器的名称 */\n    name: string = \"\";\n    /**@description 当前资源管理器的实体 jsb.AssetsManager */\n    manager: any = null;\n}\n\nexport enum AssetManagerCode {\n    /**@description 找不到本地mainfest文件*/\n    ERROR_NO_LOCAL_MANIFEST,\n    /**@description 下载manifest文件错误 */\n    ERROR_DOWNLOAD_MANIFEST,\n    /**@description 解析manifest文件错误 */\n    ERROR_PARSE_MANIFEST,\n    /**@description 找到新版本 */\n    NEW_VERSION_FOUND,\n    /**@description 当前已经是最新版本 */\n    ALREADY_UP_TO_DATE,\n    /**@description 更新下载进度中 */\n    UPDATE_PROGRESSION,\n    /**@description 资源更新中 */\n    ASSET_UPDATED,\n    /**@description 更新错误 */\n    ERROR_UPDATING,\n    /**@description 更新完成 */\n    UPDATE_FINISHED,\n    /**@description 更新失败 */\n    UPDATE_FAILED,\n    /**@description 解压资源失败 */\n    ERROR_DECOMPRESS,\n\n\n    //以下是js中扩展的字段，上面是引擎中已经有的字段\n    /**@description 正检测更新中 */\n    CHECKING,\n}\n\nexport enum AssetManagerState {\n    /**@description 未初始化 */\n    UNINITED,\n    /**@description 找到manifest文件 */\n    UNCHECKED,\n    /**@description 准备下载版本文件 */\n    PREDOWNLOAD_VERSION,\n    /**@description 下载版本文件中 */\n    DOWNLOADING_VERSION,\n    /**@description 版本文件下载完成 */\n    VERSION_LOADED,\n    /**@description 准备加载project.manifest文件 */\n    PREDOWNLOAD_MANIFEST,\n    /**@description 下载project.manifest文件中 */\n    DOWNLOADING_MANIFEST,\n    /**@description 下载project.manifest文件完成 */\n    MANIFEST_LOADED,\n    /**@description 需要下载更新 */\n    NEED_UPDATE,\n    /**@description 准备更新 */\n    READY_TO_UPDATE,\n    /**@description 更新中 */\n    UPDATING,\n    /**@description 解压中 */\n    UNZIPPING,\n    /**@description 已经是最新版本 */\n    UP_TO_DATE,\n    /**@description 更新失败 */\n    FAIL_TO_UPDATE,\n\n    /**自定定义扩展 */\n    /**@description 尝试重新下载失败文件 */\n    TRY_DOWNLOAD_FAILED_ASSETS,\n}\n\n/**@description 子游戏热更新的方式 */\nexport enum SubGameUpdateType {\n    /**@description 如果该子游戏的代码已经加载过，\n     * 在玩家不重启游戏的情况下，忽略服务器端的所有更新\n     * 优点：在玩家未关闭游戏前提，每个子游戏只会进行一次更新\n     * 缺点: 每个子游戏只能更新一次，不能时时保证进入子游戏的代码及资源为最新版本\n     *  */\n    Normal,\n    /**@description 不管子游戏戏代码是否已经加载\n     * 都先会检测更新，去服务器拉取到最新的代码及资源\n     * 优点 : 本地的代码始终保持最新\n     * 缺点 : 当玩家已经进入了该游戏，下次在进入该游戏时，\n     * 发现有新的版本，此时下载完成新版本的资源及代码后，会造成应用重启\n     */\n    CheckUpdate,\n}\n\nexport class GameConfig {\n    /**@description 游戏子包名 */\n    subpackageName: string = \"\";\n    /**@description 游戏名 */\n    gameName: string = \"\";\n    /**@description h5是否加载子游戏完成 */\n    isLoaded = false;\n    index = 0;\n    constructor( gameName : string , subpackageName : string , index : number){\n        this.gameName = gameName;\n        this.subpackageName = subpackageName;\n        this.index = index;\n        this.isLoaded = false;\n    }\n }\n\nconst HALL_ASSETS_MANAGER_NAME = \"HALL\";\n\n/**\n * @description 热更新组件\n */\nconst { ccclass, property } = cc._decorator;\n@ccclass\nclass _HotUpdate {\n    private manifestRoot: string = `manifest/`;\n    /**@description 本地存储热更新文件的路径 */\n    private storagePath = \"\";\n    /**@description 是否在热更新中或检测更新状态 */\n    private updating = false;\n\n    /**@description 子游戏更新类型 */\n    public subGameUpdateType = SubGameUpdateType.Normal;\n\n    private _commonHotUpdateUrl = null;\n    /**@description 通用的热更新地址，当在子游戏或大厅未指定热更新地址时，都统一使用服务器传回来的默认全局更新地址 */\n    public get commonHotUpdateUrl(): string {\n        this._commonHotUpdateUrl = G.URLMgr.hotUpdateURL;\n        if (this._commonHotUpdateUrl.length > 0) {\n            return this._commonHotUpdateUrl;\n        } else {\n            return this.projectManifest.packageUrl;\n        }\n    }\n\n    private _projectManifest: Manifest = null;\n    private get projectManifest(): Manifest {\n        if (CC_JSB && !this._projectManifest) {\n            let content = jsb.fileUtils.getStringFromFile(this.hallProjectMainfest);\n            try {\n                this._projectManifest = JSON.parse(content);\n            } catch (error) {\n                this._projectManifest = null;\n                cc.error(`读取${this.hallProjectMainfest}失败`);\n            }\n        }\n        return this._projectManifest;\n    }\n\n    /**@description 热更新回调 */\n    public onDownload: (\n        downloadedBytes: number,\n        totalBytes: number,\n        downloadedFiles: number,\n        totalFiles: number,\n        percent: number,\n        percentByFile: number,\n        code: AssetManagerCode,\n        state: AssetManagerState,\n        needRestart: boolean) => void = null;\n    /**@description 大厅本地的版本项目更新文件配置路径 */\n    public get hallProjectMainfest() {\n        return `${this.manifestRoot}project.manifest`;\n    }\n    /**@description 检测更新回调 */\n    public checkCallback: (code: AssetManagerCode, state: AssetManagerState) => void = null;\n\n    /**@description 子游戏版本信息 */\n    public allGameConfig: { [key: string]: GameConfig } = {};\n\n    /**@description 资源管理器 */\n    private assetsManagers: { [key: string]: AssetsManager } = {};\n\n    public _hotUpdateUrls: { [key: string]: string } = {};\n    /**@description 热更新地址，为了方便后面当只更新一个游戏，或cdn服务器 */\n    private getHotUpdateUrl(moduleName: string) {\n        if (CC_DEBUG) {\n            let config = {\n                \"gameOne\": this._commonHotUpdateUrl,\n                \"gameTwo\": this._commonHotUpdateUrl,\n            }\n            if (config[moduleName]) {\n                return config[moduleName];\n            } else {\n                return this.commonHotUpdateUrl;\n            }\n        } else {\n            if (this._hotUpdateUrls[moduleName]) {\n                return this._hotUpdateUrls[moduleName];\n            } else {\n                return this.commonHotUpdateUrl;\n            }\n        }\n    }\n\n    /**@description 当前热更新的资源管理器 */\n    private currentAssetsManager: AssetsManager = null;\n\n    /**@description 获取子游戏名 */\n    public getGameLocalName(gameName: string) {\n        return this.allGameConfig[gameName];\n    }\n\n    /**@description 释放资源管理器，默认为hall 大厅资源管理器 */\n    destroyAssetsManager(name: string = HALL_ASSETS_MANAGER_NAME) {\n        if (this.assetsManagers[name]) {\n            delete this.assetsManagers[name];\n        }\n    }\n\n    /**@description 获取资源管理器，默认为hall 大厅的资源管理器 */\n    public getAssetsManager(name: string = HALL_ASSETS_MANAGER_NAME) {\n        if (this.assetsManagers[name]) {\n            return this.assetsManagers[name];\n        } else {\n            //初始化资源管理器\n            if (CC_JSB) {\n                this.storagePath = jsb.fileUtils.getWritablePath();\n                cc.log(`Storage path for remote asset : ${this.storagePath}`);\n                this.assetsManagers[name] = new AssetsManager(name);\n                this.assetsManagers[name].manager = new jsb.AssetsManager(name == HALL_ASSETS_MANAGER_NAME ? \"type.hall\" : `type.${name}_`, this.storagePath, this.versionCompareHanle.bind(this));\n                //设置下载并发量\n                this.assetsManagers[name].manager.setMaxConcurrentTask(8);\n                this.assetsManagers[name].manager.setHotUpdateUrl(this.getHotUpdateUrl(name));\n                this.assetsManagers[name].manager.setVerifyCallback(function (path, asset) {\n                    let compressed = asset.compressed;\n                    let expectedMD5 = asset.md5;\n                    let relativePath = asset.path;\n                    let size = asset.size;\n                    if (compressed) {\n                        cc.log(`Verification passed : ${relativePath}`);\n                        return true;\n                    }\n                    else {\n                        cc.log(`Verification passed : ${relativePath} ( ${expectedMD5} )`);\n                        return true;\n                    }\n                });\n                cc.log(`Hot update is ready , please check or directly update.`);\n            }\n            return this.assetsManagers[name];\n        }\n    }\n\n    /**@description 判断是否需要重新尝试下载之前下载失败的文件 */\n    private isTryDownloadFailedAssets() {\n        if (this.currentAssetsManager &&\n            this.currentAssetsManager.manager.getState() == AssetManagerState.FAIL_TO_UPDATE &&\n            (this.currentAssetsManager.code == AssetManagerCode.ERROR_NO_LOCAL_MANIFEST ||\n                this.currentAssetsManager.code == AssetManagerCode.ERROR_DOWNLOAD_MANIFEST ||\n                this.currentAssetsManager.code == AssetManagerCode.ERROR_PARSE_MANIFEST\n                ||this.currentAssetsManager.code == AssetManagerCode.UPDATE_FAILED\n                )) {\n            return true;\n        }\n        return false;\n    }\n\n    /**@description 检测更新 */\n    private checkUpdate(callback: (code: AssetManagerCode, state: AssetManagerState) => void) {\n        if (cc.sys.platform === cc.sys.WECHAT_GAME || CC_PREVIEW || cc.sys.isBrowser ) {\n            //预览及浏览器下，不需要有更新的操作\n            this.updating = false;\n            callback(AssetManagerCode.ALREADY_UP_TO_DATE, AssetManagerState.UP_TO_DATE);\n        } else {\n            cc.log(`--checkUpdate--`);\n            if (this.updating) {\n                cc.log(`Checking or updating...`);\n                callback(AssetManagerCode.CHECKING, AssetManagerState.PREDOWNLOAD_VERSION);\n                return;\n            }\n            if (!this.currentAssetsManager.manager.getLocalManifest() || !this.currentAssetsManager.manager.getLocalManifest().isLoaded()) {\n                cc.log(`Failed to load local manifest ....`);\n                callback(AssetManagerCode.ERROR_DOWNLOAD_MANIFEST, AssetManagerState.FAIL_TO_UPDATE);\n                return;\n            }\n            if (this.isTryDownloadFailedAssets()) {\n                //已经更新失败，尝试获取更新下载失败的\n                cc.log(`之前下载资源未完全下载完成，请尝试重新下载`);\n                callback(AssetManagerCode.UPDATE_FAILED, AssetManagerState.TRY_DOWNLOAD_FAILED_ASSETS);\n            } else {\n                this.updating = true;\n                this.checkCallback = callback;\n                this.currentAssetsManager.manager.setEventCallback(this.checkCb.bind(this));\n                this.currentAssetsManager.manager.checkUpdate();\n            }\n        }\n    }\n\n    downloadFailedAssets() {\n        if (this.currentAssetsManager) {\n            this.currentAssetsManager.manager.downloadFailedAssets();\n        }\n    }\n\n    /**@description 检查大厅是否需要更新 */\n    checkHallUpdate(callback: (code: AssetManagerCode, state: AssetManagerState) => void) {\n        if ( cc.sys.platform === cc.sys.WECHAT_GAME || CC_PREVIEW || cc.sys.isBrowser) {\n            //预览及浏览器下，不需要有更新的操作\n            cc.log(`预览或浏览器`);\n            callback(AssetManagerCode.ALREADY_UP_TO_DATE, AssetManagerState.UP_TO_DATE);\n        } else {\n            this.currentAssetsManager = this.getAssetsManager();\n            this.currentAssetsManager.manager.loadLocalManifest(this.hallProjectMainfest);\n            this.checkUpdate(callback);\n        }\n    }\n\n    /**\n     * @description 获取子游戏manifest url\n     * @param gameName 子游戏名\n     * @returns manifest url\n     */\n    public getGameManifest(gameName): string {\n        return `${gameName}_project.manifest`;\n    }\n\n    /**\n     * @description 检测子游戏更新\n     * @param gameName 子游戏名\n     * @param callback 检测完成回调\n     */\n    checkGameUpdate(gameName: string, callback: (code: AssetManagerCode, state: AssetManagerState) => void) {\n        if (cc.sys.platform === cc.sys.WECHAT_GAME || CC_PREVIEW || cc.sys.isBrowser || !Config.isOpenHotUpdate) {\n            //预览及浏览器下，不需要有更新的操作\n            cc.log(`不需要有更新的操作`);\n            callback(AssetManagerCode.ALREADY_UP_TO_DATE, AssetManagerState.UP_TO_DATE);\n        } else {\n            this.currentAssetsManager = this.getAssetsManager(gameName);\n            let manifestUrl = this.getGameManifest(gameName);\n            //先检测本地是否已经存在子游戏版本控制文件 \n            if (jsb.fileUtils.isFileExist(manifestUrl)) {\n                //存在版本控制文件 \n                let content = jsb.fileUtils.getStringFromFile(manifestUrl);\n                let jsbGameManifest = new jsb.Manifest(content, this.storagePath, this.getHotUpdateUrl(this.currentAssetsManager.name));\n                cc.log(`--存在本地版本控制文件checkUpdate--`);\n                cc.log(`mainifestUrl : ${manifestUrl}`);\n                this.currentAssetsManager.manager.loadLocalManifest(jsbGameManifest, \"\");\n                this.checkUpdate(callback);\n            } else {\n                //不存在版本控制文件 ，生成一个初始版本\n                if (this.updating) {\n                    cc.log(`Checking or updating...`);\n                    callback(AssetManagerCode.CHECKING, AssetManagerState.PREDOWNLOAD_VERSION);\n                    return;\n                }\n\n                let packageUrl = this.getHotUpdateUrl(gameName);\n                let gameManifest = {\n                    version: \"0\",\n                    packageUrl: packageUrl,\n                    remoteManifestUrl: `${packageUrl}${this.manifestRoot}${manifestUrl}`,\n                    remoteVersionUrl: `${packageUrl}${this.manifestRoot}${gameName}_version.manifest`,\n                    assets: {},\n                    searchPaths: []\n                };\n                let gameManifestContent = JSON.stringify(gameManifest);\n                let jsbGameManifest = new jsb.Manifest(gameManifestContent, this.storagePath, this.getHotUpdateUrl(this.currentAssetsManager.name));\n                cc.log(`--checkUpdate--`);\n                cc.log(`mainifest content : ${gameManifestContent}`);\n                this.currentAssetsManager.manager.loadLocalManifest(jsbGameManifest, \"\");\n                this.checkUpdate(callback);\n            }\n        }\n    }\n\n    /**@description 检测更新 */\n    private checkCb(event) {\n\n        //这里不能置空，下载manifest文件也会回调过来\n        //this.checkCallback = null;\n        //存储当前的状态，当下载版本文件失败时，state的状态与下载非版本文件是一样的状态\n        this.currentAssetsManager.code = event.getEventCode();\n        cc.log(`checkCb event code : ${event.getEventCode()} state : ${this.currentAssetsManager.manager.getState()}`);\n        switch (event.getEventCode()) {\n            case AssetManagerCode.ERROR_NO_LOCAL_MANIFEST:\n                cc.log(`No local manifest file found, hot update skipped.`);\n                break;\n            case AssetManagerCode.ERROR_DOWNLOAD_MANIFEST:\n            case AssetManagerCode.ERROR_PARSE_MANIFEST:\n                cc.log(`Fail to download manifest file, hot update skipped.`);\n                break;\n            case AssetManagerCode.ALREADY_UP_TO_DATE:\n                cc.log(`Already up to date with the latest remote version.`);\n                break;\n            case AssetManagerCode.NEW_VERSION_FOUND:\n                cc.log(`New version found, please try to update.`);\n                break;\n            case AssetManagerCode.UPDATE_FINISHED:\n                cc.log(` UPDATE_FINISHED `);\n                break;\n            default:\n                return;\n        }\n\n        //this.currentAssetsManager.setEventCallback(null);\n        this.updating = false;\n\n        //如果正在下载更新文件，先下载更新文件比较完成后，再回调\n        if (this.checkCallback && this.currentAssetsManager.manager.getState() != AssetManagerState.DOWNLOADING_VERSION) {\n            this.checkCallback(event.getEventCode(), this.currentAssetsManager.manager.getState());\n            this.checkCallback = null;\n        }\n    }\n\n    /**\n     * @description 热更新\n     * @param manifestUrl manifest地址\n     * @param gameName \n     */\n    hotUpdate() {\n        if (!this.currentAssetsManager) {\n            cc.error(`热更新管理器未初始化`);\n            return;\n        }\n        cc.log(`即将热更新模块为:${this.currentAssetsManager.name} , updating : ${this.updating}`);\n        if (!this.updating) {\n            cc.log(`执行更新 ${this.currentAssetsManager.name} `);\n            this.currentAssetsManager.manager.setEventCallback(this.updateCb.bind(this));\n            this.currentAssetsManager.manager.update();\n        }\n    }\n\n    /**@description 热更新回调 */\n    private updateCb(event) {\n        var isUpdateFinished = false;\n        var failed = false;\n        cc.log(`--update cb code : ${event.getEventCode()} state : ${this.currentAssetsManager.manager.getState()}`);\n        //存储当前的状态，当下载版本文件失败时，state的状态与下载非版本文件是一样的状态\n        this.currentAssetsManager.code = event.getEventCode();\n        switch (event.getEventCode()) {\n            case AssetManagerCode.ERROR_NO_LOCAL_MANIFEST:\n                cc.log(`No local manifest file found, hot update skipped.`);\n                failed = true;\n                break;\n            case AssetManagerCode.UPDATE_PROGRESSION:\n                cc.log(`${event.getDownloadedBytes()} / ${event.getTotalBytes()}`);\n                cc.log(`${event.getDownloadedFiles()} / ${event.getTotalFiles()}`);\n                cc.log(`percent : ${event.getPercent()}`);\n                cc.log(`percent by file : ${event.getPercentByFile()}`);\n                var msg = event.getMessage();\n                if (msg) {\n                    cc.log(`Updated file: ${msg}`);\n                }\n                break;\n            case AssetManagerCode.ERROR_DOWNLOAD_MANIFEST:\n            case AssetManagerCode.ERROR_PARSE_MANIFEST:\n                cc.log(`Fail to download manifest file, hot update skipped.`);\n                failed = true;\n                break;\n            case AssetManagerCode.ALREADY_UP_TO_DATE:\n                cc.log(`Already up to date with the latest remote version.`);\n                failed = true;\n                break;\n            case AssetManagerCode.UPDATE_FINISHED:\n                cc.log(`Update finished. ${event.getMessage()}`);\n                isUpdateFinished = true;\n                break;\n            case AssetManagerCode.UPDATE_FAILED:\n                cc.log(`Update failed. ${event.getMessage()}`);\n                this.updating = false;\n                break;\n            case AssetManagerCode.ERROR_UPDATING:\n                cc.log(`Asset update error: ${event.getAssetId()} , ${event.getMessage()}`);\n                break;\n            case AssetManagerCode.ERROR_DECOMPRESS:\n                cc.log(`${event.getMessage()}`);\n                break;\n            default:\n                break;\n        }\n        if (failed) {\n            this.currentAssetsManager.manager.setEventCallback(null);\n            this.updating = false;\n        }\n\n        if (isUpdateFinished) {\n            //下载完成,需要重新设置搜索路径，添加下载路径\n            // Prepend the manifest's search path\n            var searchPaths: string[] = jsb.fileUtils.getSearchPaths();\n            var newPaths: string[] = this.currentAssetsManager.manager.getLocalManifest().getSearchPaths();\n            cc.log(JSON.stringify(newPaths));\n            Array.prototype.unshift.apply(searchPaths, newPaths);\n            // This value will be retrieved and appended to the default search path during game startup,\n            // please refer to samples/js-tests/main.js for detailed usage.\n            // !!! Re-add the search paths in main.js is very important, otherwise, new scripts won't take effect.\n\n            //这里做一个搜索路径去重处理\n            let obj = {};\n            for (let i = 0; i < searchPaths.length; i++) {\n                obj[searchPaths[i]] = true;\n            }\n            searchPaths = Object.keys(obj);\n            cc.sys.localStorage.setItem('HotUpdateSearchPaths', JSON.stringify(searchPaths));\n            jsb.fileUtils.setSearchPaths(searchPaths);\n        }\n\n        if (this.currentAssetsManager.name == HALL_ASSETS_MANAGER_NAME) {\n            if (isUpdateFinished) {\n                this.currentAssetsManager.manager.setEventCallback(null);\n                //下载数量大于0，才有必要进入重启，在如下这种情况下，并不会发生下载\n                //当只提升了版本号，而并未对代码进行修改时，此时的只下载了一个project.manifest文件，\n                //不需要对游戏进行重启的操作\n               \n                if (event.getDownloadedFiles() > 0) {\n                    cc.log(`更新大厅，需要重启app生效`);\n                    // cc.game.restart();\n                    reStartGame()\n                }\n            }\n        } else {\n            //子游戏更新\n            if (isUpdateFinished) {\n                if (event.getDownloadedFiles() > 0) {\n                    //已经加载过子游戏代码，如果需要使用到最新，需要重启app才能是最新的代码\n                    if (this.allGameConfig[this.currentAssetsManager.name].isLoaded) {\n                        cc.log(`已经加载过游戏代码，需要重启app生效`);\n                        isUpdateFinished = true;\n                        // cc.game.restart();\n                        reStartGame()\n                    } else {\n                        //没有加载过子游戏代码\n                        cc.log(`第一次加载子游戏代码，不需要重启`);\n                        isUpdateFinished = false;\n                    }\n                } else {\n                    isUpdateFinished = false;\n                }\n            }\n        }\n\n        if (this.onDownload) {\n            this.onDownload(\n                event.getDownloadedBytes(),\n                event.getTotalBytes(),\n                event.getDownloadedFiles(),\n                event.getTotalFiles(),\n                event.getPercent(),\n                event.getPercentByFile(),\n                event.getEventCode(),\n                this.currentAssetsManager.manager.getState(),\n                isUpdateFinished\n            );\n        }\n\n        cc.log(`update cb  failed : ${failed}  , need restart : ${isUpdateFinished} , updating : ${this.updating}`);\n    }\n\n    private versionCompareHanle(versionA: string, versionB: string) {\n        cc.log(`JS Custom Version Compare : version A is ${versionA} , version B is ${versionB}`);\n        let vA = versionA.split('.');\n        let vB = versionB.split('.');\n        cc.log(`version A ${vA} , version B ${vB}`);\n        for (let i = 0; i < vA.length && i < vB.length; ++i) {\n            let a = parseInt(vA[i]);\n            let b = parseInt(vB[i]);\n            if (a === b) {\n                continue;\n            }\n            else {\n                return a - b;\n            }\n        }\n        if (vB.length > vA.length) {\n            return 1;\n        }\n        return 0;\n    }\n}\n\nexport let HotUpdate = new _HotUpdate();\n"]}